import{a as ji,c as Ni,d as Ui,e as xe,g as Pt,h as Gi}from"./chunk-Y6U22JCL.js";import{a as He,b as Re,c as Dt,d as Wi,e as Zi}from"./chunk-XREISQ3S.js";import{$ as N,$a as Y,Aa as K,Ba as ce,Ca as I,D as Mt,Da as g,E as Dn,Ea as l,F as fe,Fa as de,Fb as Ri,G as xi,Ga as he,H as Ct,Ha as xt,I as De,Ia as Me,J as $,Ja as ie,Jb as St,K as te,Ka as ae,L as Z,La as R,M as G,Ma as u,N as Ae,Na as A,O as bi,Oa as T,P as _,Pa as ye,Q as ne,Qa as En,R as H,Ra as qn,Sa as Fn,T as wi,Ta as oe,U as j,Ua as x,V as M,Va as Be,W as C,Wa as ke,X as _t,Xa as bt,Y as An,Ya as wt,Z as f,Za as It,_ as Oe,a as V,aa as Ii,ab as Oi,b as B,bb as Ti,ca as Li,cb as pe,da as Si,db as Ee,ea as d,eb as Lt,f as Pe,fa as m,fb as tt,g as Je,ga as Te,gb as Ce,h as q,ha as On,hb as Vi,i as Ye,ia as ve,ib as zn,ja as re,jb as me,k as Sn,ka as ze,kb as Ei,l as mi,la as v,lb as W,m as gi,ma as Pi,mb as O,na as z,nb as qi,oa as p,ob as Fi,p as ft,pa as et,pb as _e,qa as L,qb as zi,r as fi,ra as Di,rb as Bi,s as vi,sa as Ai,sb as w,ta as Ve,tb as Hi,u as Mi,ua as Tn,v as vt,va as Vn,w as Ci,wa as c,x as Pn,xa as r,ya as D,z as _i,za as X}from"./chunk-HURRB3F2.js";var Lo=["*"];function So(i,t){if(i&1){let e=I();c(0,"div",4)(1,"h2"),u(2),r(),c(3,"button",5),g("click",function(){M(e);let a=l();return C(a.onClose())}),u(4,"\xD7"),r()()}if(i&2){let e=l();d(2),A(e.config.title),d(),p("disabled",!e.config.closeOnBackdrop)}}var je=class i{config;close=new f;onBackdropClick(){this.config?.closeOnBackdrop&&this.close.emit()}onEscapeKey(){this.config?.closeOnBackdrop&&this.close.emit()}onClose(){this.config?.closeOnBackdrop&&this.close.emit()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=_({type:i,selectors:[["app-dialog"]],hostBindings:function(e,n){e&1&&g("keydown.escape",function(){return n.onEscapeKey()},!1,Si)},inputs:{config:"config"},outputs:{close:"close"},standalone:!0,features:[x],ngContentSelectors:Lo,decls:5,vars:5,consts:[[1,"dialog-backdrop",3,"click"],[1,"dialog-container",3,"click"],["class","dialog-header",4,"ngIf"],[1,"dialog-content"],[1,"dialog-header"],[1,"close-button",3,"click","disabled"]],template:function(e,n){e&1&&(de(),c(0,"div",0),g("click",function(){return n.onBackdropClick()}),c(1,"div",1),g("click",function(o){return o.stopPropagation()}),v(2,So,5,2,"div",2),c(3,"div",3),he(4),r()()()),e&2&&(d(),et("width",n.config.width)("height",n.config.height),d(),p("ngIf",n.config==null?null:n.config.title))},dependencies:[w,O],styles:[".dialog-backdrop[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.dialog-container[_ngcontent-%COMP%]{background:#fff;border-radius:4px;box-shadow:0 2px 8px #0003;min-width:300px;max-width:90vw;max-height:100vh;display:flex;flex-direction:column}.dialog-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:16px;border-bottom:1px solid #eee}.dialog-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.2em}.dialog-header[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]{border:none;background:none;font-size:1.5em;cursor:pointer;padding:4px 8px}.dialog-header[_ngcontent-%COMP%]   .close-button[_ngcontent-%COMP%]:disabled{cursor:not-allowed;opacity:.5}.dialog-content[_ngcontent-%COMP%]{padding:16px;overflow-y:auto}"]})};var $i=class i{discard=new f;stay=new f;dialogConfig={width:"400px",closeOnBackdrop:!0,title:"Navigation Blocked"};onDiscard(){this.discard.emit()}onStay(){this.stay.emit()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=_({type:i,selectors:[["app-navigation-blocked"]],outputs:{discard:"discard",stay:"stay"},standalone:!0,features:[x],decls:10,vars:1,consts:[[3,"close","config"],["dialog-content",""],["dialog-actions",""],[3,"click"]],template:function(e,n){e&1&&(c(0,"app-dialog",0),g("close",function(){return n.onStay()}),c(1,"div",1),u(2," There are unsaved changes. "),D(3,"br"),u(4," Do you want to discard them and continue? "),r(),c(5,"div",2)(6,"button",3),g("click",function(){return n.onDiscard()}),u(7,"Discard Changes"),r(),c(8,"button",3),g("click",function(){return n.onStay()}),u(9,"Stay Here"),r()()()),e&2&&p("config",n.dialogConfig)},dependencies:[je],styles:["[_nghost-%COMP%]   [dialog-actions][_ngcontent-%COMP%]{display:flex;gap:.5rem;justify-content:center;padding:1rem}[_nghost-%COMP%]   button[_ngcontent-%COMP%]{padding:.5rem 1rem;border-radius:4px;border:1px solid #ddd;background:#fff;cursor:pointer}[_nghost-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#f5f5f5}[_nghost-%COMP%]   button[_ngcontent-%COMP%]:first-child{border-color:#cb2431;color:#cb2431}[_nghost-%COMP%]   button[_ngcontent-%COMP%]:first-child:hover{background:#ffdce0}"]})};function Po(i,t){if(i&1&&(c(0,"div",1),u(1),r()),i&2){let e=t.ngIf;Ai("toast-"+e.type),d(),T(" ",e.message,`
`)}}var Xi=class i{constructor(t){this.toastService=t}static \u0275fac=function(e){return new(e||i)(m(Ui))};static \u0275cmp=_({type:i,selectors:[["app-toast"]],standalone:!0,features:[x],decls:2,vars:3,consts:[["class","toast",3,"class",4,"ngIf"],[1,"toast"]],template:function(e,n){e&1&&(v(0,Po,2,3,"div",0),wt(1,"async")),e&2&&p("ngIf",It(1,1,n.toastService.message$))},dependencies:[w,O,zi],styles:[".toast[_ngcontent-%COMP%]{position:fixed;top:20px;right:20px;padding:12px 20px;border-radius:4px;color:var(--color-primary);z-index:9999;animation:_ngcontent-%COMP%_slideIn .3s ease}.toast-success[_ngcontent-%COMP%]{background:#093c}.toast-info[_ngcontent-%COMP%]{background:#2196f3}.toast-warning[_ngcontent-%COMP%]{background:#ff9800}.toast-error[_ngcontent-%COMP%]{background:#f44336}@keyframes _ngcontent-%COMP%_slideIn{0%{transform:translate(100%)}to{transform:translate(0)}}"]})};var Ki=i=>({$implicit:i});function Do(i,t){i&1&&ce(0)}function Ao(i,t){if(i&1&&(c(0,"span",8),u(1),r()),i&2){let e=l().$implicit,n=l(2);d(),ye(" ",n.currentInteraction||0," / ",n.getSessionTotal(e)," ")}}function Oo(i,t){i&1&&ce(0)}function To(i,t){if(i&1&&(X(0),v(1,Oo,1,0,"ng-container",2),K()),i&2){let e=l().$implicit;l(2);let n=R(3);d(),p("ngTemplateOutlet",n)("ngTemplateOutletContext",ke(2,Ki,e.children))}}function Vo(i,t){if(i&1){let e=I();c(0,"div",4)(1,"span",5),g("click",function(){let a=M(e).$implicit,o=l(2);return C(o.onItemClick(a))}),u(2),v(3,Ao,2,2,"span",6),r(),v(4,To,2,4,"ng-container",7),r()}if(i&2){let e=t.$implicit,n=l(2);d(),L("active",e.id==n.currentPosition),d(),ye(" ",n.typeToIcon[e.type]," ",e.title," "),d(),p("ngIf",e.type==="session"&&e.id==n.currentPosition),d(),p("ngIf",e.children)}}function Eo(i,t){if(i&1&&v(0,Vo,5,6,"div",3),i&2){let e=t.$implicit;p("ngForOf",e)}}var At=class i{content=[];currentPosition;currentInteraction;sessionInteractionCounts=new Map;jumpTo=new f;typeToIcon={book:"\u{1F56E}",chapter:"\u{1F4D1}",session:"\u{1F4DD}"};getSessionTotal(t){return this.sessionInteractionCounts.get(t.sessionId)||0}onItemClick(t){t.type==="session"&&t.id==this.currentPosition?this.jumpTo.emit({contentId:t.id,interactionNum:this.currentInteraction}):this.jumpTo.emit({contentId:t.id})}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=_({type:i,selectors:[["app-book-view-toc"]],inputs:{content:"content",currentPosition:"currentPosition",currentInteraction:"currentInteraction",sessionInteractionCounts:"sessionInteractionCounts"},outputs:{jumpTo:"jumpTo"},standalone:!0,features:[x],decls:4,vars:4,consts:[["tocItem",""],[1,"book-view-toc"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["class","toc-item",4,"ngFor","ngForOf"],[1,"toc-item"],[3,"click"],["class","progress",4,"ngIf"],[4,"ngIf"],[1,"progress"]],template:function(e,n){if(e&1&&(c(0,"div",1),v(1,Do,1,0,"ng-container",2),r(),v(2,Eo,1,1,"ng-template",null,0,Y)),e&2){let a=R(3);d(),p("ngTemplateOutlet",a)("ngTemplateOutletContext",ke(2,Ki,n.content))}},dependencies:[w,W,O,_e],styles:[".book-view-toc[_ngcontent-%COMP%]{padding:20px}.book-view-toc[_ngcontent-%COMP%]   .toc-item[_ngcontent-%COMP%]{padding-left:20px;line-height:1.8}.book-view-toc[_ngcontent-%COMP%]   .toc-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{cursor:pointer;display:flex;align-items:center;gap:8px}.book-view-toc[_ngcontent-%COMP%]   .toc-item[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:hover{color:#0056b3}.book-view-toc[_ngcontent-%COMP%]   .toc-item[_ngcontent-%COMP%]   span.active[_ngcontent-%COMP%]{color:#007bff;font-weight:700}.book-view-toc[_ngcontent-%COMP%]   .toc-item[_ngcontent-%COMP%]   span.active[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]{font-size:.9em;color:#666;font-weight:400}"]})};var qo=["container"],Fo=["interactionList"];function zo(i,t){if(i&1){let e=I();c(0,"app-interaction-list2",10),g("activeInteractionChange",function(a){M(e);let o=l(2).$implicit,s=l();return C(s.onActiveInteractionChange(a,o.id))})("totalInteractions",function(a){M(e);let o=l(2).$implicit,s=l();return C(s.onTotalInteractions(a,o.sessionId.toString()))})("initialLoadComplete",function(){M(e);let a=l(3);return C(a.onSessionLoaded())}),r()}if(i&2){let e=l(2).$implicit,n=l(),a=R(1);p("sessionId",e.sessionId)("interactionNum",e.id==n.restoredPosition?n.restoredInteractionNum:void 0)("preloadLast",n.shouldPreloadLast(e.id.toString()))("scrollContainer",a)("isActiveSession",e.id==n.currentPosition)}}function Bo(i,t){if(i&1&&(X(0),v(1,zo,1,5,"app-interaction-list2",9),K()),i&2){let e=l().$implicit,n=l();d(),p("ngIf",n.visibleSessions.has(e.id.toString()))}}function Ho(i,t){if(i&1&&(c(0,"div",6)(1,"h2",7),u(2),r(),v(3,Bo,2,1,"ng-container",8),r()),i&2){let e=t.$implicit,n=l();L("active",e.id==n.currentPosition),z("data-content-id",e.id)("data-session-id",e.type==="session"?e.sessionId:null),d(2),A(e.title),d(),p("ngIf",e.type==="session")}}var Ot=class i{content;restoredPosition;_restoredInteractionNum;set restoredInteractionNum(t){this._restoredInteractionNum||(this._restoredInteractionNum=t)}get restoredInteractionNum(){return this._restoredInteractionNum||0}activeItemChange=new f;activeInteractionChange=new f;totalInteractionsChange=new f;bookCompleted=new f;container;interactionLists;activeInteractionNum;currentPosition;flatContent=[];visibleSessions=new Set;initialized=!1;ngOnDestroy(){this.container.nativeElement.removeEventListener("scroll",this.handleScroll)}ngOnChanges(t){if(!this.initialized&&t.content&&this.content.length>0&&this.restoredPosition){this.initialized=!0,this.flatContent=this.flattenContent(this.content);let e=this.findContentItem(this.restoredPosition),n=e?.type==="session"?e:this.findNextSession(e);n&&this.visibleSessions.add(n.id.toString())}}findContentItem(t){return this.flatContent.find(e=>e.id==t)}findNextSession(t){let e=t?this.flatContent.findIndex(n=>n.id==t.id):0;return this.flatContent.slice(e).find(n=>n.type==="session")}INTERACTION_OFFSET=40;scrollInitiated=!1;onSessionLoaded(){setTimeout(()=>{this.setScrollTop(),this.scrollInitiated||(this.scrollInitiated=!0,this.container.nativeElement.addEventListener("scroll",this.handleScroll),this.handleScroll())})}scrollTopSet=!1;setScrollTop(){if(!this.scrollTopSet){let t=this.container.nativeElement,e=t.querySelector(`[data-content-id="${this.restoredPosition}"]`);if(e){let n=e.offsetTop-this.containerOffset;if(this._restoredInteractionNum){let o=e.querySelector(`[data-interaction-num="${this._restoredInteractionNum}"]`);o&&(n=o.offsetTop+e.offsetTop+this.INTERACTION_OFFSET)}t.scrollTop=n;let a=t.scrollTop;this.scrollTopSet=a==n}}}onActiveInteractionChange(t,e){this.activeInteractionNum=t,this.activeInteractionChange.emit(t)}onTotalInteractions(t,e){this.totalInteractionsChange.emit({total:t,sessionId:e})}flattenContent(t){let e=[];return t.forEach(n=>{e.push(n),n.children&&(e=e.concat(this.flattenContent(n.children)))}),e}get containerOffset(){return this.container.nativeElement.querySelector(".content-container").offsetTop}firstScroll=!0;handleScroll=()=>{if(this.firstScroll){this.firstScroll=!1,this.restoredPosition&&(this.currentPosition=this.restoredPosition,this.activeItemChange.emit(this.restoredPosition));return}let t=document.querySelectorAll(".content-item, .end-spacer"),e=Array.from(t).filter(o=>o.getAttribute("data-session-id")).map(o=>({contentId:o.getAttribute("data-content-id"),rectTop:o.getBoundingClientRect().top})).filter(o=>o.rectTop>=this.containerOffset&&o.rectTop<=window.innerHeight).sort((o,s)=>o.rectTop-s.rectTop).find(o=>o);e&&this.visibleSessions.add(e.contentId);let n=Array.from(t).filter(o=>o.getAttribute("data-session-id")).find(o=>{let s=o.getBoundingClientRect(),h=o.getAttribute("data-content-id");return h!=this.currentPosition&&s.bottom<=this.containerOffset&&this.shouldPreloadLast(h)});n&&!this.activeInteractionNum&&this.visibleSessions.add(n.getAttribute("data-content-id"));let a=Array.from(t).map(o=>({contentId:o.getAttribute("data-content-id"),rectTop:o.getBoundingClientRect().top})).filter(o=>o.rectTop<=this.containerOffset+1).sort((o,s)=>s.rectTop-o.rectTop)[0].contentId;a!=this.currentPosition&&(this.activeItemChange.emit(a),this.currentPosition=a,a==="book-end"&&this.bookCompleted.emit())};shouldPreloadLast(t){return this.currentPosition?this.flatContent.findIndex(e=>e.id==t)<this.flatContent.findIndex(e=>e.id==this.currentPosition):!1}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=_({type:i,selectors:[["app-book-view-content"]],viewQuery:function(e,n){if(e&1&&(Me(qo,5),Me(Fo,5)),e&2){let a;ie(a=ae())&&(n.container=a.first),ie(a=ae())&&(n.interactionLists=a)}},inputs:{content:"content",restoredPosition:"restoredPosition",restoredInteractionNum:"restoredInteractionNum"},outputs:{activeItemChange:"activeItemChange",activeInteractionChange:"activeInteractionChange",totalInteractionsChange:"totalInteractionsChange",bookCompleted:"bookCompleted"},standalone:!0,features:[j,x],decls:12,vars:3,consts:[["container",""],[1,"book-view-content"],[1,"content-container"],["class","content-item",3,"active",4,"ngFor","ngForOf"],["data-content-id","book-end",1,"end-spacer"],[1,"completion-message"],[1,"content-item"],[1,"title"],[4,"ngIf"],[3,"sessionId","interactionNum","preloadLast","scrollContainer","isActiveSession","activeInteractionChange","totalInteractions","initialLoadComplete",4,"ngIf"],[3,"activeInteractionChange","totalInteractions","initialLoadComplete","sessionId","interactionNum","preloadLast","scrollContainer","isActiveSession"]],template:function(e,n){e&1&&(c(0,"div",1,0)(2,"div",2),v(3,Ho,4,6,"div",3),c(4,"div",4)(5,"div",5)(6,"span"),u(7,"\u{1F389}"),r(),c(8,"h3"),u(9,"You've reached the end!"),r(),c(10,"p"),u(11,"Congratulations on completing this book"),r()()()()()),e&2&&(d(3),p("ngForOf",n.flatContent),d(),L("active",n.currentPosition==="book-end"))},dependencies:[w,W,O,Zi],styles:[".book-view-content[_ngcontent-%COMP%]{height:100%;overflow:auto}.book-view-content[_ngcontent-%COMP%]   .content-container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto}.book-view-content[_ngcontent-%COMP%]   .content-container[_ngcontent-%COMP%]   .end-spacer[_ngcontent-%COMP%]{height:100vh;display:flex;align-items:center;justify-content:center}.book-view-content[_ngcontent-%COMP%]   .content-container[_ngcontent-%COMP%]   .end-spacer[_ngcontent-%COMP%]   .completion-message[_ngcontent-%COMP%]{text-align:center;color:#666}.book-view-content[_ngcontent-%COMP%]   .content-container[_ngcontent-%COMP%]   .end-spacer[_ngcontent-%COMP%]   .completion-message[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:2em;display:block;margin-bottom:1rem}.book-view-content[_ngcontent-%COMP%]   .content-container[_ngcontent-%COMP%]   .end-spacer[_ngcontent-%COMP%]   .completion-message[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem}.book-view-content[_ngcontent-%COMP%]   .content-container[_ngcontent-%COMP%]   .end-spacer.active[_ngcontent-%COMP%]{background-color:#e3f2fd;border-radius:4px}.book-view-content[_ngcontent-%COMP%]   .content-item[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:1.5rem;padding:24px 0 6px;border-bottom:1px solid #eee}.book-view-content[_ngcontent-%COMP%]   .content-item[_ngcontent-%COMP%]:first-child{padding-top:36px}.book-view-content[_ngcontent-%COMP%]   .content-item.active[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{color:#007bff;border-bottom-color:#007bff}"]})};function jo(i,t){i&1&&(c(0,"span",11),u(1," \u2713 Completed "),r())}function No(i,t){if(i&1){let e=I();c(0,"span",14),g("click",function(){M(e);let a=l(2);return C(a.copyContentUrl())}),u(1),r()}if(i&2){let e=l(2);d(),T(" \xBB ",e.currentTitle," ")}}function Uo(i,t){if(i&1){let e=I();c(0,"span",15),g("click",function(){M(e);let a=l(2);return C(a.copyInteractionUrl())}),u(1),r()}if(i&2){let e=l(2);d(),ye(" \xBB ",e.activeInteraction||0," / ",e.totalInteractions," ")}}function Go(i,t){if(i&1&&v(0,No,2,1,"span",12)(1,Uo,2,2,"span",13),i&2){let e=l();p("ngIf",e.currentTitle&&e.currentPosition!=(e.content[0]==null?null:e.content[0].id)),d(),p("ngIf",e.isSessionItem&&e.activeInteraction||!1)}}function Wo(i,t){if(i&1&&(c(0,"div",16),u(1),r()),i&2){let e=l();d(),A(e.copyMessage)}}function Zo(i,t){if(i&1){let e=I();c(0,"app-book-view-toc",17),g("jumpTo",function(a){M(e);let o=l();return C(o.onJumpTo(a))}),r()}if(i&2){let e=l();p("content",e.content)("currentPosition",e.currentPosition)("currentInteraction",e.activeInteraction)("sessionInteractionCounts",e.sessionInteractionCounts)}}function $o(i,t){if(i&1){let e=I();c(0,"app-book-view-content",18),g("activeItemChange",function(a){M(e);let o=l();return C(o.onActiveItemChange(a))})("activeInteractionChange",function(a){M(e);let o=l();return C(o.onActiveInteractionChange(a))})("totalInteractionsChange",function(a){M(e);let o=l();return C(o.onTotalInteractions(a))})("bookCompleted",function(){M(e);let a=l();return C(a.onBookCompleted())}),r()}if(i&2){let e=l();p("content",e.content)("restoredPosition",e.restoredPosition)("restoredInteractionNum",e.activeInteraction||0)}}var Qi=class i{constructor(t,e){this.bookService=t;this.storageService=e;this.bookService.activeBook$.subscribe(n=>{this.book=n,this.bookService.loadBookContent({id:this.book.id,title:this.book.title})}),this.bookService.bookContent$.subscribe(n=>{if(this.content=n,this.book?.id){let a=this.storageService.getBookPosition(this.book.id);a&&a.contentId?this.findItem(a.contentId)?(this.restoredPosition=a.contentId,this.onActiveItemChange(this.restoredPosition),a.interactionNum&&this.onActiveInteractionChange(parseInt(a.interactionNum))):this.onActiveItemChange(n[0].id):this.onActiveItemChange(n[0].id)}})}book;showToc=!1;content=[];currentPosition;restoredPosition;currentTitle;sessionInteractionCounts=new Map;currentItem;isSessionItem=!1;totalInteractions;activeInteraction;onJumpTo(t){console.log(t),this.restoredPosition=t.contentId,this.activeInteraction=t.interactionNum||void 0,this.storageService.saveBookPosition(this.book?.id,{contentId:t.contentId,interactionNum:t.interactionNum?t.interactionNum.toString():void 0}),this.showToc=!1}onActiveItemChange(t){t!=this.currentPosition&&(this.currentPosition=t,this.currentItem=this.findItem(t),this.isSessionItem=!!this.currentItem&&!!this.currentItem.sessionId,this.totalInteractions=this.isSessionItem?this.sessionInteractionCounts.get(this.currentItem.sessionId.toString()):void 0,this.currentTitle=this.currentItem?.title,this.activeInteraction=void 0,this.storageService.saveBookPosition(this.book?.id,{contentId:t}))}onActiveInteractionChange(t){this.activeInteraction=t,this.currentItem?.sessionId&&this.storageService.saveBookPosition(this.book?.id,{contentId:this.currentPosition,interactionNum:t.toString()})}onTotalInteractions(t){this.sessionInteractionCounts.set(t.sessionId,t.total),this.isSessionItem&&this.currentItem?.sessionId==t.sessionId&&(this.totalInteractions=t.total)}toggleView(){this.showToc=!this.showToc}findItem(t){let e=n=>{for(let a of n){if(a.id==t)return a;if(a.children){let o=e(a.children);if(o)return o}}};return e(this.content)}onBookCompleted(){this.storageService.saveBookPosition(this.book?.id,{completed:!0})}copyMessage="";showCopyMessage(t){this.copyMessage=`${t} URL copied to clipboard`,setTimeout(()=>this.copyMessage="",2e3)}copyBookUrl(){let t=`${window.location.origin}/book/${this.book?.id}`;navigator.clipboard.writeText(t),this.showCopyMessage("Book")}copyContentUrl(){let t=`${window.location.origin}/book/${this.book?.id}/${this.currentPosition}`;navigator.clipboard.writeText(t),this.showCopyMessage("Section")}copyInteractionUrl(){let t=`${window.location.origin}/book/${this.book?.id}/${this.currentPosition}/${this.activeInteraction}`;navigator.clipboard.writeText(t),this.showCopyMessage("Interaction")}static \u0275fac=function(e){return new(e||i)(m(xe),m(Dt))};static \u0275cmp=_({type:i,selectors:[["app-book-view"]],standalone:!0,features:[x],decls:17,vars:7,consts:[["notCompleted",""],[1,"book-view"],[1,"header-content"],["routerLink","/",1,"back-link"],["title","Click to copy book URL",1,"copyable",3,"click"],["class","completed-badge",4,"ngIf","ngIfElse"],["class","copy-message",4,"ngIf"],[1,"view-toggle",3,"click"],[1,"view-content"],[3,"content","currentPosition","currentInteraction","sessionInteractionCounts","jumpTo",4,"ngIf"],[3,"content","restoredPosition","restoredInteractionNum","activeItemChange","activeInteractionChange","totalInteractionsChange","bookCompleted",4,"ngIf"],[1,"completed-badge"],["class","current-item copyable","title","Click to copy URL to this section",3,"click",4,"ngIf"],["class","current-item copyable","title","Click to copy URL to this interaction",3,"click",4,"ngIf"],["title","Click to copy URL to this section",1,"current-item","copyable",3,"click"],["title","Click to copy URL to this interaction",1,"current-item","copyable",3,"click"],[1,"copy-message"],[3,"jumpTo","content","currentPosition","currentInteraction","sessionInteractionCounts"],[3,"activeItemChange","activeInteractionChange","totalInteractionsChange","bookCompleted","content","restoredPosition","restoredInteractionNum"]],template:function(e,n){if(e&1){let a=I();c(0,"div",1)(1,"header")(2,"div",2)(3,"a",3),u(4,"\u2190 Back"),r(),c(5,"h1")(6,"span",4),g("click",function(){return M(a),C(n.copyBookUrl())}),u(7),r(),v(8,jo,2,0,"span",5)(9,Go,2,2,"ng-template",null,0,Y),r()(),v(11,Wo,2,1,"div",6),c(12,"button",7),g("click",function(){return M(a),C(n.toggleView())}),u(13),r()(),c(14,"div",8),v(15,Zo,1,4,"app-book-view-toc",9)(16,$o,1,3,"app-book-view-content",10),r()()}if(e&2){let a=R(10);d(7),T(" ",n.book==null?null:n.book.title," "),d(),p("ngIf",n.currentPosition==="book-end")("ngIfElse",a),d(3),p("ngIf",n.copyMessage),d(2),T(" ",n.showToc?"Read":"Contents"," "),d(2),p("ngIf",n.showToc),d(),p("ngIf",!n.showToc)}},dependencies:[w,O,At,Ot,Ri],styles:[".book-view[_ngcontent-%COMP%]{height:100vh;display:flex;flex-direction:column}.book-view[_ngcontent-%COMP%]   .view-toggle[_ngcontent-%COMP%]{align-self:flex-end;margin:10px}.book-view[_ngcontent-%COMP%]   .view-content[_ngcontent-%COMP%]{flex:1;overflow:auto}.book-view[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]{padding:1rem;background:#f5f5f5;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center;position:relative}.book-view[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.book-view[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]   .back-link[_ngcontent-%COMP%]{text-decoration:none;color:#333;font-size:.9em}.book-view[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]   .back-link[_ngcontent-%COMP%]:hover{color:#007bff}.book-view[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0;font-size:1.2rem}.book-view[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   .current-item[_ngcontent-%COMP%]{color:#666;font-size:.9em;margin-left:8px}.book-view[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   .copyable[_ngcontent-%COMP%]{cursor:pointer}.book-view[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   .copyable[_ngcontent-%COMP%]:hover{color:#007bff}.book-view[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   .current-item.copyable[_ngcontent-%COMP%]:hover{color:#007bff}.book-view[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]   .copy-message[_ngcontent-%COMP%]{color:#28a745;font-size:.9em;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:1;background:#fff;padding:4px 8px;border-radius:4px;box-shadow:0 2px 4px #0000001a}.book-view[_ngcontent-%COMP%]   .content-container[_ngcontent-%COMP%]{flex:1;overflow:auto}.book-view[_ngcontent-%COMP%]   .completed-badge[_ngcontent-%COMP%]{color:#28a745;font-size:.9em;margin-left:8px;font-weight:400}"]})};var Xo=["*"],Ne=class i{title;active=!1;sticky=!1;static \u0275fac=function(e){return new(e||i)};static \u0275cmp=_({type:i,selectors:[["app-tab-item"]],inputs:{title:[0,"tabTitle","title"],active:"active",sticky:"sticky"},standalone:!0,features:[x],ngContentSelectors:Xo,decls:2,vars:2,consts:[[1,"pane"]],template:function(e,n){e&1&&(de(),c(0,"div",0),he(1),r()),e&2&&L("displayNone",!n.active)},dependencies:[w],styles:[".displayNone[_ngcontent-%COMP%]{display:none}.pane[_ngcontent-%COMP%]{padding:0}"]})};var Ko=["*"];function Qo(i,t){if(i&1){let e=I();c(0,"div",4),g("click",function(){let a=M(e).$implicit,o=l();return C(o.selectTab(a))}),u(1),r()}if(i&2){let e=t.$implicit,n=l();L("active",e.active)("disabled",n.disableTabChange),d(),T(" ",e.title," ")}}var Tt=class i{isSticky=!1;disableTabChange=!1;tabs;ngAfterContentInit(){this.tabs.filter(e=>e.active).length===0&&this.selectTab(this.tabs.first)}selectTab(t){this.disableTabChange||(this.tabs.toArray().forEach(e=>e.active=!1),this.isSticky=t.sticky,t.active=!0)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=_({type:i,selectors:[["app-tab-view"]],contentQueries:function(e,n,a){if(e&1&&xt(a,Ne,4),e&2){let o;ie(o=ae())&&(n.tabs=o)}},inputs:{disableTabChange:"disableTabChange"},standalone:!0,features:[x],ngContentSelectors:Ko,decls:5,vars:3,consts:[[1,"tab-container"],[1,"tab-header"],["class","tab",3,"active","disabled","click",4,"ngFor","ngForOf"],[1,"tab-content"],[1,"tab",3,"click"]],template:function(e,n){e&1&&(de(),c(0,"div",0)(1,"div",1),v(2,Qo,2,5,"div",2),r(),c(3,"div",3),he(4),r()()),e&2&&(d(2),p("ngForOf",n.tabs),d(),L("stickyContent",n.isSticky))},dependencies:[w,W],styles:[".tab-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.tab-container[_ngcontent-%COMP%]     .tab-header{position:sticky;top:0;z-index:10;border-bottom:1px solid #eee;display:flex}.tab-container[_ngcontent-%COMP%]     .stickyContent{position:sticky;top:48px}.tab-container[_ngcontent-%COMP%]     .tab{padding:8px 16px;cursor:pointer}.tab-container[_ngcontent-%COMP%]     .tab.disabled:not(.active){color:#999;cursor:not-allowed}.tab-container[_ngcontent-%COMP%]     .tab.active{border-bottom:2px solid #333;cursor:default}.tab-container[_ngcontent-%COMP%]   .tab-content[_ngcontent-%COMP%]{position:relative;top:0}.tab-container[_ngcontent-%COMP%]   .tab-content.stickyContent[_ngcontent-%COMP%]{position:sticky;top:48px}.tab-container[_ngcontent-%COMP%]   .tab-content[_ngcontent-%COMP%]     [tab-content]:not(.active){display:none}"]})};var Jo=["*"];function Yo(i,t){i&1&&(X(0),he(1),K())}var Vt=class i{constructor(t){this.elementRef=t}isExpanded=!0;expandedChange=new f;toggleSidebar(){this.isExpanded=!this.isExpanded,this.expandedChange.emit(this.isExpanded)}ngAfterViewInit(){this.updateSidebarHeight()}updateSidebarHeight(){let t=this.elementRef.nativeElement.querySelector(".sidebar"),e=t.getBoundingClientRect(),n=window.innerHeight-e.top;t.style.height=`${n}px`}static \u0275fac=function(e){return new(e||i)(m(N))};static \u0275cmp=_({type:i,selectors:[["app-sidebar"]],hostBindings:function(e,n){e&1&&g("resize",function(){return n.updateSidebarHeight()},!1,Li)},inputs:{isExpanded:"isExpanded"},outputs:{expandedChange:"expandedChange"},standalone:!0,features:[x],ngContentSelectors:Jo,decls:6,vars:4,consts:[[1,"sidebar"],[1,"sidebar-header"],[1,"toggle-btn",3,"click"],[1,"sidebar-content"],[4,"ngIf"]],template:function(e,n){e&1&&(de(),c(0,"div",0)(1,"div",1)(2,"button",2),g("click",function(){return n.toggleSidebar()}),u(3),r()(),c(4,"div",3),v(5,Yo,2,0,"ng-container",4),r()()),e&2&&(L("expanded",n.isExpanded),d(3),T(" ",n.isExpanded?"\u2190":"\u2192"," "),d(2),p("ngIf",n.isExpanded))},dependencies:[w,O],styles:[".sidebar[_ngcontent-%COMP%]{transition:width .3s ease;background:#f5f5f5;border-right:1px solid #ddd}.sidebar.expanded[_ngcontent-%COMP%]{width:250px}.sidebar[_ngcontent-%COMP%]:not(.expanded){width:50px}.sidebar-header[_ngcontent-%COMP%]{padding:8px;border-bottom:1px solid #ddd}.toggle-btn[_ngcontent-%COMP%]{cursor:pointer;border:none;background:none;padding:4px 8px}.sidebar-content[_ngcontent-%COMP%]{overflow:hidden}"]})};function Et(i,t=0){return es(i)?Number(i):arguments.length===2?t:0}function es(i){return!isNaN(parseFloat(i))&&!isNaN(Number(i))}function Ji(i){return Array.isArray(i)?i:[i]}function ue(i){return i instanceof N?i.nativeElement:i}var Hn;try{Hn=typeof Intl<"u"&&Intl.v8BreakIterator}catch{Hn=!1}var Rn=(()=>{class i{constructor(e){this._platformId=e,this.isBrowser=this._platformId?Hi(this._platformId):typeof document=="object"&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!!(window.chrome||Hn)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}static{this.\u0275fac=function(n){return new(n||i)(G(Ii))}}static{this.\u0275prov=$({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var nt;function ts(){if(nt==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>nt=!0}))}finally{nt=nt||!1}return nt}function it(i){return ts()?i:!!i.capture}var Bn;function ns(){if(Bn==null){let i=typeof document<"u"?document.head:null;Bn=!!(i&&(i.createShadowRoot||i.attachShadow))}return Bn}function qt(i){if(ns()){let t=i.getRootNode?i.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}function at(i){return i.composedPath?i.composedPath()[0]:i.target}var as=new Z("cdk-dir-doc",{providedIn:"root",factory:os});function os(){return Ae(me)}var ss=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function rs(i){let t=i?.toLowerCase()||"";return t==="auto"&&typeof navigator<"u"&&navigator?.language?ss.test(navigator.language)?"rtl":"ltr":t==="rtl"?"rtl":"ltr"}var jn=(()=>{class i{constructor(e){if(this.value="ltr",this.change=new f,e){let n=e.body?e.body.dir:null,a=e.documentElement?e.documentElement.dir:null;this.value=rs(n||a||"ltr")}}ngOnDestroy(){this.change.complete()}static{this.\u0275fac=function(n){return new(n||i)(G(as,8))}}static{this.\u0275prov=$({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var hs=20,Yi=(()=>{class i{constructor(e,n,a){this._ngZone=e,this._platform=n,this._scrolled=new q,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=a}register(e){this.scrollContainers.has(e)||this.scrollContainers.set(e,e.elementScrolled().subscribe(()=>this._scrolled.next(e)))}deregister(e){let n=this.scrollContainers.get(e);n&&(n.unsubscribe(),this.scrollContainers.delete(e))}scrolled(e=hs){return this._platform.isBrowser?new Je(n=>{this._globalSubscription||this._addGlobalListener();let a=e>0?this._scrolled.pipe(Pn(e)).subscribe(n):this._scrolled.subscribe(n);return this._scrolledCount++,()=>{a.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):gi()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((e,n)=>this.deregister(n)),this._scrolled.complete()}ancestorScrolled(e,n){let a=this.getAncestorScrollContainers(e);return this.scrolled(n).pipe(Ci(o=>!o||a.indexOf(o)>-1))}getAncestorScrollContainers(e){let n=[];return this.scrollContainers.forEach((a,o)=>{this._scrollableContainsElement(o,e)&&n.push(o)}),n}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(e,n){let a=ue(n),o=e.getElementRef().nativeElement;do if(a==o)return!0;while(a=a.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>{let e=this._getWindow();return vi(e.document,"scroll").subscribe(()=>this._scrolled.next())})}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}static{this.\u0275fac=function(n){return new(n||i)(G(Oe),G(Rn),G(me,8))}}static{this.\u0275prov=$({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var ls=20,ea=(()=>{class i{constructor(e,n,a){this._platform=e,this._change=new q,this._changeListener=o=>{this._change.next(o)},this._document=a,n.runOutsideAngular(()=>{if(e.isBrowser){let o=this._getWindow();o.addEventListener("resize",this._changeListener),o.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){let e=this._getWindow();e.removeEventListener("resize",this._changeListener),e.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let e={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),e}getViewportRect(){let e=this.getViewportScrollPosition(),{width:n,height:a}=this.getViewportSize();return{top:e.top,left:e.left,bottom:e.top+a,right:e.left+n,height:a,width:n}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let e=this._document,n=this._getWindow(),a=e.documentElement,o=a.getBoundingClientRect(),s=-o.top||e.body.scrollTop||n.scrollY||a.scrollTop||0,h=-o.left||e.body.scrollLeft||n.scrollX||a.scrollLeft||0;return{top:s,left:h}}change(e=ls){return e>0?this._change.pipe(Pn(e)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let e=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:e.innerWidth,height:e.innerHeight}:{width:0,height:0}}static{this.\u0275fac=function(n){return new(n||i)(G(Rn),G(Oe),G(me,8))}}static{this.\u0275prov=$({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var ta=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=ne({type:i})}static{this.\u0275inj=te({})}}return i})();function na(i){return i.buttons===0||i.detail===0}function ia(i){let t=i.touches&&i.touches[0]||i.changedTouches&&i.changedTouches[0];return!!t&&t.identifier===-1&&(t.radiusX==null||t.radiusX===1)&&(t.radiusY==null||t.radiusY===1)}function Ca(i){let t=i.cloneNode(!0),e=t.querySelectorAll("[id]"),n=i.nodeName.toLowerCase();t.removeAttribute("id");for(let a=0;a<e.length;a++)e[a].removeAttribute("id");return n==="canvas"?sa(i,t):(n==="input"||n==="select"||n==="textarea")&&oa(i,t),aa("canvas",i,t,sa),aa("input, textarea, select",i,t,oa),t}function aa(i,t,e,n){let a=t.querySelectorAll(i);if(a.length){let o=e.querySelectorAll(i);for(let s=0;s<a.length;s++)n(a[s],o[s])}}var us=0;function oa(i,t){t.type!=="file"&&(t.value=i.value),t.type==="radio"&&t.name&&(t.name=`mat-clone-${t.name}-${us++}`)}function sa(i,t){let e=t.getContext("2d");if(e)try{e.drawImage(i,0,0)}catch{}}function Xn(i){let t=i.getBoundingClientRect();return{top:t.top,right:t.right,bottom:t.bottom,left:t.left,width:t.width,height:t.height,x:t.x,y:t.y}}function Un(i,t,e){let{top:n,bottom:a,left:o,right:s}=i;return e>=n&&e<=a&&t>=o&&t<=s}function st(i,t,e){i.top+=t,i.bottom=i.top+i.height,i.left+=e,i.right=i.left+i.width}function ra(i,t,e,n){let{top:a,right:o,bottom:s,left:h,width:k,height:y}=i,b=k*t,P=y*t;return n>a-P&&n<s+P&&e>h-b&&e<o+b}var Ht=class{constructor(t){this._document=t,this.positions=new Map}clear(){this.positions.clear()}cache(t){this.clear(),this.positions.set(this._document,{scrollPosition:this.getViewportScrollPosition()}),t.forEach(e=>{this.positions.set(e,{scrollPosition:{top:e.scrollTop,left:e.scrollLeft},clientRect:Xn(e)})})}handleScroll(t){let e=at(t),n=this.positions.get(e);if(!n)return null;let a=n.scrollPosition,o,s;if(e===this._document){let y=this.getViewportScrollPosition();o=y.top,s=y.left}else o=e.scrollTop,s=e.scrollLeft;let h=a.top-o,k=a.left-s;return this.positions.forEach((y,b)=>{y.clientRect&&e!==b&&e.contains(b)&&st(y.clientRect,h,k)}),a.top=o,a.left=s,{top:h,left:k}}getViewportScrollPosition(){return{top:window.scrollY,left:window.scrollX}}};function _a(i,t){let e=i.rootNodes;if(e.length===1&&e[0].nodeType===t.ELEMENT_NODE)return e[0];let n=t.createElement("div");return e.forEach(a=>n.appendChild(a)),n}function Kn(i,t,e){for(let n in t)if(t.hasOwnProperty(n)){let a=t[n];a?i.setProperty(n,a,e?.has(n)?"important":""):i.removeProperty(n)}return i}function Ue(i,t){let e=t?"":"none";Kn(i.style,{"touch-action":t?"":"none","-webkit-user-drag":t?"":"none","-webkit-tap-highlight-color":t?"":"transparent","user-select":e,"-ms-user-select":e,"-webkit-user-select":e,"-moz-user-select":e})}function ca(i,t,e){Kn(i.style,{position:t?"":"fixed",top:t?"":"0",opacity:t?"":"0",left:t?"":"-999em"},e)}function Rt(i,t){return t&&t!="none"?i+" "+t:i}function da(i,t){i.style.width=`${t.width}px`,i.style.height=`${t.height}px`,i.style.transform=jt(t.left,t.top)}function jt(i,t){return`translate3d(${Math.round(i)}px, ${Math.round(t)}px, 0)`}function ha(i){let t=i.toLowerCase().indexOf("ms")>-1?1:1e3;return parseFloat(i)*t}function ys(i){let t=getComputedStyle(i),e=Nn(t,"transition-property"),n=e.find(h=>h==="transform"||h==="all");if(!n)return 0;let a=e.indexOf(n),o=Nn(t,"transition-duration"),s=Nn(t,"transition-delay");return ha(o[a])+ha(s[a])}function Nn(i,t){return i.getPropertyValue(t).split(",").map(n=>n.trim())}var ks=new Set(["position"]),Gn=class{get element(){return this._preview}constructor(t,e,n,a,o,s,h,k,y){this._document=t,this._rootElement=e,this._direction=n,this._initialDomRect=a,this._previewTemplate=o,this._previewClass=s,this._pickupPositionOnPage=h,this._initialTransform=k,this._zIndex=y}attach(t){this._preview=this._createPreview(),t.appendChild(this._preview),la(this._preview)&&this._preview.showPopover()}destroy(){this._preview.remove(),this._previewEmbeddedView?.destroy(),this._preview=this._previewEmbeddedView=null}setTransform(t){this._preview.style.transform=t}getBoundingClientRect(){return this._preview.getBoundingClientRect()}addClass(t){this._preview.classList.add(t)}getTransitionDuration(){return ys(this._preview)}addEventListener(t,e){this._preview.addEventListener(t,e)}removeEventListener(t,e){this._preview.removeEventListener(t,e)}_createPreview(){let t=this._previewTemplate,e=this._previewClass,n=t?t.template:null,a;if(n&&t){let o=t.matchSize?this._initialDomRect:null,s=t.viewContainer.createEmbeddedView(n,t.context);s.detectChanges(),a=_a(s,this._document),this._previewEmbeddedView=s,t.matchSize?da(a,o):a.style.transform=jt(this._pickupPositionOnPage.x,this._pickupPositionOnPage.y)}else a=Ca(this._rootElement),da(a,this._initialDomRect),this._initialTransform&&(a.style.transform=this._initialTransform);return Kn(a.style,{"pointer-events":"none",margin:la(a)?"0 auto 0 0":"0",position:"fixed",top:"0",left:"0","z-index":this._zIndex+""},ks),Ue(a,!1),a.classList.add("cdk-drag-preview"),a.setAttribute("popover","manual"),a.setAttribute("dir",this._direction),e&&(Array.isArray(e)?e.forEach(o=>a.classList.add(o)):a.classList.add(e)),a}};function la(i){return"showPopover"in i}var pa=it({passive:!0}),Ft=it({passive:!1}),ua=it({passive:!1,capture:!0}),ms=800,ya=new Set(["position"]),Wn=class{get disabled(){return this._disabled||!!(this._dropContainer&&this._dropContainer.disabled)}set disabled(t){t!==this._disabled&&(this._disabled=t,this._toggleNativeDragInteractions(),this._handles.forEach(e=>Ue(e,t)))}constructor(t,e,n,a,o,s){this._config=e,this._document=n,this._ngZone=a,this._viewportRuler=o,this._dragDropRegistry=s,this._passiveTransform={x:0,y:0},this._activeTransform={x:0,y:0},this._hasStartedDragging=ve(!1),this._moveEvents=new q,this._pointerMoveSubscription=Pe.EMPTY,this._pointerUpSubscription=Pe.EMPTY,this._scrollSubscription=Pe.EMPTY,this._resizeSubscription=Pe.EMPTY,this._boundaryElement=null,this._nativeInteractionsEnabled=!0,this._handles=[],this._disabledHandles=new Set,this._direction="ltr",this.dragStartDelay=0,this.scale=1,this._disabled=!1,this.beforeStarted=new q,this.started=new q,this.released=new q,this.ended=new q,this.entered=new q,this.exited=new q,this.dropped=new q,this.moved=this._moveEvents,this._pointerDown=h=>{if(this.beforeStarted.next(),this._handles.length){let k=this._getTargetHandle(h);k&&!this._disabledHandles.has(k)&&!this.disabled&&this._initializeDragSequence(k,h)}else this.disabled||this._initializeDragSequence(this._rootElement,h)},this._pointerMove=h=>{let k=this._getPointerPositionOnPage(h);if(!this._hasStartedDragging()){let b=Math.abs(k.x-this._pickupPositionOnPage.x),P=Math.abs(k.y-this._pickupPositionOnPage.y);if(b+P>=this._config.dragStartThreshold){let ee=Date.now()>=this._dragStartTime+this._getDragStartDelay(h),le=this._dropContainer;if(!ee){this._endDragSequence(h);return}(!le||!le.isDragging()&&!le.isReceiving())&&(h.cancelable&&h.preventDefault(),this._hasStartedDragging.set(!0),this._ngZone.run(()=>this._startDragSequence(h)))}return}h.cancelable&&h.preventDefault();let y=this._getConstrainedPointerPosition(k);if(this._hasMoved=!0,this._lastKnownPointerPosition=k,this._updatePointerDirectionDelta(y),this._dropContainer)this._updateActiveDropContainer(y,k);else{let b=this.constrainPosition?this._initialDomRect:this._pickupPositionOnPage,P=this._activeTransform;P.x=y.x-b.x+this._passiveTransform.x,P.y=y.y-b.y+this._passiveTransform.y,this._applyRootElementTransform(P.x,P.y)}this._moveEvents.observers.length&&this._ngZone.run(()=>{this._moveEvents.next({source:this,pointerPosition:y,event:h,distance:this._getDragDistance(y),delta:this._pointerDirectionDelta})})},this._pointerUp=h=>{this._endDragSequence(h)},this._nativeDragStart=h=>{if(this._handles.length){let k=this._getTargetHandle(h);k&&!this._disabledHandles.has(k)&&!this.disabled&&h.preventDefault()}else this.disabled||h.preventDefault()},this.withRootElement(t).withParent(e.parentDragRef||null),this._parentPositions=new Ht(n),s.registerDragItem(this)}getPlaceholderElement(){return this._placeholder}getRootElement(){return this._rootElement}getVisibleElement(){return this.isDragging()?this.getPlaceholderElement():this.getRootElement()}withHandles(t){this._handles=t.map(n=>ue(n)),this._handles.forEach(n=>Ue(n,this.disabled)),this._toggleNativeDragInteractions();let e=new Set;return this._disabledHandles.forEach(n=>{this._handles.indexOf(n)>-1&&e.add(n)}),this._disabledHandles=e,this}withPreviewTemplate(t){return this._previewTemplate=t,this}withPlaceholderTemplate(t){return this._placeholderTemplate=t,this}withRootElement(t){let e=ue(t);return e!==this._rootElement&&(this._rootElement&&this._removeRootElementListeners(this._rootElement),this._ngZone.runOutsideAngular(()=>{e.addEventListener("mousedown",this._pointerDown,Ft),e.addEventListener("touchstart",this._pointerDown,pa),e.addEventListener("dragstart",this._nativeDragStart,Ft)}),this._initialTransform=void 0,this._rootElement=e),typeof SVGElement<"u"&&this._rootElement instanceof SVGElement&&(this._ownerSVGElement=this._rootElement.ownerSVGElement),this}withBoundaryElement(t){return this._boundaryElement=t?ue(t):null,this._resizeSubscription.unsubscribe(),t&&(this._resizeSubscription=this._viewportRuler.change(10).subscribe(()=>this._containInsideBoundaryOnResize())),this}withParent(t){return this._parentDragRef=t,this}dispose(){this._removeRootElementListeners(this._rootElement),this.isDragging()&&this._rootElement?.remove(),this._anchor?.remove(),this._destroyPreview(),this._destroyPlaceholder(),this._dragDropRegistry.removeDragItem(this),this._removeListeners(),this.beforeStarted.complete(),this.started.complete(),this.released.complete(),this.ended.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this._moveEvents.complete(),this._handles=[],this._disabledHandles.clear(),this._dropContainer=void 0,this._resizeSubscription.unsubscribe(),this._parentPositions.clear(),this._boundaryElement=this._rootElement=this._ownerSVGElement=this._placeholderTemplate=this._previewTemplate=this._anchor=this._parentDragRef=null}isDragging(){return this._hasStartedDragging()&&this._dragDropRegistry.isDragging(this)}reset(){this._rootElement.style.transform=this._initialTransform||"",this._activeTransform={x:0,y:0},this._passiveTransform={x:0,y:0}}disableHandle(t){!this._disabledHandles.has(t)&&this._handles.indexOf(t)>-1&&(this._disabledHandles.add(t),Ue(t,!0))}enableHandle(t){this._disabledHandles.has(t)&&(this._disabledHandles.delete(t),Ue(t,this.disabled))}withDirection(t){return this._direction=t,this}_withDropContainer(t){this._dropContainer=t}getFreeDragPosition(){let t=this.isDragging()?this._activeTransform:this._passiveTransform;return{x:t.x,y:t.y}}setFreeDragPosition(t){return this._activeTransform={x:0,y:0},this._passiveTransform.x=t.x,this._passiveTransform.y=t.y,this._dropContainer||this._applyRootElementTransform(t.x,t.y),this}withPreviewContainer(t){return this._previewContainer=t,this}_sortFromLastPointerPosition(){let t=this._lastKnownPointerPosition;t&&this._dropContainer&&this._updateActiveDropContainer(this._getConstrainedPointerPosition(t),t)}_removeListeners(){this._pointerMoveSubscription.unsubscribe(),this._pointerUpSubscription.unsubscribe(),this._scrollSubscription.unsubscribe(),this._getShadowRoot()?.removeEventListener("selectstart",ma,ua)}_destroyPreview(){this._preview?.destroy(),this._preview=null}_destroyPlaceholder(){this._placeholder?.remove(),this._placeholderRef?.destroy(),this._placeholder=this._placeholderRef=null}_endDragSequence(t){if(this._dragDropRegistry.isDragging(this)&&(this._removeListeners(),this._dragDropRegistry.stopDragging(this),this._toggleNativeDragInteractions(),this._handles&&(this._rootElement.style.webkitTapHighlightColor=this._rootElementTapHighlight),!!this._hasStartedDragging()))if(this.released.next({source:this,event:t}),this._dropContainer)this._dropContainer._stopScrolling(),this._animatePreviewToPlaceholder().then(()=>{this._cleanupDragArtifacts(t),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)});else{this._passiveTransform.x=this._activeTransform.x;let e=this._getPointerPositionOnPage(t);this._passiveTransform.y=this._activeTransform.y,this._ngZone.run(()=>{this.ended.next({source:this,distance:this._getDragDistance(e),dropPoint:e,event:t})}),this._cleanupCachedDimensions(),this._dragDropRegistry.stopDragging(this)}}_startDragSequence(t){ot(t)&&(this._lastTouchEventTime=Date.now()),this._toggleNativeDragInteractions();let e=this._getShadowRoot(),n=this._dropContainer;if(e&&this._ngZone.runOutsideAngular(()=>{e.addEventListener("selectstart",ma,ua)}),n){let a=this._rootElement,o=a.parentNode,s=this._placeholder=this._createPlaceholderElement(),h=this._anchor=this._anchor||this._document.createComment("");o.insertBefore(h,a),this._initialTransform=a.style.transform||"",this._preview=new Gn(this._document,this._rootElement,this._direction,this._initialDomRect,this._previewTemplate||null,this.previewClass||null,this._pickupPositionOnPage,this._initialTransform,this._config.zIndex||1e3),this._preview.attach(this._getPreviewInsertionPoint(o,e)),ca(a,!1,ya),this._document.body.appendChild(o.replaceChild(s,a)),this.started.next({source:this,event:t}),n.start(),this._initialContainer=n,this._initialIndex=n.getItemIndex(this)}else this.started.next({source:this,event:t}),this._initialContainer=this._initialIndex=void 0;this._parentPositions.cache(n?n.getScrollableParents():[])}_initializeDragSequence(t,e){this._parentDragRef&&e.stopPropagation();let n=this.isDragging(),a=ot(e),o=!a&&e.button!==0,s=this._rootElement,h=at(e),k=!a&&this._lastTouchEventTime&&this._lastTouchEventTime+ms>Date.now(),y=a?ia(e):na(e);if(h&&h.draggable&&e.type==="mousedown"&&e.preventDefault(),n||o||k||y)return;if(this._handles.length){let F=s.style;this._rootElementTapHighlight=F.webkitTapHighlightColor||"",F.webkitTapHighlightColor="transparent"}this._hasMoved=!1,this._hasStartedDragging.set(this._hasMoved),this._removeListeners(),this._initialDomRect=this._rootElement.getBoundingClientRect(),this._pointerMoveSubscription=this._dragDropRegistry.pointerMove.subscribe(this._pointerMove),this._pointerUpSubscription=this._dragDropRegistry.pointerUp.subscribe(this._pointerUp),this._scrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(F=>this._updateOnScroll(F)),this._boundaryElement&&(this._boundaryRect=Xn(this._boundaryElement));let b=this._previewTemplate;this._pickupPositionInElement=b&&b.template&&!b.matchSize?{x:0,y:0}:this._getPointerPositionInElement(this._initialDomRect,t,e);let P=this._pickupPositionOnPage=this._lastKnownPointerPosition=this._getPointerPositionOnPage(e);this._pointerDirectionDelta={x:0,y:0},this._pointerPositionAtLastDirectionChange={x:P.x,y:P.y},this._dragStartTime=Date.now(),this._dragDropRegistry.startDragging(this,e)}_cleanupDragArtifacts(t){ca(this._rootElement,!0,ya),this._anchor.parentNode.replaceChild(this._rootElement,this._anchor),this._destroyPreview(),this._destroyPlaceholder(),this._initialDomRect=this._boundaryRect=this._previewRect=this._initialTransform=void 0,this._ngZone.run(()=>{let e=this._dropContainer,n=e.getItemIndex(this),a=this._getPointerPositionOnPage(t),o=this._getDragDistance(a),s=e._isOverContainer(a.x,a.y);this.ended.next({source:this,distance:o,dropPoint:a,event:t}),this.dropped.next({item:this,currentIndex:n,previousIndex:this._initialIndex,container:e,previousContainer:this._initialContainer,isPointerOverContainer:s,distance:o,dropPoint:a,event:t}),e.drop(this,n,this._initialIndex,this._initialContainer,s,o,a,t),this._dropContainer=this._initialContainer})}_updateActiveDropContainer({x:t,y:e},{x:n,y:a}){let o=this._initialContainer._getSiblingContainerFromPosition(this,t,e);!o&&this._dropContainer!==this._initialContainer&&this._initialContainer._isOverContainer(t,e)&&(o=this._initialContainer),o&&o!==this._dropContainer&&this._ngZone.run(()=>{this.exited.next({item:this,container:this._dropContainer}),this._dropContainer.exit(this),this._dropContainer=o,this._dropContainer.enter(this,t,e,o===this._initialContainer&&o.sortingDisabled?this._initialIndex:void 0),this.entered.next({item:this,container:o,currentIndex:o.getItemIndex(this)})}),this.isDragging()&&(this._dropContainer._startScrollingIfNecessary(n,a),this._dropContainer._sortItem(this,t,e,this._pointerDirectionDelta),this.constrainPosition?this._applyPreviewTransform(t,e):this._applyPreviewTransform(t-this._pickupPositionInElement.x,e-this._pickupPositionInElement.y))}_animatePreviewToPlaceholder(){if(!this._hasMoved)return Promise.resolve();let t=this._placeholder.getBoundingClientRect();this._preview.addClass("cdk-drag-animating"),this._applyPreviewTransform(t.left,t.top);let e=this._preview.getTransitionDuration();return e===0?Promise.resolve():this._ngZone.runOutsideAngular(()=>new Promise(n=>{let a=s=>{(!s||this._preview&&at(s)===this._preview.element&&s.propertyName==="transform")&&(this._preview?.removeEventListener("transitionend",a),n(),clearTimeout(o))},o=setTimeout(a,e*1.5);this._preview.addEventListener("transitionend",a)}))}_createPlaceholderElement(){let t=this._placeholderTemplate,e=t?t.template:null,n;return e?(this._placeholderRef=t.viewContainer.createEmbeddedView(e,t.context),this._placeholderRef.detectChanges(),n=_a(this._placeholderRef,this._document)):n=Ca(this._rootElement),n.style.pointerEvents="none",n.classList.add("cdk-drag-placeholder"),n}_getPointerPositionInElement(t,e,n){let a=e===this._rootElement?null:e,o=a?a.getBoundingClientRect():t,s=ot(n)?n.targetTouches[0]:n,h=this._getViewportScrollPosition(),k=s.pageX-o.left-h.left,y=s.pageY-o.top-h.top;return{x:o.left-t.left+k,y:o.top-t.top+y}}_getPointerPositionOnPage(t){let e=this._getViewportScrollPosition(),n=ot(t)?t.touches[0]||t.changedTouches[0]||{pageX:0,pageY:0}:t,a=n.pageX-e.left,o=n.pageY-e.top;if(this._ownerSVGElement){let s=this._ownerSVGElement.getScreenCTM();if(s){let h=this._ownerSVGElement.createSVGPoint();return h.x=a,h.y=o,h.matrixTransform(s.inverse())}}return{x:a,y:o}}_getConstrainedPointerPosition(t){let e=this._dropContainer?this._dropContainer.lockAxis:null,{x:n,y:a}=this.constrainPosition?this.constrainPosition(t,this,this._initialDomRect,this._pickupPositionInElement):t;if(this.lockAxis==="x"||e==="x"?a=this._pickupPositionOnPage.y-(this.constrainPosition?this._pickupPositionInElement.y:0):(this.lockAxis==="y"||e==="y")&&(n=this._pickupPositionOnPage.x-(this.constrainPosition?this._pickupPositionInElement.x:0)),this._boundaryRect){let{x:o,y:s}=this.constrainPosition?{x:0,y:0}:this._pickupPositionInElement,h=this._boundaryRect,{width:k,height:y}=this._getPreviewRect(),b=h.top+s,P=h.bottom-(y-s),F=h.left+o,ee=h.right-(k-o);n=ka(n,F,ee),a=ka(a,b,P)}return{x:n,y:a}}_updatePointerDirectionDelta(t){let{x:e,y:n}=t,a=this._pointerDirectionDelta,o=this._pointerPositionAtLastDirectionChange,s=Math.abs(e-o.x),h=Math.abs(n-o.y);return s>this._config.pointerDirectionChangeThreshold&&(a.x=e>o.x?1:-1,o.x=e),h>this._config.pointerDirectionChangeThreshold&&(a.y=n>o.y?1:-1,o.y=n),a}_toggleNativeDragInteractions(){if(!this._rootElement||!this._handles)return;let t=this._handles.length>0||!this.isDragging();t!==this._nativeInteractionsEnabled&&(this._nativeInteractionsEnabled=t,Ue(this._rootElement,t))}_removeRootElementListeners(t){t.removeEventListener("mousedown",this._pointerDown,Ft),t.removeEventListener("touchstart",this._pointerDown,pa),t.removeEventListener("dragstart",this._nativeDragStart,Ft)}_applyRootElementTransform(t,e){let n=1/this.scale,a=jt(t*n,e*n),o=this._rootElement.style;this._initialTransform==null&&(this._initialTransform=o.transform&&o.transform!="none"?o.transform:""),o.transform=Rt(a,this._initialTransform)}_applyPreviewTransform(t,e){let n=this._previewTemplate?.template?void 0:this._initialTransform,a=jt(t,e);this._preview.setTransform(Rt(a,n))}_getDragDistance(t){let e=this._pickupPositionOnPage;return e?{x:t.x-e.x,y:t.y-e.y}:{x:0,y:0}}_cleanupCachedDimensions(){this._boundaryRect=this._previewRect=void 0,this._parentPositions.clear()}_containInsideBoundaryOnResize(){let{x:t,y:e}=this._passiveTransform;if(t===0&&e===0||this.isDragging()||!this._boundaryElement)return;let n=this._rootElement.getBoundingClientRect(),a=this._boundaryElement.getBoundingClientRect();if(a.width===0&&a.height===0||n.width===0&&n.height===0)return;let o=a.left-n.left,s=n.right-a.right,h=a.top-n.top,k=n.bottom-a.bottom;a.width>n.width?(o>0&&(t+=o),s>0&&(t-=s)):t=0,a.height>n.height?(h>0&&(e+=h),k>0&&(e-=k)):e=0,(t!==this._passiveTransform.x||e!==this._passiveTransform.y)&&this.setFreeDragPosition({y:e,x:t})}_getDragStartDelay(t){let e=this.dragStartDelay;return typeof e=="number"?e:ot(t)?e.touch:e?e.mouse:0}_updateOnScroll(t){let e=this._parentPositions.handleScroll(t);if(e){let n=at(t);this._boundaryRect&&n!==this._boundaryElement&&n.contains(this._boundaryElement)&&st(this._boundaryRect,e.top,e.left),this._pickupPositionOnPage.x+=e.left,this._pickupPositionOnPage.y+=e.top,this._dropContainer||(this._activeTransform.x-=e.left,this._activeTransform.y-=e.top,this._applyRootElementTransform(this._activeTransform.x,this._activeTransform.y))}}_getViewportScrollPosition(){return this._parentPositions.positions.get(this._document)?.scrollPosition||this._parentPositions.getViewportScrollPosition()}_getShadowRoot(){return this._cachedShadowRoot===void 0&&(this._cachedShadowRoot=qt(this._rootElement)),this._cachedShadowRoot}_getPreviewInsertionPoint(t,e){let n=this._previewContainer||"global";if(n==="parent")return t;if(n==="global"){let a=this._document;return e||a.fullscreenElement||a.webkitFullscreenElement||a.mozFullScreenElement||a.msFullscreenElement||a.body}return ue(n)}_getPreviewRect(){return(!this._previewRect||!this._previewRect.width&&!this._previewRect.height)&&(this._previewRect=this._preview?this._preview.getBoundingClientRect():this._initialDomRect),this._previewRect}_getTargetHandle(t){return this._handles.find(e=>t.target&&(t.target===e||e.contains(t.target)))}};function ka(i,t,e){return Math.max(t,Math.min(e,i))}function ot(i){return i.type[0]==="t"}function ma(i){i.preventDefault()}function xa(i,t,e){let n=ga(t,i.length-1),a=ga(e,i.length-1);if(n===a)return;let o=i[n],s=a<n?-1:1;for(let h=n;h!==a;h+=s)i[h]=i[h+s];i[a]=o}function ga(i,t){return Math.max(0,Math.min(t,i))}var Nt=class{constructor(t){this._dragDropRegistry=t,this._itemPositions=[],this.orientation="vertical",this._previousSwap={drag:null,delta:0,overlaps:!1}}start(t){this.withItems(t)}sort(t,e,n,a){let o=this._itemPositions,s=this._getItemIndexFromPointerPosition(t,e,n,a);if(s===-1&&o.length>0)return null;let h=this.orientation==="horizontal",k=o.findIndex(Q=>Q.drag===t),y=o[s],b=o[k].clientRect,P=y.clientRect,F=k>s?1:-1,ee=this._getItemOffsetPx(b,P,F),le=this._getSiblingOffsetPx(k,o,F),Se=o.slice();return xa(o,k,s),o.forEach((Q,gt)=>{if(Se[gt]===Q)return;let ui=Q.drag===t,Ln=ui?ee:le,yi=ui?t.getPlaceholderElement():Q.drag.getRootElement();Q.offset+=Ln;let ki=Math.round(Q.offset*(1/Q.drag.scale));h?(yi.style.transform=Rt(`translate3d(${ki}px, 0, 0)`,Q.initialTransform),st(Q.clientRect,0,Ln)):(yi.style.transform=Rt(`translate3d(0, ${ki}px, 0)`,Q.initialTransform),st(Q.clientRect,Ln,0))}),this._previousSwap.overlaps=Un(P,e,n),this._previousSwap.drag=y.drag,this._previousSwap.delta=h?a.x:a.y,{previousIndex:k,currentIndex:s}}enter(t,e,n,a){let o=a==null||a<0?this._getItemIndexFromPointerPosition(t,e,n):a,s=this._activeDraggables,h=s.indexOf(t),k=t.getPlaceholderElement(),y=s[o];if(y===t&&(y=s[o+1]),!y&&(o==null||o===-1||o<s.length-1)&&this._shouldEnterAsFirstChild(e,n)&&(y=s[0]),h>-1&&s.splice(h,1),y&&!this._dragDropRegistry.isDragging(y)){let b=y.getRootElement();b.parentElement.insertBefore(k,b),s.splice(o,0,t)}else this._element.appendChild(k),s.push(t);k.style.transform="",this._cacheItemPositions()}withItems(t){this._activeDraggables=t.slice(),this._cacheItemPositions()}withSortPredicate(t){this._sortPredicate=t}reset(){this._activeDraggables?.forEach(t=>{let e=t.getRootElement();if(e){let n=this._itemPositions.find(a=>a.drag===t)?.initialTransform;e.style.transform=n||""}}),this._itemPositions=[],this._activeDraggables=[],this._previousSwap.drag=null,this._previousSwap.delta=0,this._previousSwap.overlaps=!1}getActiveItemsSnapshot(){return this._activeDraggables}getItemIndex(t){return(this.orientation==="horizontal"&&this.direction==="rtl"?this._itemPositions.slice().reverse():this._itemPositions).findIndex(n=>n.drag===t)}updateOnScroll(t,e){this._itemPositions.forEach(({clientRect:n})=>{st(n,t,e)}),this._itemPositions.forEach(({drag:n})=>{this._dragDropRegistry.isDragging(n)&&n._sortFromLastPointerPosition()})}withElementContainer(t){this._element=t}_cacheItemPositions(){let t=this.orientation==="horizontal";this._itemPositions=this._activeDraggables.map(e=>{let n=e.getVisibleElement();return{drag:e,offset:0,initialTransform:n.style.transform||"",clientRect:Xn(n)}}).sort((e,n)=>t?e.clientRect.left-n.clientRect.left:e.clientRect.top-n.clientRect.top)}_getItemOffsetPx(t,e,n){let a=this.orientation==="horizontal",o=a?e.left-t.left:e.top-t.top;return n===-1&&(o+=a?e.width-t.width:e.height-t.height),o}_getSiblingOffsetPx(t,e,n){let a=this.orientation==="horizontal",o=e[t].clientRect,s=e[t+n*-1],h=o[a?"width":"height"]*n;if(s){let k=a?"left":"top",y=a?"right":"bottom";n===-1?h-=s.clientRect[k]-o[y]:h+=o[k]-s.clientRect[y]}return h}_shouldEnterAsFirstChild(t,e){if(!this._activeDraggables.length)return!1;let n=this._itemPositions,a=this.orientation==="horizontal";if(n[0].drag!==this._activeDraggables[0]){let s=n[n.length-1].clientRect;return a?t>=s.right:e>=s.bottom}else{let s=n[0].clientRect;return a?t<=s.left:e<=s.top}}_getItemIndexFromPointerPosition(t,e,n,a){let o=this.orientation==="horizontal",s=this._itemPositions.findIndex(({drag:h,clientRect:k})=>{if(h===t)return!1;if(a){let y=o?a.x:a.y;if(h===this._previousSwap.drag&&this._previousSwap.overlaps&&y===this._previousSwap.delta)return!1}return o?e>=Math.floor(k.left)&&e<Math.floor(k.right):n>=Math.floor(k.top)&&n<Math.floor(k.bottom)});return s===-1||!this._sortPredicate(s,t)?-1:s}},Zn=class{constructor(t,e){this._document=t,this._dragDropRegistry=e,this._previousSwap={drag:null,deltaX:0,deltaY:0,overlaps:!1},this._relatedNodes=[]}start(t){let e=this._element.childNodes;this._relatedNodes=[];for(let n=0;n<e.length;n++){let a=e[n];this._relatedNodes.push([a,a.nextSibling])}this.withItems(t)}sort(t,e,n,a){let o=this._getItemIndexFromPointerPosition(t,e,n),s=this._previousSwap;if(o===-1||this._activeItems[o]===t)return null;let h=this._activeItems[o];if(s.drag===h&&s.overlaps&&s.deltaX===a.x&&s.deltaY===a.y)return null;let k=this.getItemIndex(t),y=t.getPlaceholderElement(),b=h.getRootElement();o>k?b.after(y):b.before(y),xa(this._activeItems,k,o);let P=this._getRootNode().elementFromPoint(e,n);return s.deltaX=a.x,s.deltaY=a.y,s.drag=h,s.overlaps=b===P||b.contains(P),{previousIndex:k,currentIndex:o}}enter(t,e,n,a){let o=a==null||a<0?this._getItemIndexFromPointerPosition(t,e,n):a;o===-1&&(o=this._getClosestItemIndexToPointer(t,e,n));let s=this._activeItems[o],h=this._activeItems.indexOf(t);h>-1&&this._activeItems.splice(h,1),s&&!this._dragDropRegistry.isDragging(s)?(this._activeItems.splice(o,0,t),s.getRootElement().before(t.getPlaceholderElement())):(this._activeItems.push(t),this._element.appendChild(t.getPlaceholderElement()))}withItems(t){this._activeItems=t.slice()}withSortPredicate(t){this._sortPredicate=t}reset(){let t=this._element,e=this._previousSwap;for(let n=this._relatedNodes.length-1;n>-1;n--){let[a,o]=this._relatedNodes[n];a.parentNode===t&&a.nextSibling!==o&&(o===null?t.appendChild(a):o.parentNode===t&&t.insertBefore(a,o))}this._relatedNodes=[],this._activeItems=[],e.drag=null,e.deltaX=e.deltaY=0,e.overlaps=!1}getActiveItemsSnapshot(){return this._activeItems}getItemIndex(t){return this._activeItems.indexOf(t)}updateOnScroll(){this._activeItems.forEach(t=>{this._dragDropRegistry.isDragging(t)&&t._sortFromLastPointerPosition()})}withElementContainer(t){t!==this._element&&(this._element=t,this._rootNode=void 0)}_getItemIndexFromPointerPosition(t,e,n){let a=this._getRootNode().elementFromPoint(Math.floor(e),Math.floor(n)),o=a?this._activeItems.findIndex(s=>{let h=s.getRootElement();return a===h||h.contains(a)}):-1;return o===-1||!this._sortPredicate(o,t)?-1:o}_getRootNode(){return this._rootNode||(this._rootNode=qt(this._element)||this._document),this._rootNode}_getClosestItemIndexToPointer(t,e,n){if(this._activeItems.length===0)return-1;if(this._activeItems.length===1)return 0;let a=1/0,o=-1;for(let s=0;s<this._activeItems.length;s++){let h=this._activeItems[s];if(h!==t){let{x:k,y}=h.getRootElement().getBoundingClientRect(),b=Math.hypot(e-k,n-y);b<a&&(a=b,o=s)}}return o}},fa=.05,ba=.05,se=function(i){return i[i.NONE=0]="NONE",i[i.UP=1]="UP",i[i.DOWN=2]="DOWN",i}(se||{}),J=function(i){return i[i.NONE=0]="NONE",i[i.LEFT=1]="LEFT",i[i.RIGHT=2]="RIGHT",i}(J||{}),$n=class{constructor(t,e,n,a,o){this._dragDropRegistry=e,this._ngZone=a,this._viewportRuler=o,this.disabled=!1,this.sortingDisabled=!1,this.autoScrollDisabled=!1,this.autoScrollStep=2,this.enterPredicate=()=>!0,this.sortPredicate=()=>!0,this.beforeStarted=new q,this.entered=new q,this.exited=new q,this.dropped=new q,this.sorted=new q,this.receivingStarted=new q,this.receivingStopped=new q,this._isDragging=!1,this._draggables=[],this._siblings=[],this._activeSiblings=new Set,this._viewportScrollSubscription=Pe.EMPTY,this._verticalScrollDirection=se.NONE,this._horizontalScrollDirection=J.NONE,this._stopScrollTimers=new q,this._cachedShadowRoot=null,this._scrollableElements=[],this._direction="ltr",this._startScrollInterval=()=>{this._stopScrolling(),Mi(0,Sn).pipe(fe(this._stopScrollTimers)).subscribe(()=>{let h=this._scrollNode,k=this.autoScrollStep;this._verticalScrollDirection===se.UP?h.scrollBy(0,-k):this._verticalScrollDirection===se.DOWN&&h.scrollBy(0,k),this._horizontalScrollDirection===J.LEFT?h.scrollBy(-k,0):this._horizontalScrollDirection===J.RIGHT&&h.scrollBy(k,0)})};let s=this.element=ue(t);this._document=n,this.withOrientation("vertical").withElementContainer(s),e.registerDropContainer(this),this._parentPositions=new Ht(n)}dispose(){this._stopScrolling(),this._stopScrollTimers.complete(),this._viewportScrollSubscription.unsubscribe(),this.beforeStarted.complete(),this.entered.complete(),this.exited.complete(),this.dropped.complete(),this.sorted.complete(),this.receivingStarted.complete(),this.receivingStopped.complete(),this._activeSiblings.clear(),this._scrollNode=null,this._parentPositions.clear(),this._dragDropRegistry.removeDropContainer(this)}isDragging(){return this._isDragging}start(){this._draggingStarted(),this._notifyReceivingSiblings()}enter(t,e,n,a){this._draggingStarted(),a==null&&this.sortingDisabled&&(a=this._draggables.indexOf(t)),this._sortStrategy.enter(t,e,n,a),this._cacheParentPositions(),this._notifyReceivingSiblings(),this.entered.next({item:t,container:this,currentIndex:this.getItemIndex(t)})}exit(t){this._reset(),this.exited.next({item:t,container:this})}drop(t,e,n,a,o,s,h,k={}){this._reset(),this.dropped.next({item:t,currentIndex:e,previousIndex:n,container:this,previousContainer:a,isPointerOverContainer:o,distance:s,dropPoint:h,event:k})}withItems(t){let e=this._draggables;return this._draggables=t,t.forEach(n=>n._withDropContainer(this)),this.isDragging()&&(e.filter(a=>a.isDragging()).every(a=>t.indexOf(a)===-1)?this._reset():this._sortStrategy.withItems(this._draggables)),this}withDirection(t){return this._direction=t,this._sortStrategy instanceof Nt&&(this._sortStrategy.direction=t),this}connectedTo(t){return this._siblings=t.slice(),this}withOrientation(t){if(t==="mixed")this._sortStrategy=new Zn(this._document,this._dragDropRegistry);else{let e=new Nt(this._dragDropRegistry);e.direction=this._direction,e.orientation=t,this._sortStrategy=e}return this._sortStrategy.withElementContainer(this._container),this._sortStrategy.withSortPredicate((e,n)=>this.sortPredicate(e,n,this)),this}withScrollableParents(t){let e=this._container;return this._scrollableElements=t.indexOf(e)===-1?[e,...t]:t.slice(),this}withElementContainer(t){if(t===this._container)return this;let e=ue(this.element),n=this._scrollableElements.indexOf(this._container),a=this._scrollableElements.indexOf(t);return n>-1&&this._scrollableElements.splice(n,1),a>-1&&this._scrollableElements.splice(a,1),this._sortStrategy&&this._sortStrategy.withElementContainer(t),this._cachedShadowRoot=null,this._scrollableElements.unshift(t),this._container=t,this}getScrollableParents(){return this._scrollableElements}getItemIndex(t){return this._isDragging?this._sortStrategy.getItemIndex(t):this._draggables.indexOf(t)}isReceiving(){return this._activeSiblings.size>0}_sortItem(t,e,n,a){if(this.sortingDisabled||!this._domRect||!ra(this._domRect,fa,e,n))return;let o=this._sortStrategy.sort(t,e,n,a);o&&this.sorted.next({previousIndex:o.previousIndex,currentIndex:o.currentIndex,container:this,item:t})}_startScrollingIfNecessary(t,e){if(this.autoScrollDisabled)return;let n,a=se.NONE,o=J.NONE;if(this._parentPositions.positions.forEach((s,h)=>{h===this._document||!s.clientRect||n||ra(s.clientRect,fa,t,e)&&([a,o]=gs(h,s.clientRect,this._direction,t,e),(a||o)&&(n=h))}),!a&&!o){let{width:s,height:h}=this._viewportRuler.getViewportSize(),k={width:s,height:h,top:0,right:s,bottom:h,left:0};a=wa(k,e),o=Ia(k,t),n=window}n&&(a!==this._verticalScrollDirection||o!==this._horizontalScrollDirection||n!==this._scrollNode)&&(this._verticalScrollDirection=a,this._horizontalScrollDirection=o,this._scrollNode=n,(a||o)&&n?this._ngZone.runOutsideAngular(this._startScrollInterval):this._stopScrolling())}_stopScrolling(){this._stopScrollTimers.next()}_draggingStarted(){let t=this._container.style;this.beforeStarted.next(),this._isDragging=!0,this._initialScrollSnap=t.msScrollSnapType||t.scrollSnapType||"",t.scrollSnapType=t.msScrollSnapType="none",this._sortStrategy.start(this._draggables),this._cacheParentPositions(),this._viewportScrollSubscription.unsubscribe(),this._listenToScrollEvents()}_cacheParentPositions(){this._parentPositions.cache(this._scrollableElements),this._domRect=this._parentPositions.positions.get(this._container).clientRect}_reset(){this._isDragging=!1;let t=this._container.style;t.scrollSnapType=t.msScrollSnapType=this._initialScrollSnap,this._siblings.forEach(e=>e._stopReceiving(this)),this._sortStrategy.reset(),this._stopScrolling(),this._viewportScrollSubscription.unsubscribe(),this._parentPositions.clear()}_isOverContainer(t,e){return this._domRect!=null&&Un(this._domRect,t,e)}_getSiblingContainerFromPosition(t,e,n){return this._siblings.find(a=>a._canReceive(t,e,n))}_canReceive(t,e,n){if(!this._domRect||!Un(this._domRect,e,n)||!this.enterPredicate(t,this))return!1;let a=this._getShadowRoot().elementFromPoint(e,n);return a?a===this._container||this._container.contains(a):!1}_startReceiving(t,e){let n=this._activeSiblings;!n.has(t)&&e.every(a=>this.enterPredicate(a,this)||this._draggables.indexOf(a)>-1)&&(n.add(t),this._cacheParentPositions(),this._listenToScrollEvents(),this.receivingStarted.next({initiator:t,receiver:this,items:e}))}_stopReceiving(t){this._activeSiblings.delete(t),this._viewportScrollSubscription.unsubscribe(),this.receivingStopped.next({initiator:t,receiver:this})}_listenToScrollEvents(){this._viewportScrollSubscription=this._dragDropRegistry.scrolled(this._getShadowRoot()).subscribe(t=>{if(this.isDragging()){let e=this._parentPositions.handleScroll(t);e&&this._sortStrategy.updateOnScroll(e.top,e.left)}else this.isReceiving()&&this._cacheParentPositions()})}_getShadowRoot(){if(!this._cachedShadowRoot){let t=qt(this._container);this._cachedShadowRoot=t||this._document}return this._cachedShadowRoot}_notifyReceivingSiblings(){let t=this._sortStrategy.getActiveItemsSnapshot().filter(e=>e.isDragging());this._siblings.forEach(e=>e._startReceiving(this,t))}};function wa(i,t){let{top:e,bottom:n,height:a}=i,o=a*ba;return t>=e-o&&t<=e+o?se.UP:t>=n-o&&t<=n+o?se.DOWN:se.NONE}function Ia(i,t){let{left:e,right:n,width:a}=i,o=a*ba;return t>=e-o&&t<=e+o?J.LEFT:t>=n-o&&t<=n+o?J.RIGHT:J.NONE}function gs(i,t,e,n,a){let o=wa(t,a),s=Ia(t,n),h=se.NONE,k=J.NONE;if(o){let y=i.scrollTop;o===se.UP?y>0&&(h=se.UP):i.scrollHeight-y>i.clientHeight&&(h=se.DOWN)}if(s){let y=i.scrollLeft;e==="rtl"?s===J.RIGHT?y<0&&(k=J.RIGHT):i.scrollWidth+y>i.clientWidth&&(k=J.LEFT):s===J.LEFT?y>0&&(k=J.LEFT):i.scrollWidth-y>i.clientWidth&&(k=J.RIGHT)}return[h,k]}var zt=it({passive:!1,capture:!0}),Bt=new Set,fs=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=_({type:i,selectors:[["ng-component"]],hostAttrs:["cdk-drag-resets-container",""],standalone:!0,features:[x],decls:0,vars:0,template:function(n,a){},styles:["@layer cdk-resets{.cdk-drag-preview{background:none;border:none;padding:0;color:inherit;inset:auto}}.cdk-drag-placeholder *,.cdk-drag-preview *{pointer-events:none !important}"],encapsulation:2,changeDetection:0})}}return i})(),vs=(()=>{class i{constructor(e,n){this._ngZone=e,this._appRef=Ae(Ti),this._environmentInjector=Ae(wi),this._dropInstances=new Set,this._dragInstances=new Set,this._activeDragInstances=ve([]),this._globalListeners=new Map,this._draggingPredicate=a=>a.isDragging(),this.pointerMove=new q,this.pointerUp=new q,this.scroll=new q,this._preventDefaultWhileDragging=a=>{this._activeDragInstances().length>0&&a.preventDefault()},this._persistentTouchmoveListener=a=>{this._activeDragInstances().length>0&&(this._activeDragInstances().some(this._draggingPredicate)&&a.preventDefault(),this.pointerMove.next(a))},this._document=n}registerDropContainer(e){this._dropInstances.has(e)||this._dropInstances.add(e)}registerDragItem(e){this._dragInstances.add(e),this._dragInstances.size===1&&this._ngZone.runOutsideAngular(()=>{this._document.addEventListener("touchmove",this._persistentTouchmoveListener,zt)})}removeDropContainer(e){this._dropInstances.delete(e)}removeDragItem(e){this._dragInstances.delete(e),this.stopDragging(e),this._dragInstances.size===0&&this._document.removeEventListener("touchmove",this._persistentTouchmoveListener,zt)}startDragging(e,n){if(!(this._activeDragInstances().indexOf(e)>-1)&&(this._loadResets(),this._activeDragInstances.update(a=>[...a,e]),this._activeDragInstances().length===1)){let a=n.type.startsWith("touch");this._globalListeners.set(a?"touchend":"mouseup",{handler:o=>this.pointerUp.next(o),options:!0}).set("scroll",{handler:o=>this.scroll.next(o),options:!0}).set("selectstart",{handler:this._preventDefaultWhileDragging,options:zt}),a||this._globalListeners.set("mousemove",{handler:o=>this.pointerMove.next(o),options:zt}),this._ngZone.runOutsideAngular(()=>{this._globalListeners.forEach((o,s)=>{this._document.addEventListener(s,o.handler,o.options)})})}}stopDragging(e){this._activeDragInstances.update(n=>{let a=n.indexOf(e);return a>-1?(n.splice(a,1),[...n]):n}),this._activeDragInstances().length===0&&this._clearGlobalListeners()}isDragging(e){return this._activeDragInstances().indexOf(e)>-1}scrolled(e){let n=[this.scroll];return e&&e!==this._document&&n.push(new Je(a=>this._ngZone.runOutsideAngular(()=>{let s=h=>{this._activeDragInstances().length&&a.next(h)};return e.addEventListener("scroll",s,!0),()=>{e.removeEventListener("scroll",s,!0)}}))),vt(...n)}ngOnDestroy(){this._dragInstances.forEach(e=>this.removeDragItem(e)),this._dropInstances.forEach(e=>this.removeDropContainer(e)),this._clearGlobalListeners(),this.pointerMove.complete(),this.pointerUp.complete()}_clearGlobalListeners(){this._globalListeners.forEach((e,n)=>{this._document.removeEventListener(n,e.handler,e.options)}),this._globalListeners.clear()}_loadResets(){if(!Bt.has(this._appRef)){Bt.add(this._appRef);let e=Vi(fs,{environmentInjector:this._environmentInjector});this._appRef.onDestroy(()=>{Bt.delete(this._appRef),Bt.size===0&&e.destroy()})}}static{this.\u0275fac=function(n){return new(n||i)(G(Oe),G(me))}}static{this.\u0275prov=$({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),Ms={dragStartThreshold:5,pointerDirectionChangeThreshold:5},Qn=(()=>{class i{constructor(e,n,a,o){this._document=e,this._ngZone=n,this._viewportRuler=a,this._dragDropRegistry=o}createDrag(e,n=Ms){return new Wn(e,n,this._document,this._ngZone,this._viewportRuler,this._dragDropRegistry)}createDropList(e){return new $n(e,this._dragDropRegistry,this._document,this._ngZone,this._viewportRuler)}static{this.\u0275fac=function(n){return new(n||i)(G(me),G(Oe),G(ea),G(vs))}}static{this.\u0275prov=$({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})(),va=new Z("CDK_DRAG_PARENT");var Cs=new Z("CdkDragHandle");var La=new Z("CDK_DRAG_CONFIG"),_s="cdk-drag",Sa=new Z("CdkDropList"),Pa=(()=>{class i{static{this._dragInstances=[]}get disabled(){return this._disabled||this.dropContainer&&this.dropContainer.disabled}set disabled(e){this._disabled=e,this._dragRef.disabled=this._disabled}constructor(e,n,a,o,s,h,k,y,b,P,F){this.element=e,this.dropContainer=n,this._ngZone=o,this._viewContainerRef=s,this._dir=k,this._changeDetectorRef=b,this._selfHandle=P,this._parentDrag=F,this._destroyed=new q,this._handles=new Ye([]),this.scale=1,this.started=new f,this.released=new f,this.ended=new f,this.entered=new f,this.exited=new f,this.dropped=new f,this.moved=new Je(ee=>{let le=this._dragRef.moved.pipe(ft(Se=>({source:this,pointerPosition:Se.pointerPosition,event:Se.event,delta:Se.delta,distance:Se.distance}))).subscribe(ee);return()=>{le.unsubscribe()}}),this._injector=Ae(An),this._dragRef=y.createDrag(e,{dragStartThreshold:h&&h.dragStartThreshold!=null?h.dragStartThreshold:5,pointerDirectionChangeThreshold:h&&h.pointerDirectionChangeThreshold!=null?h.pointerDirectionChangeThreshold:5,zIndex:h?.zIndex}),this._dragRef.data=this,i._dragInstances.push(this),h&&this._assignDefaults(h),n&&(this._dragRef._withDropContainer(n._dropListRef),n.addItem(this),n._dropListRef.beforeStarted.pipe(fe(this._destroyed)).subscribe(()=>{this._dragRef.scale=this.scale})),this._syncInputs(this._dragRef),this._handleEvents(this._dragRef)}getPlaceholderElement(){return this._dragRef.getPlaceholderElement()}getRootElement(){return this._dragRef.getRootElement()}reset(){this._dragRef.reset()}getFreeDragPosition(){return this._dragRef.getFreeDragPosition()}setFreeDragPosition(e){this._dragRef.setFreeDragPosition(e)}ngAfterViewInit(){Pi(()=>{this._updateRootElement(),this._setupHandlesListener(),this._dragRef.scale=this.scale,this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)},{injector:this._injector})}ngOnChanges(e){let n=e.rootElementSelector,a=e.freeDragPosition;n&&!n.firstChange&&this._updateRootElement(),this._dragRef.scale=this.scale,a&&!a.firstChange&&this.freeDragPosition&&this._dragRef.setFreeDragPosition(this.freeDragPosition)}ngOnDestroy(){this.dropContainer&&this.dropContainer.removeItem(this);let e=i._dragInstances.indexOf(this);e>-1&&i._dragInstances.splice(e,1),this._ngZone.runOutsideAngular(()=>{this._handles.complete(),this._destroyed.next(),this._destroyed.complete(),this._dragRef.dispose()})}_addHandle(e){let n=this._handles.getValue();n.push(e),this._handles.next(n)}_removeHandle(e){let n=this._handles.getValue(),a=n.indexOf(e);a>-1&&(n.splice(a,1),this._handles.next(n))}_setPreviewTemplate(e){this._previewTemplate=e}_resetPreviewTemplate(e){e===this._previewTemplate&&(this._previewTemplate=null)}_setPlaceholderTemplate(e){this._placeholderTemplate=e}_resetPlaceholderTemplate(e){e===this._placeholderTemplate&&(this._placeholderTemplate=null)}_updateRootElement(){let e=this.element.nativeElement,n=e;this.rootElementSelector&&(n=e.closest!==void 0?e.closest(this.rootElementSelector):e.parentElement?.closest(this.rootElementSelector)),this._dragRef.withRootElement(n||e)}_getBoundaryElement(){let e=this.boundaryElement;return e?typeof e=="string"?this.element.nativeElement.closest(e):ue(e):null}_syncInputs(e){e.beforeStarted.subscribe(()=>{if(!e.isDragging()){let n=this._dir,a=this.dragStartDelay,o=this._placeholderTemplate?{template:this._placeholderTemplate.templateRef,context:this._placeholderTemplate.data,viewContainer:this._viewContainerRef}:null,s=this._previewTemplate?{template:this._previewTemplate.templateRef,context:this._previewTemplate.data,matchSize:this._previewTemplate.matchSize,viewContainer:this._viewContainerRef}:null;e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.scale=this.scale,e.dragStartDelay=typeof a=="object"&&a?a:Et(a),e.constrainPosition=this.constrainPosition,e.previewClass=this.previewClass,e.withBoundaryElement(this._getBoundaryElement()).withPlaceholderTemplate(o).withPreviewTemplate(s).withPreviewContainer(this.previewContainer||"global"),n&&e.withDirection(n.value)}}),e.beforeStarted.pipe(_i(1)).subscribe(()=>{if(this._parentDrag){e.withParent(this._parentDrag._dragRef);return}let n=this.element.nativeElement.parentElement;for(;n;){if(n.classList.contains(_s)){e.withParent(i._dragInstances.find(a=>a.element.nativeElement===n)?._dragRef||null);break}n=n.parentElement}})}_handleEvents(e){e.started.subscribe(n=>{this.started.emit({source:this,event:n.event}),this._changeDetectorRef.markForCheck()}),e.released.subscribe(n=>{this.released.emit({source:this,event:n.event})}),e.ended.subscribe(n=>{this.ended.emit({source:this,distance:n.distance,dropPoint:n.dropPoint,event:n.event}),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(n=>{this.entered.emit({container:n.container.data,item:this,currentIndex:n.currentIndex})}),e.exited.subscribe(n=>{this.exited.emit({container:n.container.data,item:this})}),e.dropped.subscribe(n=>{this.dropped.emit({previousIndex:n.previousIndex,currentIndex:n.currentIndex,previousContainer:n.previousContainer.data,container:n.container.data,isPointerOverContainer:n.isPointerOverContainer,item:this,distance:n.distance,dropPoint:n.dropPoint,event:n.event})})}_assignDefaults(e){let{lockAxis:n,dragStartDelay:a,constrainPosition:o,previewClass:s,boundaryElement:h,draggingDisabled:k,rootElementSelector:y,previewContainer:b}=e;this.disabled=k??!1,this.dragStartDelay=a||0,n&&(this.lockAxis=n),o&&(this.constrainPosition=o),s&&(this.previewClass=s),h&&(this.boundaryElement=h),y&&(this.rootElementSelector=y),b&&(this.previewContainer=b)}_setupHandlesListener(){this._handles.pipe(xi(e=>{let n=e.map(a=>a.element);this._selfHandle&&this.rootElementSelector&&n.push(this.element),this._dragRef.withHandles(n)}),Dn(e=>vt(...e.map(n=>n._stateChanges.pipe(Mt(n))))),fe(this._destroyed)).subscribe(e=>{let n=this._dragRef,a=e.element.nativeElement;e.disabled?n.disableHandle(a):n.enableHandle(a)})}static{this.\u0275fac=function(n){return new(n||i)(m(N),m(Sa,12),m(me),m(Oe),m(On),m(La,8),m(jn,8),m(Qn),m(pe),m(Cs,10),m(va,12))}}static{this.\u0275dir=H({type:i,selectors:[["","cdkDrag",""]],hostAttrs:[1,"cdk-drag"],hostVars:4,hostBindings:function(n,a){n&2&&L("cdk-drag-disabled",a.disabled)("cdk-drag-dragging",a._dragRef.isDragging())},inputs:{data:[0,"cdkDragData","data"],lockAxis:[0,"cdkDragLockAxis","lockAxis"],rootElementSelector:[0,"cdkDragRootElement","rootElementSelector"],boundaryElement:[0,"cdkDragBoundary","boundaryElement"],dragStartDelay:[0,"cdkDragStartDelay","dragStartDelay"],freeDragPosition:[0,"cdkDragFreeDragPosition","freeDragPosition"],disabled:[2,"cdkDragDisabled","disabled",Ee],constrainPosition:[0,"cdkDragConstrainPosition","constrainPosition"],previewClass:[0,"cdkDragPreviewClass","previewClass"],previewContainer:[0,"cdkDragPreviewContainer","previewContainer"],scale:[2,"cdkDragScale","scale",Lt]},outputs:{started:"cdkDragStarted",released:"cdkDragReleased",ended:"cdkDragEnded",entered:"cdkDragEntered",exited:"cdkDragExited",dropped:"cdkDragDropped",moved:"cdkDragMoved"},exportAs:["cdkDrag"],standalone:!0,features:[oe([{provide:va,useExisting:i}]),ze,j]})}}return i})(),Ma=new Z("CdkDropListGroup");var xs=0,Da=(()=>{class i{static{this._dropLists=[]}get disabled(){return this._disabled||!!this._group&&this._group.disabled}set disabled(e){this._dropListRef.disabled=this._disabled=e}constructor(e,n,a,o,s,h,k){this.element=e,this._changeDetectorRef=a,this._scrollDispatcher=o,this._dir=s,this._group=h,this._destroyed=new q,this.connectedTo=[],this.id=`cdk-drop-list-${xs++}`,this.enterPredicate=()=>!0,this.sortPredicate=()=>!0,this.dropped=new f,this.entered=new f,this.exited=new f,this.sorted=new f,this._unsortedItems=new Set,this._dropListRef=n.createDropList(e),this._dropListRef.data=this,k&&this._assignDefaults(k),this._dropListRef.enterPredicate=(y,b)=>this.enterPredicate(y.data,b.data),this._dropListRef.sortPredicate=(y,b,P)=>this.sortPredicate(y,b.data,P.data),this._setupInputSyncSubscription(this._dropListRef),this._handleEvents(this._dropListRef),i._dropLists.push(this),h&&h._items.add(this)}addItem(e){this._unsortedItems.add(e),this._dropListRef.isDragging()&&this._syncItemsWithRef()}removeItem(e){this._unsortedItems.delete(e),this._dropListRef.isDragging()&&this._syncItemsWithRef()}getSortedItems(){return Array.from(this._unsortedItems).sort((e,n)=>e._dragRef.getVisibleElement().compareDocumentPosition(n._dragRef.getVisibleElement())&Node.DOCUMENT_POSITION_FOLLOWING?-1:1)}ngOnDestroy(){let e=i._dropLists.indexOf(this);e>-1&&i._dropLists.splice(e,1),this._group&&this._group._items.delete(this),this._unsortedItems.clear(),this._dropListRef.dispose(),this._destroyed.next(),this._destroyed.complete()}_setupInputSyncSubscription(e){this._dir&&this._dir.change.pipe(Mt(this._dir.value),fe(this._destroyed)).subscribe(n=>e.withDirection(n)),e.beforeStarted.subscribe(()=>{let n=Ji(this.connectedTo).map(a=>{if(typeof a=="string"){let o=i._dropLists.find(s=>s.id===a);return o}return a});if(this._group&&this._group._items.forEach(a=>{n.indexOf(a)===-1&&n.push(a)}),!this._scrollableParentsResolved){let a=this._scrollDispatcher.getAncestorScrollContainers(this.element).map(o=>o.getElementRef().nativeElement);this._dropListRef.withScrollableParents(a),this._scrollableParentsResolved=!0}if(this.elementContainerSelector){let a=this.element.nativeElement.querySelector(this.elementContainerSelector);e.withElementContainer(a)}e.disabled=this.disabled,e.lockAxis=this.lockAxis,e.sortingDisabled=this.sortingDisabled,e.autoScrollDisabled=this.autoScrollDisabled,e.autoScrollStep=Et(this.autoScrollStep,2),e.connectedTo(n.filter(a=>a&&a!==this).map(a=>a._dropListRef)).withOrientation(this.orientation)})}_handleEvents(e){e.beforeStarted.subscribe(()=>{this._syncItemsWithRef(),this._changeDetectorRef.markForCheck()}),e.entered.subscribe(n=>{this.entered.emit({container:this,item:n.item.data,currentIndex:n.currentIndex})}),e.exited.subscribe(n=>{this.exited.emit({container:this,item:n.item.data}),this._changeDetectorRef.markForCheck()}),e.sorted.subscribe(n=>{this.sorted.emit({previousIndex:n.previousIndex,currentIndex:n.currentIndex,container:this,item:n.item.data})}),e.dropped.subscribe(n=>{this.dropped.emit({previousIndex:n.previousIndex,currentIndex:n.currentIndex,previousContainer:n.previousContainer.data,container:n.container.data,item:n.item.data,isPointerOverContainer:n.isPointerOverContainer,distance:n.distance,dropPoint:n.dropPoint,event:n.event}),this._changeDetectorRef.markForCheck()}),vt(e.receivingStarted,e.receivingStopped).subscribe(()=>this._changeDetectorRef.markForCheck())}_assignDefaults(e){let{lockAxis:n,draggingDisabled:a,sortingDisabled:o,listAutoScrollDisabled:s,listOrientation:h}=e;this.disabled=a??!1,this.sortingDisabled=o??!1,this.autoScrollDisabled=s??!1,this.orientation=h||"vertical",n&&(this.lockAxis=n)}_syncItemsWithRef(){this._dropListRef.withItems(this.getSortedItems().map(e=>e._dragRef))}static{this.\u0275fac=function(n){return new(n||i)(m(N),m(Qn),m(pe),m(Yi),m(jn,8),m(Ma,12),m(La,8))}}static{this.\u0275dir=H({type:i,selectors:[["","cdkDropList",""],["cdk-drop-list"]],hostAttrs:[1,"cdk-drop-list"],hostVars:7,hostBindings:function(n,a){n&2&&(z("id",a.id),L("cdk-drop-list-disabled",a.disabled)("cdk-drop-list-dragging",a._dropListRef.isDragging())("cdk-drop-list-receiving",a._dropListRef.isReceiving()))},inputs:{connectedTo:[0,"cdkDropListConnectedTo","connectedTo"],data:[0,"cdkDropListData","data"],orientation:[0,"cdkDropListOrientation","orientation"],id:"id",lockAxis:[0,"cdkDropListLockAxis","lockAxis"],disabled:[2,"cdkDropListDisabled","disabled",Ee],sortingDisabled:[2,"cdkDropListSortingDisabled","sortingDisabled",Ee],enterPredicate:[0,"cdkDropListEnterPredicate","enterPredicate"],sortPredicate:[0,"cdkDropListSortPredicate","sortPredicate"],autoScrollDisabled:[2,"cdkDropListAutoScrollDisabled","autoScrollDisabled",Ee],autoScrollStep:[0,"cdkDropListAutoScrollStep","autoScrollStep"],elementContainerSelector:[0,"cdkDropListElementContainer","elementContainerSelector"]},outputs:{dropped:"cdkDropListDropped",entered:"cdkDropListEntered",exited:"cdkDropListExited",sorted:"cdkDropListSorted"},exportAs:["cdkDropList"],standalone:!0,features:[oe([{provide:Ma,useValue:void 0},{provide:Sa,useExisting:i}]),ze]})}}return i})();var Aa=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=ne({type:i})}static{this.\u0275inj=te({providers:[Qn],imports:[ta]})}}return i})();function ws(i,t){if(i&1){let e=I();c(0,"app-tree-view",9),g("dragIdChange",function(a){M(e);let o=l(2);return C(o.onDragIdChange(a))})("itemSelected",function(a){M(e);let o=l(2);return C(o.itemSelected.emit(a))})("itemDropped",function(a){M(e);let o=l(2);return C(o.itemDropped.emit(a))}),r()}if(i&2){let e=l().$implicit,n=l();p("disabled",n.disabled)("items",n.getChildren(e))("selectedId",n.selectedId)("idField",n.idField)("labelField",n.labelField)("childrenField",n.childrenField)("typeField",n.typeField)("typeToIcon",n.typeToIcon)("allowMultipleItems",!0)("activeDragId",n.activeDragId)}}function Is(i,t){if(i&1){let e=I();c(0,"li",4)(1,"div",5)(2,"span",6),g("click",function(a){let o=M(e).$implicit;return o.expanded=!o.expanded,C(a.stopPropagation())}),u(3),r(),c(4,"span",7,0),g("cdkDragStarted",function(a){M(e);let o=l();return C(o.onDragStarted(a))})("cdkDragEnded",function(){M(e);let a=l();return C(a.onDragEnded())})("mouseenter",function(){M(e);let a=R(5),o=l();return C(o.onMouseEnter(a))})("mouseleave",function(){M(e);let a=R(5),o=l();return C(o.onMouseLeave(a))})("click",function(){let a=M(e).$implicit,o=l();return C(o.clicked(a))}),u(6),r()(),v(7,ws,1,10,"app-tree-view",8),r()}if(i&2){let e=t.$implicit,n=l();d(),L("disabled",n.disabled),d(),L("expanded",e.expanded),d(),T(" ",n.getChildren(e).length?"\u25B6":""," "),d(),L("drop-before",n.onHover(e,"before"))("drop-after",n.onHover(e,"after"))("drop-inside",n.onHover(e,"inside"))("drop-forbidden",n.onHover(e,null))("selected",n.getId(e)==n.selectedId),p("cdkDragDisabled",n.disabled||!n.allowMultipleItems)("cdkDragData",e),z("data-id",n.getId(e))("data-droppable",n.allowMultipleItems),d(2),ye(" ",n.getIcon(e)," ",n.getLabel(e)," "),d(),p("ngIf",n.getChildren(e).length&&e.expanded)}}var Ut=class i{constructor(t){this.elementRef=t}items=[];selectedId;idField="id";labelField="label";childrenField="children";disabled=!1;allowMultipleItems=!1;itemSelected=new f;itemDropped=new f;activeDragId=null;dragIdChange=new f;typeField="type";typeToIcon={};getType(t){return t[this.typeField]}getIcon(t){return this.typeToIcon[this.getType(t)]||""}hoveredItemId=null;dragPosition=null;validateDropPosition(t){if(!this.activeDragId)return null;let e=this.activeDragId,n=this.findDropElement(t.event.target);if(!n)return null;let a=n.getBoundingClientRect(),h=(t.event.clientY-a.top)/a.height,k;h<.3?k="before":h>.7?k="after":k="inside";let y=n.getAttribute("data-id");if(!y||y==this.activeDragId)return null;let b=this.getTreeViewItems(this.findTreeViewAncestors(n)[0]),P=this.findItemById(b,this.activeDragId),F=this.findItemById(b,y),ee=this.findParentCollection(b,this.activeDragId),le=ee===this.findParentCollection(b,y);if(this.isInSubtree(P,F))return null;switch(k){case"inside":if(!this.hasChildren(F))return null;break;case"before":case"after":if(!(n.getAttribute("data-droppable")==="true"))return null;if(le){let Q=ee.indexOf(P),gt=ee.indexOf(F);if(k==="before"&&Q===gt-1||k==="after"&&Q===gt+1)return null}break}return{sourceId:e,targetId:y,position:k}}findParentCollection(t,e){for(let n of t){let a=this.getChildren(n);if(a.some(o=>this.getId(o)==e))return a;if(a.length){let o=this.findParentCollection(a,e);if(o)return o}}return null}onHover(t,e){if(this.disabled)return!1;let n=this.getId(t);return this.hoveredItemId!=n?!1:e==this.dragPosition}get isRootComponent(){return this.findTreeViewAncestors(this.elementRef.nativeElement).length<=1}onDragStarted(t){let n=t.source.element.nativeElement.getAttribute("data-id");this.dragIdChange.emit(n)}onDragEnded(){this.dragIdChange.emit(null)}onDragIdChange(t){this.isRootComponent?this.activeDragId=t:this.dragIdChange.emit(t)}onMouseEnter(t){if(this.activeDragId){t.addEventListener("mousemove",n=>this.onMouseMove(n,t));let e=this.findDropElement(t);this.hoveredItemId=e.getAttribute("data-id")}}onMouseLeave(t){this.dragPosition=null,t.removeEventListener("mousemove",e=>this.onMouseMove(e,t)),this.hoveredItemId=null}onMouseMove(t,e){if(this.activeDragId){let n=this.validateDropPosition({event:t});this.dragPosition=n?n.position:null}}getId(t){return t[this.idField]}getLabel(t){return t[this.labelField]}getChildren(t){return t[this.childrenField]||[]}hasChildren(t){return!!t[this.childrenField]}clicked(t){this.disabled||this.itemSelected.emit(t)}get allowedItems(){return this.allowMultipleItems?this.items:this.items.length?[this.items[0]]:[]}onDrop(t){let e=this.validateDropPosition(t);e&&this.itemDropped.emit(e)}findTreeViewAncestors(t){let e=[],n=t;for(;n.parentElement;)n.tagName.toLowerCase()==="app-tree-view"&&e.unshift(n),n=n.parentElement;return e}findDropElement(t){let e=t;for(;e;){if(e.hasAttribute("cdkDrag"))return e;if(!e.parentElement)break;e=e.parentElement}return null}stringify(t){return JSON.stringify(t)}getTreeViewItems(t){let n=t.querySelector("ul[cdkDropList]")?.getAttribute("data-items");return n?JSON.parse(n):[]}findItemById(t,e){for(let n of t){if(this.getId(n)==e)return n;if(this.getChildren(n).length){let a=this.findItemById(this.getChildren(n),e);if(a)return a}}return null}isInSubtree(t,e){return this.getChildren(t).some(a=>this.getId(a)==this.getId(e)||this.isInSubtree(a,e))}static \u0275fac=function(e){return new(e||i)(m(N))};static \u0275cmp=_({type:i,selectors:[["app-tree-view"]],inputs:{items:"items",selectedId:"selectedId",idField:"idField",labelField:"labelField",childrenField:"childrenField",disabled:"disabled",allowMultipleItems:"allowMultipleItems",activeDragId:"activeDragId",typeField:"typeField",typeToIcon:"typeToIcon"},outputs:{itemSelected:"itemSelected",itemDropped:"itemDropped",dragIdChange:"dragIdChange"},standalone:!0,features:[x],decls:3,vars:4,consts:[["dragOver",""],[1,"tree-view"],["cdkDropList","",1,"tree-list",3,"cdkDropListDropped","cdkDropListData","cdkDropListSortingDisabled"],["class","tree-item",4,"ngFor","ngForOf"],[1,"tree-item"],[1,"item-content"],[1,"expand-icon",3,"click"],["cdkDrag","",1,"item-label",3,"cdkDragStarted","cdkDragEnded","mouseenter","mouseleave","click","cdkDragDisabled","cdkDragData"],[3,"disabled","items","selectedId","idField","labelField","childrenField","typeField","typeToIcon","allowMultipleItems","activeDragId","dragIdChange","itemSelected","itemDropped",4,"ngIf"],[3,"dragIdChange","itemSelected","itemDropped","disabled","items","selectedId","idField","labelField","childrenField","typeField","typeToIcon","allowMultipleItems","activeDragId"]],template:function(e,n){e&1&&(c(0,"div",1)(1,"ul",2),g("cdkDropListDropped",function(o){return n.onDrop(o)}),v(2,Is,8,22,"li",3),r()()),e&2&&(d(),p("cdkDropListData",n.allowedItems)("cdkDropListSortingDisabled",!0),z("data-items",n.stringify(n.allowedItems)),d(),p("ngForOf",n.allowedItems))},dependencies:[i,w,W,O,Aa,Da,Pa],styles:[".tree-view[_ngcontent-%COMP%]   .tree-list[_ngcontent-%COMP%]{list-style:none;padding-left:1rem;margin:0}.tree-view[_ngcontent-%COMP%]   .tree-item[_ngcontent-%COMP%]{padding:.25rem 0}.tree-view[_ngcontent-%COMP%]   .item-content[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer}.tree-view[_ngcontent-%COMP%]   .item-content[_ngcontent-%COMP%]:hover:not(.disabled){background-color:#0000000d}.tree-view[_ngcontent-%COMP%]   .item-content.disabled[_ngcontent-%COMP%]{color:#666;cursor:default}.tree-view[_ngcontent-%COMP%]   .expand-icon[_ngcontent-%COMP%]{width:1rem;display:inline-block;margin-right:.5rem;transition:transform .2s;cursor:pointer}.tree-view[_ngcontent-%COMP%]   .expand-icon.expanded[_ngcontent-%COMP%]{transform:rotate(90deg)}.tree-view[_ngcontent-%COMP%]   .item-label[_ngcontent-%COMP%]{flex:1;border-top:2px solid transparent;border-bottom:2px solid transparent}.tree-view[_ngcontent-%COMP%]   .item-label.selected[_ngcontent-%COMP%]{background-color:#e3f2fd}.tree-view[_ngcontent-%COMP%]   .item-label.drop-before[_ngcontent-%COMP%]{border-top-color:#2196f3;cursor:row-resize}.tree-view[_ngcontent-%COMP%]   .item-label.drop-after[_ngcontent-%COMP%]{border-bottom:2px solid #2196F3;cursor:row-resize}.tree-view[_ngcontent-%COMP%]   .item-label.drop-inside[_ngcontent-%COMP%]{background-color:#2196f31a;cursor:move}.tree-view[_ngcontent-%COMP%]   .item-label.drop-forbidden[_ngcontent-%COMP%]{cursor:not-allowed}"]})};var Ls=["itemTemplate"],Ss=i=>({$implicit:i});function Ps(i,t){i&1&&(c(0,"div",4),D(1,"input",5),r())}function Ds(i,t){i&1&&ce(0)}function As(i,t){if(i&1&&(c(0,"div",6),v(1,Ds,1,0,"ng-container",7),r()),i&2){let e=t.$implicit,n=l();d(),p("ngTemplateOutlet",n.itemTemplate)("ngTemplateOutletContext",ke(2,Ss,e))}}var Gt=class i{config;items;select=new f;itemTemplate;static \u0275fac=function(e){return new(e||i)};static \u0275cmp=_({type:i,selectors:[["app-list"]],contentQueries:function(e,n,a){if(e&1&&xt(a,Ls,5),e&2){let o;ie(o=ae())&&(n.itemTemplate=o.first)}},inputs:{config:"config",items:"items"},outputs:{select:"select"},standalone:!0,features:[x],decls:4,vars:2,consts:[[1,"list-container"],["class","list-search",4,"ngIf"],[1,"list-content"],["class","list-item",4,"ngFor","ngForOf"],[1,"list-search"],["type","text","placeholder","Search..."],[1,"list-item"],[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(e,n){e&1&&(c(0,"div",0),v(1,Ps,2,0,"div",1),c(2,"div",2),v(3,As,2,4,"div",3),r()()),e&2&&(d(),p("ngIf",n.config==null?null:n.config.showSearch),d(2),p("ngForOf",n.items))},dependencies:[w,W,O,_e],styles:[".list-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;background:#fff}.list-container[_ngcontent-%COMP%]   .list-search[_ngcontent-%COMP%]{padding:16px;border-bottom:1px solid #eee}.list-container[_ngcontent-%COMP%]   .list-search[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:8px 12px;border:1px solid #ddd;border-radius:4px;font-size:14px}.list-container[_ngcontent-%COMP%]   .list-search[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#0366d6}.list-container[_ngcontent-%COMP%]   .list-content[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:8px 0}.list-container[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]{cursor:pointer}"]})};var Os=()=>({selectable:!0});function Ts(i,t){if(i&1){let e=I();c(0,"div",2),g("click",function(){let a=M(e).$implicit,o=l();return C(o.onSelect(a))}),c(1,"div",3),u(2),r(),c(3,"div",4)(4,"span"),u(5),wt(6,"date"),r(),c(7,"span"),u(8),r()()()}if(i&2){let e=t.$implicit,n=l();L("selected",e.id==n.selectedId)("disabled",!n.canSelect&&e.id!=n.selectedId),d(2),A(e.title),d(3),A(It(6,7,e.createdAt)),d(3),A(e.status)}}var Wt=class i{constructor(t){this.chatSessionService=t}selectedId;filter={status:["approved"]};canSelect=!0;sessionSelect=new f;sessions=[];loading=!1;error=null;ngOnInit(){this.loadSessions()}loadSessions(){this.loading=!0,this.error=null,this.chatSessionService.getSessions(this.filter).subscribe({next:t=>{this.sessions=t,this.loading=!1},error:t=>{this.error="Failed to load sessions",this.loading=!1}})}onSelect(t){this.canSelect&&this.sessionSelect.emit(t)}static \u0275fac=function(e){return new(e||i)(m(St))};static \u0275cmp=_({type:i,selectors:[["app-chat-session-list"]],inputs:{selectedId:"selectedId",filter:"filter",canSelect:"canSelect"},outputs:{sessionSelect:"sessionSelect"},standalone:!0,features:[x],decls:3,vars:3,consts:[["itemTemplate",""],[3,"config","items"],[1,"session-item",3,"click"],[1,"session-title"],[1,"session-meta"]],template:function(e,n){e&1&&(c(0,"app-list",1),v(1,Ts,9,9,"ng-template",null,0,Y),r()),e&2&&p("config",Be(2,Os))("items",n.sessions)},dependencies:[w,Bi,Gt],styles:[".session-item[_ngcontent-%COMP%]{padding:12px 16px;border-bottom:1px solid #eee;transition:background-color .2s}.session-item[_ngcontent-%COMP%]:hover:not(.disabled){background:#f6f8fa}.session-item.selected[_ngcontent-%COMP%]{background:#f1f8ff;border-left:3px solid #0366d6;cursor:default}.session-item.disabled[_ngcontent-%COMP%]{cursor:not-allowed}.session-item[_ngcontent-%COMP%]   .session-title[_ngcontent-%COMP%]{font-size:14px;font-weight:500;margin-bottom:4px;color:#24292e}.session-item[_ngcontent-%COMP%]   .session-meta[_ngcontent-%COMP%]{font-size:12px;color:#586069;display:flex;gap:16px}.session-item[_ngcontent-%COMP%]   .session-meta[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{display:flex;align-items:center}"]})};var Ra=(()=>{class i{constructor(e,n){this._renderer=e,this._elementRef=n,this.onChange=a=>{},this.onTouched=()=>{}}setProperty(e,n){this._renderer.setProperty(this._elementRef.nativeElement,e,n)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}static{this.\u0275fac=function(n){return new(n||i)(m(Te),m(N))}}static{this.\u0275dir=H({type:i})}}return i})(),ai=(()=>{class i extends Ra{static{this.\u0275fac=(()=>{let e;return function(a){return(e||(e=_t(i)))(a||i)}})()}static{this.\u0275dir=H({type:i,features:[re]})}}return i})(),pt=new Z("");var Vs={provide:pt,useExisting:De(()=>Ie),multi:!0};function Es(){let i=zn()?zn().getUserAgent():"";return/android (\d+)/.test(i.toLowerCase())}var qs=new Z(""),Ie=(()=>{class i extends Ra{constructor(e,n,a){super(e,n),this._compositionMode=a,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!Es())}writeValue(e){let n=e??"";this.setProperty("value",n)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}static{this.\u0275fac=function(n){return new(n||i)(m(Te),m(N),m(qs,8))}}static{this.\u0275dir=H({type:i,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(n,a){n&1&&g("input",function(s){return a._handleInput(s.target.value)})("blur",function(){return a.onTouched()})("compositionstart",function(){return a._compositionStart()})("compositionend",function(s){return a._compositionEnd(s.target.value)})},features:[oe([Vs]),re]})}}return i})();function be(i){return i==null||(typeof i=="string"||Array.isArray(i))&&i.length===0}function ja(i){return i!=null&&typeof i.length=="number"}var oi=new Z(""),si=new Z(""),Fs=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Ze=class{static min(t){return zs(t)}static max(t){return Bs(t)}static required(t){return Hs(t)}static requiredTrue(t){return Rs(t)}static email(t){return js(t)}static minLength(t){return Ns(t)}static maxLength(t){return Us(t)}static pattern(t){return Gs(t)}static nullValidator(t){return Na(t)}static compose(t){return Xa(t)}static composeAsync(t){return Qa(t)}};function zs(i){return t=>{if(be(t.value)||be(i))return null;let e=parseFloat(t.value);return!isNaN(e)&&e<i?{min:{min:i,actual:t.value}}:null}}function Bs(i){return t=>{if(be(t.value)||be(i))return null;let e=parseFloat(t.value);return!isNaN(e)&&e>i?{max:{max:i,actual:t.value}}:null}}function Hs(i){return be(i.value)?{required:!0}:null}function Rs(i){return i.value===!0?null:{required:!0}}function js(i){return be(i.value)||Fs.test(i.value)?null:{email:!0}}function Ns(i){return t=>be(t.value)||!ja(t.value)?null:t.value.length<i?{minlength:{requiredLength:i,actualLength:t.value.length}}:null}function Us(i){return t=>ja(t.value)&&t.value.length>i?{maxlength:{requiredLength:i,actualLength:t.value.length}}:null}function Gs(i){if(!i)return Na;let t,e;return typeof i=="string"?(e="",i.charAt(0)!=="^"&&(e+="^"),e+=i,i.charAt(i.length-1)!=="$"&&(e+="$"),t=new RegExp(e)):(e=i.toString(),t=i),n=>{if(be(n.value))return null;let a=n.value;return t.test(a)?null:{pattern:{requiredPattern:e,actualValue:a}}}}function Na(i){return null}function Ua(i){return i!=null}function Ga(i){return Oi(i)?mi(i):i}function Wa(i){let t={};return i.forEach(e=>{t=e!=null?V(V({},t),e):t}),Object.keys(t).length===0?null:t}function Za(i,t){return t.map(e=>e(i))}function Ws(i){return!i.validate}function $a(i){return i.map(t=>Ws(t)?t:e=>t.validate(e))}function Xa(i){if(!i)return null;let t=i.filter(Ua);return t.length==0?null:function(e){return Wa(Za(e,t))}}function Ka(i){return i!=null?Xa($a(i)):null}function Qa(i){if(!i)return null;let t=i.filter(Ua);return t.length==0?null:function(e){let n=Za(e,t).map(Ga);return fi(n).pipe(ft(Wa))}}function Ja(i){return i!=null?Qa($a(i)):null}function Oa(i,t){return i===null?[t]:Array.isArray(i)?[...i,t]:[i,t]}function Ya(i){return i._rawValidators}function eo(i){return i._rawAsyncValidators}function Jn(i){return i?Array.isArray(i)?i:[i]:[]}function $t(i,t){return Array.isArray(i)?i.includes(t):i===t}function Ta(i,t){let e=Jn(t);return Jn(i).forEach(a=>{$t(e,a)||e.push(a)}),e}function Va(i,t){return Jn(t).filter(e=>!$t(i,e))}var Xt=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=Ka(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=Ja(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t=void 0){this.control&&this.control.reset(t)}hasError(t,e){return this.control?this.control.hasError(t,e):!1}getError(t,e){return this.control?this.control.getError(t,e):null}},qe=class extends Xt{get formDirective(){return null}get path(){return null}},Fe=class extends Xt{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},Kt=class{constructor(t){this._cd=t}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},Zs={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},Kd=B(V({},Zs),{"[class.ng-submitted]":"isSubmitted"}),Xe=(()=>{class i extends Kt{constructor(e){super(e)}static{this.\u0275fac=function(n){return new(n||i)(m(Fe,2))}}static{this.\u0275dir=H({type:i,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(n,a){n&2&&L("ng-untouched",a.isUntouched)("ng-touched",a.isTouched)("ng-pristine",a.isPristine)("ng-dirty",a.isDirty)("ng-valid",a.isValid)("ng-invalid",a.isInvalid)("ng-pending",a.isPending)},features:[re]})}}return i})(),tn=(()=>{class i extends Kt{constructor(e){super(e)}static{this.\u0275fac=function(n){return new(n||i)(m(qe,10))}}static{this.\u0275dir=H({type:i,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(n,a){n&2&&L("ng-untouched",a.isUntouched)("ng-touched",a.isTouched)("ng-pristine",a.isPristine)("ng-dirty",a.isDirty)("ng-valid",a.isValid)("ng-invalid",a.isInvalid)("ng-pending",a.isPending)("ng-submitted",a.isSubmitted)},features:[re]})}}return i})();var rt="VALID",Zt="INVALID",Ge="PENDING",ct="DISABLED",we=class{},Qt=class extends we{constructor(t,e){super(),this.value=t,this.source=e}},dt=class extends we{constructor(t,e){super(),this.pristine=t,this.source=e}},ht=class extends we{constructor(t,e){super(),this.touched=t,this.source=e}},We=class extends we{constructor(t,e){super(),this.status=t,this.source=e}},Yn=class extends we{constructor(t){super(),this.source=t}},ei=class extends we{constructor(t){super(),this.source=t}};function ri(i){return(nn(i)?i.validators:i)||null}function $s(i){return Array.isArray(i)?Ka(i):i||null}function ci(i,t){return(nn(t)?t.asyncValidators:i)||null}function Xs(i){return Array.isArray(i)?Ja(i):i||null}function nn(i){return i!=null&&!Array.isArray(i)&&typeof i=="object"}function to(i,t,e){let n=i.controls;if(!(t?Object.keys(n):n).length)throw new Ct(1e3,"");if(!n[e])throw new Ct(1001,"")}function no(i,t,e){i._forEachChild((n,a)=>{if(e[a]===void 0)throw new Ct(1002,"")})}var $e=class{constructor(t,e){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this._status=tt(()=>this.statusReactive()),this.statusReactive=ve(void 0),this._pristine=tt(()=>this.pristineReactive()),this.pristineReactive=ve(!0),this._touched=tt(()=>this.touchedReactive()),this.touchedReactive=ve(!1),this._events=new q,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(t),this._assignAsyncValidators(e)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get status(){return Ce(this.statusReactive)}set status(t){Ce(()=>this.statusReactive.set(t))}get valid(){return this.status===rt}get invalid(){return this.status===Zt}get pending(){return this.status==Ge}get disabled(){return this.status===ct}get enabled(){return this.status!==ct}get pristine(){return Ce(this.pristineReactive)}set pristine(t){Ce(()=>this.pristineReactive.set(t))}get dirty(){return!this.pristine}get touched(){return Ce(this.touchedReactive)}set touched(t){Ce(()=>this.touchedReactive.set(t))}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._assignValidators(t)}setAsyncValidators(t){this._assignAsyncValidators(t)}addValidators(t){this.setValidators(Ta(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(Ta(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(Va(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(Va(t,this._rawAsyncValidators))}hasValidator(t){return $t(this._rawValidators,t)}hasAsyncValidator(t){return $t(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){let e=this.touched===!1;this.touched=!0;let n=t.sourceControl??this;this._parent&&!t.onlySelf&&this._parent.markAsTouched(B(V({},t),{sourceControl:n})),e&&t.emitEvent!==!1&&this._events.next(new ht(!0,n))}markAllAsTouched(t={}){this.markAsTouched({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:this}),this._forEachChild(e=>e.markAllAsTouched(t))}markAsUntouched(t={}){let e=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let n=t.sourceControl??this;this._forEachChild(a=>{a.markAsUntouched({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:n})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t,n),e&&t.emitEvent!==!1&&this._events.next(new ht(!1,n))}markAsDirty(t={}){let e=this.pristine===!0;this.pristine=!1;let n=t.sourceControl??this;this._parent&&!t.onlySelf&&this._parent.markAsDirty(B(V({},t),{sourceControl:n})),e&&t.emitEvent!==!1&&this._events.next(new dt(!1,n))}markAsPristine(t={}){let e=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let n=t.sourceControl??this;this._forEachChild(a=>{a.markAsPristine({onlySelf:!0,emitEvent:t.emitEvent})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t,n),e&&t.emitEvent!==!1&&this._events.next(new dt(!0,n))}markAsPending(t={}){this.status=Ge;let e=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new We(this.status,e)),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.markAsPending(B(V({},t),{sourceControl:e}))}disable(t={}){let e=this._parentMarkedDirty(t.onlySelf);this.status=ct,this.errors=null,this._forEachChild(a=>{a.disable(B(V({},t),{onlySelf:!0}))}),this._updateValue();let n=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new Qt(this.value,n)),this._events.next(new We(this.status,n)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(B(V({},t),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(a=>a(!0))}enable(t={}){let e=this._parentMarkedDirty(t.onlySelf);this.status=rt,this._forEachChild(n=>{n.enable(B(V({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(B(V({},t),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(n=>n(!1))}_updateAncestors(t,e){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine({},e),this._parent._updateTouched({},e))}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let n=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===rt||this.status===Ge)&&this._runAsyncValidator(n,t.emitEvent)}let e=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new Qt(this.value,e)),this._events.next(new We(this.status,e)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(B(V({},t),{sourceControl:e}))}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?ct:rt}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t,e){if(this.asyncValidator){this.status=Ge,this._hasOwnPendingAsyncValidator={emitEvent:e!==!1};let n=Ga(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(a=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(a,{emitEvent:e,shouldHaveEmitted:t})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let t=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,t}return!1}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(e.emitEvent!==!1,this,e.shouldHaveEmitted)}get(t){let e=t;return e==null||(Array.isArray(e)||(e=e.split(".")),e.length===0)?null:e.reduce((n,a)=>n&&n._find(a),this)}getError(t,e){let n=e?this.get(e):this;return n&&n.errors?n.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t,e,n){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),(t||n)&&this._events.next(new We(this.status,e)),this._parent&&this._parent._updateControlsErrors(t,e,n)}_initObservables(){this.valueChanges=new f,this.statusChanges=new f}_calculateStatus(){return this._allControlsDisabled()?ct:this.errors?Zt:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Ge)?Ge:this._anyControlsHaveStatus(Zt)?Zt:rt}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t,e){let n=!this._anyControlsDirty(),a=this.pristine!==n;this.pristine=n,this._parent&&!t.onlySelf&&this._parent._updatePristine(t,e),a&&this._events.next(new dt(this.pristine,e))}_updateTouched(t={},e){this.touched=this._anyControlsTouched(),this._events.next(new ht(this.touched,e)),this._parent&&!t.onlySelf&&this._parent._updateTouched(t,e)}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){nn(t)&&t.updateOn!=null&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){let e=this._parent&&this._parent.dirty;return!t&&!!e&&!this._parent._anyControlsDirty()}_find(t){return null}_assignValidators(t){this._rawValidators=Array.isArray(t)?t.slice():t,this._composedValidatorFn=$s(this._rawValidators)}_assignAsyncValidators(t){this._rawAsyncValidators=Array.isArray(t)?t.slice():t,this._composedAsyncValidatorFn=Xs(this._rawAsyncValidators)}},Jt=class extends $e{constructor(t,e,n){super(ri(e),ci(n,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(t,e,n={}){this.registerControl(t,e),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}removeControl(t,e={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(t,e,n={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,e={}){no(this,!0,t),Object.keys(t).forEach(n=>{to(this,!0,n),this.controls[n].setValue(t[n],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){t!=null&&(Object.keys(t).forEach(n=>{let a=this.controls[n];a&&a.patchValue(t[n],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t={},e={}){this._forEachChild((n,a)=>{n.reset(t?t[a]:null,{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(t,e,n)=>(t[n]=e.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(e,n)=>n._syncPendingControls()?!0:e);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(e=>{let n=this.controls[e];n&&t(n,e)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(let[e,n]of Object.entries(this.controls))if(this.contains(e)&&t(n))return!0;return!1}_reduceValue(){let t={};return this._reduceChildren(t,(e,n,a)=>((n.enabled||this.disabled)&&(e[a]=n.value),e))}_reduceChildren(t,e){let n=t;return this._forEachChild((a,o)=>{n=e(n,a,o)}),n}_allControlsDisabled(){for(let t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}};var ti=class extends Jt{};var an=new Z("CallSetDisabledState",{providedIn:"root",factory:()=>on}),on="always";function io(i,t){return[...t.path,i]}function ni(i,t,e=on){di(i,t),t.valueAccessor.writeValue(i.value),(i.disabled||e==="always")&&t.valueAccessor.setDisabledState?.(i.disabled),Qs(i,t),Ys(i,t),Js(i,t),Ks(i,t)}function Ea(i,t,e=!0){let n=()=>{};t.valueAccessor&&(t.valueAccessor.registerOnChange(n),t.valueAccessor.registerOnTouched(n)),en(i,t),i&&(t._invokeOnDestroyCallbacks(),i._registerOnCollectionChange(()=>{}))}function Yt(i,t){i.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function Ks(i,t){if(t.valueAccessor.setDisabledState){let e=n=>{t.valueAccessor.setDisabledState(n)};i.registerOnDisabledChange(e),t._registerOnDestroy(()=>{i._unregisterOnDisabledChange(e)})}}function di(i,t){let e=Ya(i);t.validator!==null?i.setValidators(Oa(e,t.validator)):typeof e=="function"&&i.setValidators([e]);let n=eo(i);t.asyncValidator!==null?i.setAsyncValidators(Oa(n,t.asyncValidator)):typeof n=="function"&&i.setAsyncValidators([n]);let a=()=>i.updateValueAndValidity();Yt(t._rawValidators,a),Yt(t._rawAsyncValidators,a)}function en(i,t){let e=!1;if(i!==null){if(t.validator!==null){let a=Ya(i);if(Array.isArray(a)&&a.length>0){let o=a.filter(s=>s!==t.validator);o.length!==a.length&&(e=!0,i.setValidators(o))}}if(t.asyncValidator!==null){let a=eo(i);if(Array.isArray(a)&&a.length>0){let o=a.filter(s=>s!==t.asyncValidator);o.length!==a.length&&(e=!0,i.setAsyncValidators(o))}}}let n=()=>{};return Yt(t._rawValidators,n),Yt(t._rawAsyncValidators,n),e}function Qs(i,t){t.valueAccessor.registerOnChange(e=>{i._pendingValue=e,i._pendingChange=!0,i._pendingDirty=!0,i.updateOn==="change"&&ao(i,t)})}function Js(i,t){t.valueAccessor.registerOnTouched(()=>{i._pendingTouched=!0,i.updateOn==="blur"&&i._pendingChange&&ao(i,t),i.updateOn!=="submit"&&i.markAsTouched()})}function ao(i,t){i._pendingDirty&&i.markAsDirty(),i.setValue(i._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(i._pendingValue),i._pendingChange=!1}function Ys(i,t){let e=(n,a)=>{t.valueAccessor.writeValue(n),a&&t.viewToModelUpdate(n)};i.registerOnChange(e),t._registerOnDestroy(()=>{i._unregisterOnChange(e)})}function e1(i,t){i==null,di(i,t)}function t1(i,t){return en(i,t)}function oo(i,t){if(!i.hasOwnProperty("model"))return!1;let e=i.model;return e.isFirstChange()?!0:!Object.is(t,e.currentValue)}function n1(i){return Object.getPrototypeOf(i.constructor)===ai}function i1(i,t){i._syncPendingControls(),t.forEach(e=>{let n=e.control;n.updateOn==="submit"&&n._pendingChange&&(e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1)})}function so(i,t){if(!t)return null;Array.isArray(t);let e,n,a;return t.forEach(o=>{o.constructor===Ie?e=o:n1(o)?n=o:a=o}),a||n||e||null}function a1(i,t){let e=i.indexOf(t);e>-1&&i.splice(e,1)}function qa(i,t){let e=i.indexOf(t);e>-1&&i.splice(e,1)}function Fa(i){return typeof i=="object"&&i!==null&&Object.keys(i).length===2&&"value"in i&&"disabled"in i}var lt=class extends $e{constructor(t=null,e,n){super(ri(e),ci(n,e)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),nn(e)&&(e.nonNullable||e.initialValueIsDefault)&&(Fa(t)?this.defaultValue=t.value:this.defaultValue=t)}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&e.emitModelToViewChange!==!1&&this._onChange.forEach(n=>n(this.value,e.emitViewToModelChange!==!1)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=this.defaultValue,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){qa(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){qa(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(t){Fa(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}};var o1=i=>i instanceof lt;var s1={provide:Fe,useExisting:De(()=>hi)},za=Promise.resolve(),hi=(()=>{class i extends Fe{constructor(e,n,a,o,s,h){super(),this._changeDetectorRef=s,this.callSetDisabledState=h,this.control=new lt,this._registered=!1,this.name="",this.update=new f,this._parent=e,this._setValidators(n),this._setAsyncValidators(a),this.valueAccessor=so(this,o)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){let n=e.name.previousValue;this.formDirective.removeControl({name:n,path:this._getPath(n)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),oo(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){ni(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(e){za.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(e){let n=e.isDisabled.currentValue,a=n!==0&&Ee(n);za.then(()=>{a&&!this.control.disabled?this.control.disable():!a&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(e){return this._parent?io(e,this._parent):[e]}static{this.\u0275fac=function(n){return new(n||i)(m(qe,9),m(oi,10),m(si,10),m(pt,10),m(pe,8),m(an,8))}}static{this.\u0275dir=H({type:i,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[oe([s1]),re,j]})}}return i})(),sn=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275dir=H({type:i,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]})}}return i})();var ro=new Z("");var r1={provide:qe,useExisting:De(()=>ut)},ut=(()=>{class i extends qe{get submitted(){return Ce(this._submittedReactive)}set submitted(e){this._submittedReactive.set(e)}constructor(e,n,a){super(),this.callSetDisabledState=a,this._submitted=tt(()=>this._submittedReactive()),this._submittedReactive=ve(!1),this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new f,this._setValidators(e),this._setAsyncValidators(n)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(en(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){let n=this.form.get(e.path);return ni(n,e,this.callSetDisabledState),n.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),n}getControl(e){return this.form.get(e.path)}removeControl(e){Ea(e.control||null,e,!1),a1(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,n){this.form.get(e.path).setValue(n)}onSubmit(e){return this._submittedReactive.set(!0),i1(this.form,this.directives),this.ngSubmit.emit(e),this.form._events.next(new Yn(this.control)),e?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(e=void 0){this.form.reset(e),this._submittedReactive.set(!1),this.form._events.next(new ei(this.form))}_updateDomValue(){this.directives.forEach(e=>{let n=e.control,a=this.form.get(e.path);n!==a&&(Ea(n||null,e),o1(a)&&(ni(a,e,this.callSetDisabledState),e.control=a))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){let n=this.form.get(e.path);e1(n,e),n.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){let n=this.form.get(e.path);n&&t1(n,e)&&n.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){di(this.form,this),this._oldForm&&en(this._oldForm,this)}_checkFormPresent(){this.form}static{this.\u0275fac=function(n){return new(n||i)(m(oi,10),m(si,10),m(an,8))}}static{this.\u0275dir=H({type:i,selectors:[["","formGroup",""]],hostBindings:function(n,a){n&1&&g("submit",function(s){return a.onSubmit(s)})("reset",function(){return a.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[oe([r1]),re,j]})}}return i})();var c1={provide:Fe,useExisting:De(()=>yt)},yt=(()=>{class i extends Fe{set isDisabled(e){}static{this._ngModelWarningSentOnce=!1}constructor(e,n,a,o,s){super(),this._ngModelWarningConfig=s,this._added=!1,this.name=null,this.update=new f,this._ngModelWarningSent=!1,this._parent=e,this._setValidators(n),this._setAsyncValidators(a),this.valueAccessor=so(this,o)}ngOnChanges(e){this._added||this._setUpControl(),oo(e,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}get path(){return io(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}static{this.\u0275fac=function(n){return new(n||i)(m(qe,13),m(oi,10),m(si,10),m(pt,10),m(ro,8))}}static{this.\u0275dir=H({type:i,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[oe([c1]),re,j]})}}return i})(),d1={provide:pt,useExisting:De(()=>ho),multi:!0};function co(i,t){return i==null?`${t}`:(t&&typeof t=="object"&&(t="Object"),`${i}: ${t}`.slice(0,50))}function h1(i){return i.split(":")[0]}var ho=(()=>{class i extends ai{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){this.value=e;let n=this._getOptionId(e),a=co(n,e);this.setProperty("value",a)}registerOnChange(e){this.onChange=n=>{this.value=this._getOptionValue(n),e(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(e){for(let n of this._optionMap.keys())if(this._compareWith(this._optionMap.get(n),e))return n;return null}_getOptionValue(e){let n=h1(e);return this._optionMap.has(n)?this._optionMap.get(n):e}static{this.\u0275fac=(()=>{let e;return function(a){return(e||(e=_t(i)))(a||i)}})()}static{this.\u0275dir=H({type:i,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(n,a){n&1&&g("change",function(s){return a.onChange(s.target.value)})("blur",function(){return a.onTouched()})},inputs:{compareWith:"compareWith"},features:[oe([d1]),re]})}}return i})(),lo=(()=>{class i{constructor(e,n,a){this._element=e,this._renderer=n,this._select=a,this._select&&(this.id=this._select._registerOption())}set ngValue(e){this._select!=null&&(this._select._optionMap.set(this.id,e),this._setElementValue(co(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._setElementValue(e),this._select&&this._select.writeValue(this._select.value)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static{this.\u0275fac=function(n){return new(n||i)(m(N),m(Te),m(ho,9))}}static{this.\u0275dir=H({type:i,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}}return i})(),l1={provide:pt,useExisting:De(()=>po),multi:!0};function Ba(i,t){return i==null?`${t}`:(typeof t=="string"&&(t=`'${t}'`),t&&typeof t=="object"&&(t="Object"),`${i}: ${t}`.slice(0,50))}function p1(i){return i.split(":")[0]}var po=(()=>{class i extends ai{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(e){this._compareWith=e}writeValue(e){this.value=e;let n;if(Array.isArray(e)){let a=e.map(o=>this._getOptionId(o));n=(o,s)=>{o._setSelected(a.indexOf(s.toString())>-1)}}else n=(a,o)=>{a._setSelected(!1)};this._optionMap.forEach(n)}registerOnChange(e){this.onChange=n=>{let a=[],o=n.selectedOptions;if(o!==void 0){let s=o;for(let h=0;h<s.length;h++){let k=s[h],y=this._getOptionValue(k.value);a.push(y)}}else{let s=n.options;for(let h=0;h<s.length;h++){let k=s[h];if(k.selected){let y=this._getOptionValue(k.value);a.push(y)}}}this.value=a,e(a)}}_registerOption(e){let n=(this._idCounter++).toString();return this._optionMap.set(n,e),n}_getOptionId(e){for(let n of this._optionMap.keys())if(this._compareWith(this._optionMap.get(n)._value,e))return n;return null}_getOptionValue(e){let n=p1(e);return this._optionMap.has(n)?this._optionMap.get(n)._value:e}static{this.\u0275fac=(()=>{let e;return function(a){return(e||(e=_t(i)))(a||i)}})()}static{this.\u0275dir=H({type:i,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(n,a){n&1&&g("change",function(s){return a.onChange(s.target)})("blur",function(){return a.onTouched()})},inputs:{compareWith:"compareWith"},features:[oe([l1]),re]})}}return i})(),uo=(()=>{class i{constructor(e,n,a){this._element=e,this._renderer=n,this._select=a,this._select&&(this.id=this._select._registerOption(this))}set ngValue(e){this._select!=null&&(this._value=e,this._setElementValue(Ba(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._select?(this._value=e,this._setElementValue(Ba(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}_setSelected(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static{this.\u0275fac=function(n){return new(n||i)(m(N),m(Te),m(po,9))}}static{this.\u0275dir=H({type:i,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}})}}return i})();var yo=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=ne({type:i})}static{this.\u0275inj=te({})}}return i})(),ii=class extends $e{constructor(t,e,n){super(ri(e),ci(n,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(t){return this.controls[this._adjustIndex(t)]}push(t,e={}){this.controls.push(t),this._registerControl(t),this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}insert(t,e,n={}){this.controls.splice(t,0,e),this._registerControl(e),this.updateValueAndValidity({emitEvent:n.emitEvent})}removeAt(t,e={}){let n=this._adjustIndex(t);n<0&&(n=0),this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),this.controls.splice(n,1),this.updateValueAndValidity({emitEvent:e.emitEvent})}setControl(t,e,n={}){let a=this._adjustIndex(t);a<0&&(a=0),this.controls[a]&&this.controls[a]._registerOnCollectionChange(()=>{}),this.controls.splice(a,1),e&&(this.controls.splice(a,0,e),this._registerControl(e)),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(t,e={}){no(this,!1,t),t.forEach((n,a)=>{to(this,!1,a),this.at(a).setValue(n,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){t!=null&&(t.forEach((n,a)=>{this.at(a)&&this.at(a).patchValue(n,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t=[],e={}){this._forEachChild((n,a)=>{n.reset(t[a],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e)}getRawValue(){return this.controls.map(t=>t.getRawValue())}clear(t={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:t.emitEvent}))}_adjustIndex(t){return t<0?t+this.length:t}_syncPendingControls(){let t=this.controls.reduce((e,n)=>n._syncPendingControls()?!0:e,!1);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){this.controls.forEach((e,n)=>{t(e,n)})}_updateValue(){this.value=this.controls.filter(t=>t.enabled||this.disabled).map(t=>t.value)}_anyControls(t){return this.controls.some(e=>e.enabled&&t(e))}_setUpControls(){this._forEachChild(t=>this._registerControl(t))}_allControlsDisabled(){for(let t of this.controls)if(t.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(t){t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)}_find(t){return this.at(t)??null}};function Ha(i){return!!i&&(i.asyncValidators!==void 0||i.validators!==void 0||i.updateOn!==void 0)}var rn=(()=>{class i{constructor(){this.useNonNullable=!1}get nonNullable(){let e=new i;return e.useNonNullable=!0,e}group(e,n=null){let a=this._reduceControls(e),o={};return Ha(n)?o=n:n!==null&&(o.validators=n.validator,o.asyncValidators=n.asyncValidator),new Jt(a,o)}record(e,n=null){let a=this._reduceControls(e);return new ti(a,n)}control(e,n,a){let o={};return this.useNonNullable?(Ha(n)?o=n:(o.validators=n,o.asyncValidators=a),new lt(e,B(V({},o),{nonNullable:!0}))):new lt(e,n,a)}array(e,n,a){let o=e.map(s=>this._createControl(s));return new ii(o,n,a)}_reduceControls(e){let n={};return Object.keys(e).forEach(a=>{n[a]=this._createControl(e[a])}),n}_createControl(e){if(e instanceof lt)return e;if(e instanceof $e)return e;if(Array.isArray(e)){let n=e[0],a=e.length>1?e[1]:null,o=e.length>2?e[2]:null;return this.control(n,a,o)}else return this.control(e)}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=$({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Ke=(()=>{class i{static withConfig(e){return{ngModule:i,providers:[{provide:an,useValue:e.callSetDisabledState??on}]}}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=ne({type:i})}static{this.\u0275inj=te({imports:[yo]})}}return i})(),cn=(()=>{class i{static withConfig(e){return{ngModule:i,providers:[{provide:ro,useValue:e.warnOnNgModelWithFormControl??"always"},{provide:an,useValue:e.callSetDisabledState??on}]}}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=ne({type:i})}static{this.\u0275inj=te({imports:[yo]})}}return i})();var u1=()=>[];function y1(i,t){i&1&&(c(0,"div",9),u(1," This may take a moment... "),r())}function k1(i,t){if(i&1&&(c(0,"div",10),u(1),r()),i&2){let e=l();d(),T(" ",e.analysisError," ")}}function m1(i,t){if(i&1&&(c(0,"span",23),u(1),r()),i&2){let e=l(2);d(),T("Model: ",e.analysis.model,"")}}function g1(i,t){if(i&1&&(c(0,"div",32)(1,"div",33),u(2,"Navigation Points:"),r(),c(3,"div",34),u(4),r()()),i&2){let e=l().$implicit;d(4),T(" ",(e.navigationPoints||Be(1,u1)).join(", ")," ")}}function f1(i,t){if(i&1&&(c(0,"div",24)(1,"div",25)(2,"h4",26),u(3),r()(),c(4,"div",27),u(5),r(),c(6,"div",28)(7,"div",29),u(8,"Key Interactions:"),r(),c(9,"div",30),u(10),r()(),v(11,g1,5,2,"div",31),r()),i&2){let e=t.$implicit;d(3),A(e.name),d(2),A(e.description),d(5),T(" ",e.keyInteractions.join(", ")," "),d(),p("ngIf",e.navigationPoints==null?null:e.navigationPoints.length)}}function v1(i,t){if(i&1&&(c(0,"div",35)(1,"span",36),u(2),r(),c(3,"span",37),u(4),r(),c(5,"span",38),u(6),r()()),i&2){let e=t.$implicit;d(2),A(e.key),d(2),A(e.topic),d(2),T("Part ",e.part,"")}}function M1(i,t){if(i&1&&(c(0,"div",11)(1,"div",12)(2,"h2"),u(3,"Analysis Results"),r(),c(4,"div",13)(5,"span",14),u(6),r(),v(7,m1,2,1,"span",15),r()(),c(8,"div",16)(9,"h3"),u(10,"Title"),r(),c(11,"div",17),u(12),r()(),c(13,"div",16)(14,"h3"),u(15,"Summary"),r(),c(16,"div",18),u(17),r()(),c(18,"div",16)(19,"h3"),u(20,"Topics"),r(),c(21,"div",19),v(22,f1,12,4,"div",20),r()(),c(23,"div",16)(24,"h3"),u(25,"Navigation Timeline"),r(),c(26,"div",21),v(27,v1,7,3,"div",22),r()()()),i&2){let e=l();d(6),T("Provider: ",e.analysis.provider,""),d(),p("ngIf",e.analysis.model),d(5),A(e.analysis.title),d(5),A(e.analysis.summary),d(5),p("ngForOf",e.analysis.topics),d(5),p("ngForOf",e.analysis.navigationPoints)}}var ko=class i{constructor(t){this.chatSessionService=t}session;sessionId;saved=new f;approving=!1;loading=!1;analyzing=!1;error=null;analysisError=null;analysis=null;ngOnInit(){this.initializeComponent()}ngOnChanges(t){(t.session||t.sessionId)&&this.initializeComponent()}initializeComponent(){this.session?this.loadLatestAnalysis():this.sessionId&&this.loadSession()}loadSession(){this.sessionId&&(this.loading=!0,this.error=null,this.chatSessionService.getSession(this.sessionId).subscribe({next:t=>{this.session=t,this.loading=!1,this.loadLatestAnalysis()},error:t=>{this.error="Failed to load session data",this.loading=!1}}))}loadLatestAnalysis(){this.session&&this.chatSessionService.getLatestAnalysis(this.session.id).subscribe({next:t=>{this.analysis=t},error:t=>{t.status!==404&&(this.analysisError="Failed to load analysis",console.error("Error loading analysis:",t)),this.analysis=null}})}analyzeSession(){this.session&&(this.analyzing=!0,this.analysisError=null,this.chatSessionService.analyzeSession(this.session.id).subscribe({next:t=>{console.log("Session analysis result:",t),this.analyzing=!1},error:t=>{this.analysisError="Failed to analyze session",this.analyzing=!1,console.error("Error analyzing session:",t)}}))}approveSession(){if(!this.session||!this.analysis)return;let t={title:this.analysis.title,description:this.analysis.summary,status:"approved",interactionsCount:this.session.interactionsCount};this.approving=!0,this.chatSessionService.updateSession(this.session.id,t).subscribe({next:e=>{this.approving=!1,this.saved.emit(e)},error:()=>{this.approving=!1,this.error="Failed to approve session"}})}getOrderedNavigationPoints(t){return this.analysis?this.analysis.topics.find(n=>n.name===t)?.navigationPoints?.sort((n,a)=>n-a)||[]:[]}static \u0275fac=function(e){return new(e||i)(m(St))};static \u0275cmp=_({type:i,selectors:[["app-session-editor"]],inputs:{session:"session",sessionId:"sessionId"},outputs:{saved:"saved"},standalone:!0,features:[j,x],decls:12,vars:8,consts:[[1,"session-editor"],[1,"session-info"],[1,"interactions-count"],[1,"action-bar"],[1,"analyze-button",3,"click","disabled"],[1,"approve-button",3,"click","disabled"],["class","analyzing-indicator",4,"ngIf"],["class","error-message",4,"ngIf"],["class","analysis-results",4,"ngIf"],[1,"analyzing-indicator"],[1,"error-message"],[1,"analysis-results"],[1,"analysis-header"],[1,"analysis-meta"],[1,"provider"],["class","model",4,"ngIf"],[1,"analysis-section"],[1,"analysis-title"],[1,"analysis-summary"],[1,"topics-list"],["class","topic-item",4,"ngFor","ngForOf"],[1,"navigation-timeline"],["class","timeline-point",4,"ngFor","ngForOf"],[1,"model"],[1,"topic-item"],[1,"topic-header"],[1,"topic-name"],[1,"topic-description"],[1,"topic-interactions"],[1,"interaction-label"],[1,"interaction-numbers"],["class","topic-navigation",4,"ngIf"],[1,"topic-navigation"],[1,"navigation-label"],[1,"navigation-numbers"],[1,"timeline-point"],[1,"point-number"],[1,"point-topic"],[1,"point-part"]],template:function(e,n){e&1&&(c(0,"div",0)(1,"div",1)(2,"span",2),u(3),r()(),c(4,"div",3)(5,"button",4),g("click",function(){return n.analyzeSession()}),u(6),r(),c(7,"button",5),g("click",function(){return n.approveSession()}),u(8),r(),v(9,y1,2,0,"div",6),r(),v(10,k1,2,1,"div",7)(11,M1,28,6,"div",8),r()),e&2&&(d(3),T(" Interactions: ",n.session==null?null:n.session.interactionsCount," "),d(2),p("disabled",n.analyzing||!!n.analysis),d(),T(" ",n.analyzing?"Analyzing...":"Analyze Session"," "),d(),p("disabled",!n.analysis||n.approving),d(),T(" ",n.approving?"Approving...":"Approve Session"," "),d(),p("ngIf",n.analyzing),d(),p("ngIf",n.analysisError),d(),p("ngIf",n.analysis))},dependencies:[w,W,O,Ke],styles:['.session-editor[_ngcontent-%COMP%]{padding:20px}.session-editor[_ngcontent-%COMP%]   .session-info[_ngcontent-%COMP%]{margin-bottom:16px}.session-editor[_ngcontent-%COMP%]   .session-info[_ngcontent-%COMP%]   .interactions-count[_ngcontent-%COMP%]{color:#666;font-size:.9em}.session-editor[_ngcontent-%COMP%]   .action-bar[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:20px;gap:16px}.session-editor[_ngcontent-%COMP%]   .action-bar[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:10px 16px;border-radius:4px;cursor:pointer;font-weight:500;border:none}.session-editor[_ngcontent-%COMP%]   .action-bar[_ngcontent-%COMP%]   button.analyze-button[_ngcontent-%COMP%]{background-color:#6c757d;color:#fff}.session-editor[_ngcontent-%COMP%]   .action-bar[_ngcontent-%COMP%]   button.analyze-button[_ngcontent-%COMP%]:hover{background-color:#5a6268}.session-editor[_ngcontent-%COMP%]   .action-bar[_ngcontent-%COMP%]   button.approve-button[_ngcontent-%COMP%]{background-color:#28a745;color:#fff}.session-editor[_ngcontent-%COMP%]   .action-bar[_ngcontent-%COMP%]   button.approve-button[_ngcontent-%COMP%]:hover{background-color:#218838}.session-editor[_ngcontent-%COMP%]   .action-bar[_ngcontent-%COMP%]   button.approve-button[_ngcontent-%COMP%]:disabled{background-color:#8fd19e;cursor:not-allowed}.session-editor[_ngcontent-%COMP%]   .action-bar[_ngcontent-%COMP%]   .analyzing-indicator[_ngcontent-%COMP%]{color:#6c757d;font-style:italic;display:flex;align-items:center}.session-editor[_ngcontent-%COMP%]   .action-bar[_ngcontent-%COMP%]   .analyzing-indicator[_ngcontent-%COMP%]:before{content:"";display:inline-block;width:16px;height:16px;margin-right:8px;border:2px solid #6c757d;border-top-color:transparent;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}.session-editor[_ngcontent-%COMP%]   .error-message[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24;padding:12px;border-radius:4px;margin-bottom:16px}.session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .analysis-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .analysis-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:#343a40}.session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .analysis-header[_ngcontent-%COMP%]   .analysis-meta[_ngcontent-%COMP%]{font-size:.9em;color:#6c757d}.session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .analysis-header[_ngcontent-%COMP%]   .analysis-meta[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin-left:12px}.session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .analysis-header[_ngcontent-%COMP%]   .analysis-meta[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:first-child{margin-left:0}.session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .analysis-section[_ngcontent-%COMP%]{margin-bottom:24px}.session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .analysis-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;margin-bottom:12px;color:#495057;font-size:1.2em;border-bottom:1px solid #dee2e6;padding-bottom:8px}.session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .analysis-section[_ngcontent-%COMP%]   .analysis-title[_ngcontent-%COMP%]{font-size:1.1em;font-weight:500;color:#212529}.session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .analysis-section[_ngcontent-%COMP%]   .analysis-summary[_ngcontent-%COMP%]{line-height:1.5;color:#212529}.session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .topics-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .topics-list[_ngcontent-%COMP%]   .topic-item[_ngcontent-%COMP%]{background-color:#f8f9fa;border-radius:4px;padding:16px;border-left:4px solid #007bff}.session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .topics-list[_ngcontent-%COMP%]   .topic-item[_ngcontent-%COMP%]   .topic-header[_ngcontent-%COMP%]{margin-bottom:8px}.session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .topics-list[_ngcontent-%COMP%]   .topic-item[_ngcontent-%COMP%]   .topic-header[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;color:#007bff}.session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .topics-list[_ngcontent-%COMP%]   .topic-item[_ngcontent-%COMP%]   .topic-description[_ngcontent-%COMP%]{margin-bottom:12px;line-height:1.4}.session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .topics-list[_ngcontent-%COMP%]   .topic-item[_ngcontent-%COMP%]   .topic-interactions[_ngcontent-%COMP%], .session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .topics-list[_ngcontent-%COMP%]   .topic-item[_ngcontent-%COMP%]   .topic-navigation[_ngcontent-%COMP%]{display:flex;align-items:center;margin-top:8px;font-size:.9em}.session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .topics-list[_ngcontent-%COMP%]   .topic-item[_ngcontent-%COMP%]   .topic-interactions[_ngcontent-%COMP%]   .interaction-label[_ngcontent-%COMP%], .session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .topics-list[_ngcontent-%COMP%]   .topic-item[_ngcontent-%COMP%]   .topic-interactions[_ngcontent-%COMP%]   .navigation-label[_ngcontent-%COMP%], .session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .topics-list[_ngcontent-%COMP%]   .topic-item[_ngcontent-%COMP%]   .topic-navigation[_ngcontent-%COMP%]   .interaction-label[_ngcontent-%COMP%], .session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .topics-list[_ngcontent-%COMP%]   .topic-item[_ngcontent-%COMP%]   .topic-navigation[_ngcontent-%COMP%]   .navigation-label[_ngcontent-%COMP%]{font-weight:500;margin-right:8px;color:#495057}.session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .topics-list[_ngcontent-%COMP%]   .topic-item[_ngcontent-%COMP%]   .topic-interactions[_ngcontent-%COMP%]   .interaction-numbers[_ngcontent-%COMP%], .session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .topics-list[_ngcontent-%COMP%]   .topic-item[_ngcontent-%COMP%]   .topic-interactions[_ngcontent-%COMP%]   .navigation-numbers[_ngcontent-%COMP%], .session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .topics-list[_ngcontent-%COMP%]   .topic-item[_ngcontent-%COMP%]   .topic-navigation[_ngcontent-%COMP%]   .interaction-numbers[_ngcontent-%COMP%], .session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .topics-list[_ngcontent-%COMP%]   .topic-item[_ngcontent-%COMP%]   .topic-navigation[_ngcontent-%COMP%]   .navigation-numbers[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:6px}.session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .topics-list[_ngcontent-%COMP%]   .topic-item[_ngcontent-%COMP%]   .topic-interactions[_ngcontent-%COMP%]   .interaction-numbers[_ngcontent-%COMP%]   .interaction-number[_ngcontent-%COMP%], .session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .topics-list[_ngcontent-%COMP%]   .topic-item[_ngcontent-%COMP%]   .topic-interactions[_ngcontent-%COMP%]   .interaction-numbers[_ngcontent-%COMP%]   .navigation-number[_ngcontent-%COMP%], .session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .topics-list[_ngcontent-%COMP%]   .topic-item[_ngcontent-%COMP%]   .topic-interactions[_ngcontent-%COMP%]   .navigation-numbers[_ngcontent-%COMP%]   .interaction-number[_ngcontent-%COMP%], .session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .topics-list[_ngcontent-%COMP%]   .topic-item[_ngcontent-%COMP%]   .topic-interactions[_ngcontent-%COMP%]   .navigation-numbers[_ngcontent-%COMP%]   .navigation-number[_ngcontent-%COMP%], .session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .topics-list[_ngcontent-%COMP%]   .topic-item[_ngcontent-%COMP%]   .topic-navigation[_ngcontent-%COMP%]   .interaction-numbers[_ngcontent-%COMP%]   .interaction-number[_ngcontent-%COMP%], .session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .topics-list[_ngcontent-%COMP%]   .topic-item[_ngcontent-%COMP%]   .topic-navigation[_ngcontent-%COMP%]   .interaction-numbers[_ngcontent-%COMP%]   .navigation-number[_ngcontent-%COMP%], .session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .topics-list[_ngcontent-%COMP%]   .topic-item[_ngcontent-%COMP%]   .topic-navigation[_ngcontent-%COMP%]   .navigation-numbers[_ngcontent-%COMP%]   .interaction-number[_ngcontent-%COMP%], .session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .topics-list[_ngcontent-%COMP%]   .topic-item[_ngcontent-%COMP%]   .topic-navigation[_ngcontent-%COMP%]   .navigation-numbers[_ngcontent-%COMP%]   .navigation-number[_ngcontent-%COMP%]{background-color:#e9ecef;padding:2px 6px;border-radius:3px;color:#495057}.session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .navigation-timeline[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .navigation-timeline[_ngcontent-%COMP%]   .timeline-point[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px 12px;background-color:#f8f9fa;border-radius:4px}.session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .navigation-timeline[_ngcontent-%COMP%]   .timeline-point[_ngcontent-%COMP%]   .point-number[_ngcontent-%COMP%]{background-color:#007bff;color:#fff;border-radius:50%;width:24px;height:24px;display:flex;align-items:center;justify-content:center;margin-right:12px;font-weight:500;font-size:.9em}.session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .navigation-timeline[_ngcontent-%COMP%]   .timeline-point[_ngcontent-%COMP%]   .point-topic[_ngcontent-%COMP%]{flex:1;font-weight:500;color:#343a40}.session-editor[_ngcontent-%COMP%]   .analysis-results[_ngcontent-%COMP%]   .navigation-timeline[_ngcontent-%COMP%]   .timeline-point[_ngcontent-%COMP%]   .point-part[_ngcontent-%COMP%]{color:#6c757d;font-size:.9em}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}']})};var hn=class i{constructor(t){this.bookService=t}book;saveBook(){this.book&&(this.book.id?this.bookService.updateBook(this.book.id,this.book).subscribe(t=>{this.bookService.setActiveBook(t)}):this.bookService.createBook(this.book).subscribe(t=>{this.bookService.setActiveBook(t)}))}static \u0275fac=function(e){return new(e||i)(m(xe))};static \u0275cmp=_({type:i,selectors:[["app-book-basic-details"]],inputs:{book:"book"},standalone:!0,features:[x],decls:12,vars:2,consts:[[1,"basic-details"],[1,"form-group"],["type","text","placeholder","Enter book title",3,"ngModelChange","ngModel"],["rows","4","placeholder","Enter book description",3,"ngModelChange","ngModel"],[3,"click"]],template:function(e,n){e&1&&(c(0,"div",0)(1,"div",1)(2,"label"),u(3,"Title"),r(),c(4,"input",2),Fn("ngModelChange",function(o){return qn(n.book.title,o)||(n.book.title=o),o}),r()(),c(5,"div",1)(6,"label"),u(7,"Description"),r(),c(8,"textarea",3),Fn("ngModelChange",function(o){return qn(n.book.description,o)||(n.book.description=o),o}),r()(),c(9,"div",1)(10,"button",4),g("click",function(){return n.saveBook()}),u(11,"Save Book"),r()()()),e&2&&(d(4),En("ngModel",n.book.title),d(4),En("ngModel",n.book.description))},dependencies:[w,Ke,Ie,Xe,hi],styles:[".basic-details[_ngcontent-%COMP%]{padding:1rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-weight:500}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:.5rem;border:1px solid #ddd;border-radius:4px}"]})};function C1(i,t){if(i&1&&(c(0,"div",9),D(1,"app-interaction-list",10),r()),i&2){let e=l();d(),p("sessionId",e.selectedSessionId)("ignoreStorage",!0)("ignoreScroll",!0)}}var ln=class i{selectedSessionId;_canSelect=!0;set canSelect(t){this._canSelect=t,this.dialogConfig={title:t?"Select Session":"Preview Session",width:"1200px",height:"100vh",closeOnBackdrop:!0}}get canSelect(){return this._canSelect}selected=new f;cancel=new f;dialogConfig;sessionSelected;onSessionSelected(t){this.sessionSelected=t,this.selectedSessionId=t.id}onConfirm(){this.sessionSelected&&this.selected.emit(this.sessionSelected)}onClose(){this.cancel.emit()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=_({type:i,selectors:[["app-session-picker"]],inputs:{selectedSessionId:"selectedSessionId",canSelect:"canSelect"},outputs:{selected:"selected",cancel:"cancel"},standalone:!0,features:[x],decls:11,vars:5,consts:[[3,"close","config"],[1,"session-picker"],[1,"content-area"],[1,"sessions-panel"],[3,"sessionSelect","selectedId","canSelect"],["class","preview-panel",4,"ngIf"],[1,"actions"],[3,"click","disabled"],[3,"click"],[1,"preview-panel"],[3,"sessionId","ignoreStorage","ignoreScroll"]],template:function(e,n){e&1&&(c(0,"app-dialog",0),g("close",function(){return n.cancel.emit()}),c(1,"div",1)(2,"div",2)(3,"div",3)(4,"app-chat-session-list",4),g("sessionSelect",function(o){return n.onSessionSelected(o)}),r()(),v(5,C1,2,3,"div",5),r(),c(6,"div",6)(7,"button",7),g("click",function(){return n.onConfirm()}),u(8,"Select"),r(),c(9,"button",8),g("click",function(){return n.cancel.emit()}),u(10,"Cancel"),r()()()()),e&2&&(p("config",n.dialogConfig),d(4),p("selectedId",n.selectedSessionId)("canSelect",n.canSelect),d(),p("ngIf",n.selectedSessionId),d(2),p("disabled",!n.selectedSessionId||!n.canSelect))},dependencies:[w,O,je,Wt,Wi],styles:[".session-picker[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.session-picker[_ngcontent-%COMP%]   .content-area[_ngcontent-%COMP%]{display:flex;flex:1;overflow:hidden}.session-picker[_ngcontent-%COMP%]   .content-area[_ngcontent-%COMP%]   .sessions-panel[_ngcontent-%COMP%]{width:25%;border-right:1px solid #eee}.session-picker[_ngcontent-%COMP%]   .content-area[_ngcontent-%COMP%]   .preview-panel[_ngcontent-%COMP%]{width:75%;overflow:auto}.session-picker[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:8px;padding:16px;border-top:1px solid #eee}.session-picker[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:8px 16px;border-radius:4px;border:1px solid #ddd;background:#fff;cursor:pointer}.session-picker[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#f5f5f5}.session-picker[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.session-picker[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{background:#0366d6;color:#fff;border:none}.session-picker[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child:hover{background:#0256b9}"]})};var pn=class i{book;static \u0275fac=function(e){return new(e||i)};static \u0275cmp=_({type:i,selectors:[["app-book-content-editor"]],inputs:{book:"book"},standalone:!0,features:[x],decls:3,vars:0,consts:[[1,"book-editor"],[1,"book-info"],[1,"info-row"]],template:function(e,n){e&1&&(c(0,"div",0)(1,"div",1),D(2,"div",2),r()())},dependencies:[w],styles:[".book-editor[_ngcontent-%COMP%]   .book-info[_ngcontent-%COMP%]{margin-bottom:1rem}.book-editor[_ngcontent-%COMP%]   .book-info[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:.5rem}.book-editor[_ngcontent-%COMP%]   .book-info[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500}"]})};var un=class i{constructor(t){this.fb=t;this.form=this.fb.group({title:["",Ze.required]}),this.form.valueChanges.subscribe(e=>{this.form.valid&&(this.copy.title=this.form.value.title,this.modified.emit(this.copy)),this.canConfirm.emit(this.form.valid)})}copy;_state;set state(t){this._state=t,t=="details"&&this.setCopy(),this.editMode.emit(t!="details")}get state(){return this._state||""}_chapter;set chapter(t){this._chapter=t,this.setCopy()}modified=new f;canConfirm=new f;editMode=new f;form;setCopy(){this.copy=V({},this._chapter),this.form.patchValue({title:this.copy.title||""})}static \u0275fac=function(e){return new(e||i)(m(rn))};static \u0275cmp=_({type:i,selectors:[["app-chapter-editor"]],inputs:{state:"state",chapter:"chapter"},outputs:{modified:"modified",canConfirm:"canConfirm",editMode:"editMode"},standalone:!0,features:[x],decls:6,vars:2,consts:[[1,"chapter-editor"],[3,"formGroup"],[1,"form-group"],["for","title"],["id","title","type","text","formControlName","title","placeholder","Enter chapter title",3,"readonly"]],template:function(e,n){e&1&&(c(0,"div",0)(1,"form",1)(2,"div",2)(3,"label",3),u(4,"Chapter Title"),r(),D(5,"input",4),r()()()),e&2&&(d(),p("formGroup",n.form),d(4),p("readonly",n.state!="edit"&&n.state!="new"))},dependencies:[w,cn,sn,Ie,Xe,tn,ut,yt],styles:[".details-pane[_ngcontent-%COMP%]{padding:1rem;border-left:1px solid #eee}.details-pane[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-bottom:1rem}.details-pane[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .type-badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:4px;background:#f1f8ff;color:#0366d6;font-size:12px;text-transform:capitalize}.chapter-editor[_ngcontent-%COMP%]{padding:1rem}.chapter-editor[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.chapter-editor[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-weight:500}.chapter-editor[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:.5rem;border:1px solid #ccc;border-radius:4px}.chapter-editor[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#666}.chapter-editor[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:read-only{background-color:#eee}"]})};function _1(i,t){if(i&1){let e=I();c(0,"app-session-picker",8),g("selected",function(a){M(e);let o=l();return C(o.onSessionSelected(a))})("cancel",function(){M(e);let a=l();return C(a.onSessionPickerClosed())}),r()}if(i&2){let e=l();p("canSelect",e.canSelect)("selectedSessionId",e.copy.sessionId)}}var yn=class i{constructor(t){this.fb=t;this.form=this.fb.group({title:["",Ze.required]}),this.form.valueChanges.subscribe(e=>{this.form.valid&&(this.copy.title=this.form.value.title,this.modified.emit(this.copy)),this.canConfirm.emit(this.form.valid)})}set picker(t){t?this.showPicker():this.showSessionPicker=!1,console.log(this.canSelect)}_state;set state(t){switch(t){case"details":this.canSelect=!1,this.setCopy();break;case"new":case"edit":this.canSelect=!0;break}this._state=t,this.editMode.emit(t!="details")}get state(){return this._state}_session;set session(t){this._session=t,this.setCopy()}get session(){return this._session}closed=new f;modified=new f;canConfirm=new f;editMode=new f;showSessionPicker=!1;canSelect=!1;copy;form;setCopy(){this.copy=V({},this._session),this.form.patchValue({title:this.copy.title||""})}showPicker(){this.showSessionPicker=!0}onSessionSelected(t){console.log("Selected session:",t.id),this.session&&(this.copy.sessionId=t.id,this.copy.title=t.title,this.form.patchValue({title:this.copy.title||""}),this.modified.emit(this.copy),this.canConfirm.emit(this.form.valid)),this.onSessionPickerClosed()}onSessionPickerClosed(){this.closed.emit(),this.showSessionPicker=!1}static \u0275fac=function(e){return new(e||i)(m(rn))};static \u0275cmp=_({type:i,selectors:[["app-session-content-editor"]],inputs:{picker:"picker",state:"state",session:"session"},outputs:{closed:"closed",modified:"modified",canConfirm:"canConfirm",editMode:"editMode"},standalone:!0,features:[x],decls:13,vars:4,consts:[[1,"session-editor"],[1,"session-info"],[1,"info-row"],[3,"formGroup"],[1,"form-group"],["for","title"],["id","title","type","text","formControlName","title","placeholder","Enter session title",3,"readonly"],[3,"canSelect","selectedSessionId","selected","cancel",4,"ngIf"],[3,"selected","cancel","canSelect","selectedSessionId"]],template:function(e,n){e&1&&(c(0,"div",0)(1,"div",1)(2,"div",2)(3,"label"),u(4,"Session ID:"),r(),c(5,"span"),u(6),r()()(),c(7,"form",3)(8,"div",4)(9,"label",5),u(10,"Session Title"),r(),D(11,"input",6),r()(),v(12,_1,1,2,"app-session-picker",7),r()),e&2&&(d(6),A(n.copy.sessionId),d(),p("formGroup",n.form),d(4),p("readonly",n.state!="edit"&&n.state!="new"),d(),p("ngIf",n.showSessionPicker))},dependencies:[w,O,ln,cn,sn,Ie,Xe,tn,ut,yt],styles:[".session-editor[_ngcontent-%COMP%]   .session-info[_ngcontent-%COMP%]{margin-bottom:1rem}.session-editor[_ngcontent-%COMP%]   .session-info[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:.5rem}.session-editor[_ngcontent-%COMP%]   .session-info[_ngcontent-%COMP%]   .info-row[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500}.session-editor[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.session-editor[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-weight:500}.session-editor[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:.5rem;border:1px solid #ccc;border-radius:4px}.session-editor[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#666}.session-editor[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:read-only{background-color:#eee}.session-editor[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.5rem 1rem;border:1px solid #ddd;border-radius:4px;background:#fff;cursor:pointer}.session-editor[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#f5f5f5}"]})};function x1(i,t){if(i&1&&D(0,"app-book-content-editor",4),i&2){let e=l();p("book",e.selectedItem)}}function b1(i,t){if(i&1){let e=I();c(0,"app-chapter-editor",5),g("canConfirm",function(a){M(e);let o=l();return C(o.onCanConfirm(a))})("modified",function(a){M(e);let o=l();return C(o.onModified(a))})("editMode",function(a){M(e);let o=l();return C(o.onEditMode(a))}),r()}if(i&2){let e=l();p("chapter",e.selectedItem)("state",e.state)}}function w1(i,t){if(i&1){let e=I();c(0,"app-session-content-editor",6),g("closed",function(){M(e);let a=l();return C(a.onClosed())})("canConfirm",function(a){M(e);let o=l();return C(o.onCanConfirm(a))})("modified",function(a){M(e);let o=l();return C(o.onModified(a))})("editMode",function(a){M(e);let o=l();return C(o.onEditMode(a))}),r()}if(i&2){let e=l();p("session",e.selectedItem)("state",e.state)("picker",e.picker)}}var Qe=class i{picker=!1;selectedItem;state;canConfirm=new f;modified=new f;closed=new f;editMode=new f;onCanConfirm(t){this.canConfirm.emit(t)}onModified(t){this.modified.emit(t)}onClosed(){this.closed.emit()}onEditMode(t){this.editMode.emit(t)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=_({type:i,selectors:[["app-content-type-switch"]],inputs:{picker:"picker",selectedItem:"selectedItem",state:"state"},outputs:{canConfirm:"canConfirm",modified:"modified",closed:"closed",editMode:"editMode"},standalone:!0,features:[x],decls:4,vars:4,consts:[[3,"ngSwitch"],[3,"book",4,"ngSwitchCase"],[3,"chapter","state","canConfirm","modified","editMode",4,"ngSwitchCase"],[3,"session","state","picker","closed","canConfirm","modified","editMode",4,"ngSwitchCase"],[3,"book"],[3,"canConfirm","modified","editMode","chapter","state"],[3,"closed","canConfirm","modified","editMode","session","state","picker"]],template:function(e,n){e&1&&(X(0,0),v(1,x1,1,1,"app-book-content-editor",1)(2,b1,1,2,"app-chapter-editor",2)(3,w1,1,3,"app-session-content-editor",3),K()),e&2&&(p("ngSwitch",n.selectedItem.type),d(),p("ngSwitchCase","book"),d(),p("ngSwitchCase","chapter"),d(),p("ngSwitchCase","session"))},dependencies:[w,qi,Fi,un,yn,pn],encapsulation:2})};var I1=()=>[];function L1(i,t){if(i&1&&(c(0,"option",11),u(1),r()),i&2){let e=t.$implicit,n=t.index,a=l(2);p("value",n)("selected",a.insertPosition==n),d(),T(" Before: ",e.title," ")}}function S1(i,t){if(i&1){let e=I();X(0),c(1,"span",6),u(2),r(),c(3,"label"),u(4,"Insert position... "),r(),c(5,"div",7)(6,"select",8,1),g("change",function(){M(e);let a=R(7),o=l();return C(o.onSelectPosition(a.value))}),v(8,L1,2,3,"option",9),c(9,"option",10),u(10,"At the end"),r()()(),K()}if(i&2){let e=l();d(2),A(e.contentData.type),d(6),p("ngForOf",(e.parent==null?null:e.parent.children)||Be(3,I1)),d(),p("selected",e.insertPosition==-1)}}function P1(i,t){if(i&1){let e=I();c(0,"app-content-type-switch",12),g("canConfirm",function(a){M(e);let o=l();return C(o.onCanConfirm(a))})("modified",function(a){M(e);let o=l();return C(o.onModified(a))})("closed",function(){M(e);let a=l();return C(a.onClosed())}),r()}if(i&2){let e=l();p("selectedItem",e.contentData)("picker",e.picker)("state","new")}}function D1(i,t){if(i&1){let e=I();c(0,"div",13)(1,"label"),u(2,"Please select content type... "),r(),c(3,"button",14),g("click",function(){M(e);let a=l();return C(a.onTypeSelect("chapter"))}),u(4," Chapter "),r(),c(5,"button",14),g("click",function(){M(e);let a=l();return C(a.onTypeSelect("session"))}),u(6," Session "),r()()}}var kn=class i{constructor(t){this.fake=t}picker=!1;parent;canConfirm=new f;modified=new f;position=new f;closed=new f;canSelect=new f;ngOnInit(){this.contentData={bookId:this.parent?.bookId,id:`fake-${this.fake.nextId()}`,parentId:this.parent?.id,isNew:!0},this.canSelect.emit(!1),this.position.emit(this.insertPosition)}ngOnDestroy(){this.canSelect.emit(!1),this.position.emit(-1),console.log("ah, I die... hard.")}onCanConfirm(t){this.canConfirm.emit(t)}onModified(t){this.modified.emit(t)}onSelectPosition(t){this.insertPosition=+t,this.position.emit(this.insertPosition)}contentData;insertPosition=-1;onTypeSelect(t){setTimeout(()=>{switch(this.contentData.type=t,t){case"chapter":this.contentData.children=[];break;case"session":console.log("Oh, you should be able to select now!"),this.canSelect.emit(!0);break}})}onClosed(){this.closed.emit()}static \u0275fac=function(e){return new(e||i)(m(Ni))};static \u0275cmp=_({type:i,selectors:[["app-add-content"]],inputs:{picker:"picker",parent:"parent"},outputs:{canConfirm:"canConfirm",modified:"modified",position:"position",closed:"closed",canSelect:"canSelect"},standalone:!0,features:[x],decls:8,vars:3,consts:[["noContentType",""],["positionSelector",""],[1,"add-content"],[1,"header"],[4,"ngIf"],[3,"selectedItem","picker","state","canConfirm","modified","closed",4,"ngIf","ngIfElse"],[1,"type-badge"],[1,"form-field"],[3,"change"],[3,"value","selected",4,"ngFor","ngForOf"],["value","-1",3,"selected"],[3,"value","selected"],[3,"canConfirm","modified","closed","selectedItem","picker","state"],[1,"type-selector"],[3,"click"]],template:function(e,n){if(e&1&&(c(0,"div",2)(1,"div",3)(2,"h4"),u(3,"Add new content"),r(),v(4,S1,11,4,"ng-container",4),r(),v(5,P1,1,3,"app-content-type-switch",5)(6,D1,7,0,"ng-template",null,0,Y),r()),e&2){let a=R(7);d(4),p("ngIf",n.contentData==null?null:n.contentData.type),d(),p("ngIf",n.contentData==null?null:n.contentData.type)("ngIfElse",a)}},dependencies:[w,W,O,Ke,lo,uo,Qe],styles:[".add-content[_ngcontent-%COMP%]{margin-top:1rem}.add-content[_ngcontent-%COMP%]   .type-selector[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:1rem}.add-content[_ngcontent-%COMP%]   .type-selector[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.5rem 1rem;border:1px solid #ddd;border-radius:4px;background:#fff;cursor:pointer}.add-content[_ngcontent-%COMP%]   .type-selector[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:#f1f8ff;border-color:#0366d6;color:#0366d6}.add-content[_ngcontent-%COMP%]   .type-selector[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#f5f5f5}.add-content[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-bottom:1rem}.add-content[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .type-badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:4px;background:#f1f8ff;color:#0366d6;font-size:12px;text-transform:capitalize}.add-content[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:.5rem;border:1px solid #ccc;border-radius:4px}.add-content[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-top:1rem}"]})};function A1(i,t){i&1&&(c(0,"pre"),u(1,`    what can we do here?
well, on details we are to see what we have
if possible to edit, hit edit button
- enter edit mode, editable controls are not read only
- can confirm or cancel changes, both leave edit mode
if have children, can add new content there, just hit add content button
- enter addingContent mode, that is to provide this special component
  - there is initial step to pick content type for the new kid\`
  - after that, switch with proper type editor
  - can confirm or cancel changes...
`),r())}function O1(i,t){if(i&1){let e=I();c(0,"button",11),g("click",function(){M(e);let a=l(3);return C(a.onPreview())}),u(1,"Preview"),r()}}function T1(i,t){if(i&1){let e=I();c(0,"button",11),g("click",function(){M(e);let a=l(3);return C(a.onAddContent())}),u(1,"Add Content..."),r()}}function V1(i,t){if(i&1){let e=I();X(0),c(1,"button",11),g("click",function(){M(e);let a=l(3);return C(a.onEdit())}),u(2,"Edit"),r(),c(3,"button",11),g("click",function(){M(e);let a=l(3);return C(a.onRemove())}),u(4,"Remove"),r(),K()}}function E1(i,t){if(i&1&&(X(0),v(1,O1,2,0,"button",10)(2,T1,2,0,"button",10)(3,V1,5,0,"ng-container",6),K()),i&2){let e=l(2);d(),p("ngIf",!!(e.selectedItem!=null&&e.selectedItem.sessionId)),d(),p("ngIf",!!(e.selectedItem!=null&&e.selectedItem.children)),d(),p("ngIf",(e.selectedItem==null?null:e.selectedItem.type)!="book")}}function q1(i,t){if(i&1){let e=I();c(0,"button",11),g("click",function(){M(e);let a=l(3);return C(a.onSelect())}),u(1,"Select..."),r()}}function F1(i,t){if(i&1){let e=I();v(0,q1,2,0,"button",10),c(1,"button",12),g("click",function(){M(e);let a=l(2);return C(a.onConfirm())}),u(2,"Confirm"),r(),c(3,"button",11),g("click",function(){M(e);let a=l(2);return C(a.onCancel())}),u(4,"Cancel"),r()}if(i&2){let e=l(2);p("ngIf",!!(e.selectedItem!=null&&e.selectedItem.sessionId)||e.canSelect),d(),p("disabled",!e.canConfirm)}}function z1(i,t){if(i&1){let e=I();c(0,"app-add-content",13),g("canConfirm",function(a){M(e);let o=l(2);return C(o.onCanConfirm(a))})("modified",function(a){M(e);let o=l(2);return C(o.onModified(a))})("position",function(a){M(e);let o=l(2);return C(o.onPosition(a))})("closed",function(){M(e);let a=l(2);return C(a.onClosedFromAddContent())})("canSelect",function(a){M(e);let o=l(2);return C(o.onCanSelect(a))}),r()}if(i&2){let e=l(2);p("parent",e.selectedItem)("picker",e.picker)}}function B1(i,t){if(i&1){let e=I();c(0,"div",2)(1,"div",3)(2,"h3"),u(3),r(),c(4,"span",4),u(5),r()(),c(6,"app-content-type-switch",5),g("canConfirm",function(a){M(e);let o=l();return C(o.onCanConfirm(a))})("modified",function(a){M(e);let o=l();return C(o.onModified(a))})("closed",function(){M(e);let a=l();return C(a.onClosedFromTypeSwitch())})("editMode",function(a){M(e);let o=l();return C(o.onEditMode(a))}),r(),v(7,A1,2,0,"pre",6),c(8,"div",7),v(9,E1,4,3,"ng-container",8)(10,F1,5,2,"ng-template",null,0,Y),r(),v(12,z1,1,2,"app-add-content",9),r()}if(i&2){let e=R(11),n=l();d(3),A(n.selectedItem.title||n.selectedItem.id),d(2),A(n.selectedItem.type),d(),p("selectedItem",n.selectedItem)("state",n.state)("picker",n.picker),d(),p("ngIf",!1),d(2),p("ngIf",n.state=="details")("ngIfElse",e),d(3),p("ngIf",n.state=="add-content")}}var mn=class i{_selectedItem;set selectedItem(t){this._selectedItem=t,this.state="details"}get selectedItem(){return this._selectedItem}addContent=new f;removeContent=new f;contentChanged=new f;editMode=new f;state="details";addingContent=!1;picker=!1;canConfirm=!1;modified;position=-1;canSelect=!1;onPosition(t){console.log("on position",t),this.position=t}onCanConfirm(t){this.canConfirm=t}onModified(t){this.modified=t}onPreview(){setTimeout(()=>{this.picker=!0})}onAddContent(){setTimeout(()=>{this.state="add-content",this.onEditMode(!0)})}onEdit(){setTimeout(()=>{this.state="edit"})}onRemove(){setTimeout(()=>{this.removeContent.emit(this.selectedItem)})}onConfirm(){setTimeout(()=>{switch(this.state){case"edit":Object.assign(this.selectedItem,this.modified,{isModified:!0});break;case"add-content":this.position<0?(Object.assign(this.modified,{order:(this.selectedItem.children?.length||0)+1,isModified:!0}),this.selectedItem.children?.push(this.modified)):(this.selectedItem.children?.splice(this.position,0,this.modified),this.selectedItem.children?.forEach((t,e)=>{e>=this.position&&Object.assign(t,{order:e+1,isModified:!0})})),this.selectedItem.expanded=!0;break;default:break}this.state="details",this.onEditMode(!1),this.contentChanged.emit()})}onCancel(){setTimeout(()=>{this.state="details",this.onEditMode(!1)})}onClosedFromTypeSwitch(){setTimeout(()=>{this.picker=!1})}onClosedFromAddContent(){setTimeout(()=>{this.picker=!1})}onSelect(){setTimeout(()=>{this.picker=!0})}onCanSelect(t){setTimeout(()=>{this.canSelect=t})}onEditMode(t){this.editMode.emit(t)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=_({type:i,selectors:[["app-book-content-details"]],inputs:{selectedItem:"selectedItem"},outputs:{addContent:"addContent",removeContent:"removeContent",contentChanged:"contentChanged",editMode:"editMode"},standalone:!0,features:[x],decls:1,vars:1,consts:[["notDetailsActions",""],["class","details-pane",4,"ngIf"],[1,"details-pane"],[1,"header"],[1,"type-badge"],[3,"canConfirm","modified","closed","editMode","selectedItem","state","picker"],[4,"ngIf"],[1,"actions"],[4,"ngIf","ngIfElse"],[3,"parent","picker","canConfirm","modified","position","closed","canSelect",4,"ngIf"],[3,"click",4,"ngIf"],[3,"click"],[3,"click","disabled"],[3,"canConfirm","modified","position","closed","canSelect","parent","picker"]],template:function(e,n){e&1&&v(0,B1,13,9,"div",1),e&2&&p("ngIf",n.selectedItem)},dependencies:[w,O,kn,Qe],styles:[".details-pane[_ngcontent-%COMP%]{padding:1rem;border-left:1px solid #eee}.details-pane[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-bottom:1rem}.details-pane[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .type-badge[_ngcontent-%COMP%]{padding:4px 8px;border-radius:4px;background:#f1f8ff;color:#0366d6;font-size:12px;text-transform:capitalize}.details-pane[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{margin-top:1rem;display:flex;gap:.5rem;margin-bottom:1rem}.details-pane[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.5rem 1rem;border:1px solid #ddd;border-radius:4px;background:#fff;cursor:pointer}.details-pane[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background:#f1f8ff;border-color:#0366d6;color:#0366d6}.details-pane[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#f5f5f5}.details-pane[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{background:#eee;cursor:not-allowed}"]})};var gn=class i{_selectedItemId;set selectedItem(t){t&&(this._selectedItemId=t.id,this.onItemSelected(this.getSelectedItem(this.treeItems)))}disabled=!1;get selectedItemId(){return this._selectedItemId||""}treeItems=[];set content(t){this.treeItems=t,this.onItemSelected(t[0])}itemSelected=new f;contentChanged=new f;getSelectedItem(t){return t.find(e=>e.id==this._selectedItemId)||t.map(e=>this.getSelectedItem(e.children||[])).find(e=>!!e)}typeToIcon={book:"\u{1F56E}",chapter:"\u{1F4D1}",session:"\u{1F4DD}"};onItemSelected(t){t&&t.id&&(this._selectedItemId=t.id,this.itemSelected.emit(t))}onItemDropped(t){let e=this.findNode(this.treeItems[0],t.targetId),n=this.findNode(this.treeItems[0],t.sourceId),a=this.findNode(this.treeItems[0],n.parentId),o=a?.children?.findIndex(s=>s.id==n.id)??-1;if(o!==-1&&a?.children?.splice(o,1),t.position==="inside"){e.children=e.children||[],n.parentId=e.id;let s=e.children.length;if(n.order=s+1,n.isModified=!0,e.children?.push(n),e.expanded=!0,a&&a!==e)for(let h=o;h<a.children.length;h++)a.children[h].order=h+1,a.children[h].isModified=!0}else{let s=this.findNode(this.treeItems[0],e.parentId),h=s?.children?.findIndex(k=>k.id==e.id)??-1;if(a!==s){if(o!==-1&&a?.children)for(let y=o;y<a.children.length;y++)a.children[y].order=y+1,a.children[y].isModified=!0;n.parentId=s?.id;let k=t.position==="before"?h:h+1;if(s?.children?.splice(k,0,n),s?.children)for(let y=k;y<s.children.length;y++)s.children[y].order=y+1,s.children[y].isModified=!0;n.isModified=!0}else if(s?.children&&o!==-1&&h!==-1){let k=o<h&&t.position==="before"?h-1:h,y=t.position==="before"?k:k+1;s.children.splice(y,0,n);let b=Math.min(o,y),P=Math.max(o,y);for(let F=b;F<=P;F++)s.children[F].order=F+1,s.children[F].isModified=!0;n.isModified=!0}}console.log(JSON.stringify(this.treeItems,null,2)),this.contentChanged.emit()}findNode(t,e){return!e||t.id==e?t:t.children?.map(n=>this.findNode(n,e)).find(n=>n)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=_({type:i,selectors:[["app-book-content-tree"]],inputs:{selectedItem:"selectedItem",disabled:"disabled",content:"content"},outputs:{itemSelected:"itemSelected",contentChanged:"contentChanged"},standalone:!0,features:[x],decls:1,vars:4,consts:[["idField","id","labelField","title","typeField","type",3,"itemSelected","itemDropped","items","selectedId","typeToIcon","disabled"]],template:function(e,n){e&1&&(c(0,"app-tree-view",0),g("itemSelected",function(o){return n.onItemSelected(o)})("itemDropped",function(o){return n.onItemDropped(o)}),r()),e&2&&p("items",n.treeItems)("selectedId",n.selectedItemId)("typeToIcon",n.typeToIcon)("disabled",n.disabled)},dependencies:[w,Ut],styles:["[_nghost-%COMP%]{display:block}"]})};var fn=class i{constructor(t){this.bookService=t}changed=new f;_hasChanges=!1;set hasChanges(t){this._hasChanges=t,this.emitChanged()}get hasChanges(){return this._hasChanges}destroy$=new q;removedItems=[];editMode=!1;ngOnInit(){this.bookService.bookContent$.pipe(fe(this.destroy$)).subscribe(t=>{this.content=t,this.removedItems=[],this.editMode=!1,this.hasChanges=!1})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onSave(){this.bookService.updateBookContent(this.content,this.removedItems).subscribe({next:t=>{console.log("update result: ",t)}})}onReset(){let t=this.content[0],e=t.bookId,n=t.title;this.bookService.loadBookContent({id:e,title:n})}onContentChanged(){this.hasChanges=!0}content;selectedItem;onItemSelected(t){this.selectedItem=t}onRemoveContent(t){let e=this.findPoorChild(this.content[0],t.id);console.log(e),e?.parent?.children?.splice(e.poorChild.order-1,1),e?.parent?.children?.forEach((n,a)=>{a>=e.poorChild.order&&Object.assign(n,{order:a+1,isModified:!0})}),this.markAsRemoved(e.poorChild),this.onItemSelected(e?.parent),this.onContentChanged()}markAsRemoved(t){Object.assign(t,{isRemoved:!0}),this.removedItems.push(t),t.children&&t.children.forEach(e=>this.markAsRemoved(e))}findPoorChild(t,e){if(t.id==e)return{poorChild:t};if(!t.children)return;let n=t.children.map(a=>this.findPoorChild(a,e)).find(a=>a!==void 0);if(n)return n.parent?n:B(V({},n),{parent:t})}onEditMode(t){this.editMode=t,this.emitChanged()}emitChanged(){this.changed.emit(this._hasChanges||this.editMode)}static \u0275fac=function(e){return new(e||i)(m(xe))};static \u0275cmp=_({type:i,selectors:[["app-book-content"]],outputs:{changed:"changed"},standalone:!0,features:[x],decls:10,vars:6,consts:[[1,"content-tab"],[1,"content-layout"],[1,"left-column"],[1,"actions"],[3,"click","disabled"],[3,"itemSelected","contentChanged","content","selectedItem","disabled"],[3,"removeContent","contentChanged","editMode","selectedItem"]],template:function(e,n){e&1&&(c(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"button",4),g("click",function(){return n.onSave()}),u(5,"Save Changes"),r(),c(6,"button",4),g("click",function(){return n.onReset()}),u(7,"Reset"),r()(),c(8,"app-book-content-tree",5),g("itemSelected",function(o){return n.onItemSelected(o)})("contentChanged",function(){return n.onContentChanged()}),r()(),c(9,"app-book-content-details",6),g("removeContent",function(o){return n.onRemoveContent(o)})("contentChanged",function(){return n.onContentChanged()})("editMode",function(o){return n.onEditMode(o)}),r()()()),e&2&&(d(4),p("disabled",!n.hasChanges||n.editMode),d(2),p("disabled",!n.hasChanges||n.editMode),d(2),p("content",n.content)("selectedItem",n.selectedItem)("disabled",n.editMode),d(),p("selectedItem",n.selectedItem))},dependencies:[w,gn,mn],styles:[".content-tab[_ngcontent-%COMP%]{padding:0}.content-layout[_ngcontent-%COMP%]{display:flex;gap:1rem}.left-column[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{padding:1rem;display:flex;gap:.5rem}button[_ngcontent-%COMP%]{padding:.5rem 1rem;border:1px solid #ddd;border-radius:4px;background:#fff;cursor:pointer}button[_ngcontent-%COMP%]:hover{background:#f5f5f5}button[_ngcontent-%COMP%]:disabled{background:#eee;cursor:not-allowed}"]})};var vn=class i{book;static \u0275fac=function(e){return new(e||i)};static \u0275cmp=_({type:i,selectors:[["app-book-access-details"]],inputs:{book:"book"},standalone:!0,features:[x],decls:18,vars:0,consts:[[1,"access-details"],[1,"form-group"],["type","date"],[1,"checkbox-group"],["type","checkbox"]],template:function(e,n){e&1&&(c(0,"div",0)(1,"div",1)(2,"label"),u(3,"Publish Date"),r(),D(4,"input",2),r(),c(5,"div",1)(6,"label"),u(7,"Access Roles"),r(),c(8,"div",3)(9,"label"),D(10,"input",4),u(11," Public Access "),r(),c(12,"label"),D(13,"input",4),u(14," Registered Users "),r(),c(15,"label"),D(16,"input",4),u(17," Premium Users "),r()()()())},dependencies:[w],styles:[".access-details[_ngcontent-%COMP%]{padding:1rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:.5rem;font-weight:500}.checkbox-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.checkbox-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-weight:400}"]})};function H1(i,t){if(i&1){let e=I();c(0,"button",6),g("click",function(){M(e);let a=l();return C(a.onNewBook())}),u(1,"New Book"),r()}if(i&2){let e=l();p("disabled",e.disableSelection)}}function R1(i,t){if(i&1){let e=I();c(0,"div",7),g("click",function(){let a=M(e).$implicit,o=l();return C(o.onSelectBook(a))}),u(1),r()}if(i&2){let e=t.$implicit,n=l();L("selected",e.id===n.selectedBookId)("disabled",n.disableSelection),d(),T(" ",e.title," ")}}var mo=class i{constructor(t){this.bookService=t}disableSelection=!1;hideNewButton=!1;isExpanded=!0;books=[];selectedBookId;ngOnInit(){this.bookService.books$.subscribe(t=>{this.books=t}),this.bookService.activeBook$.subscribe(t=>{this.selectedBookId=t?.id})}onNewBook(){this.bookService.setActiveBook({title:"",description:"",status:"draft"})}onSelectBook(t){this.disableSelection||this.bookService.setActiveBook(t)}static \u0275fac=function(e){return new(e||i)(m(xe))};static \u0275cmp=_({type:i,selectors:[["app-book-list"]],inputs:{disableSelection:"disableSelection",hideNewButton:"hideNewButton"},standalone:!0,features:[x],decls:8,vars:3,consts:[[3,"expandedChange","isExpanded"],[1,"book-list-header"],[3,"disabled","click",4,"ngIf"],[1,"book-list"],[1,"books"],["class","book-item",3,"selected","disabled","click",4,"ngFor","ngForOf"],[3,"click","disabled"],[1,"book-item",3,"click"]],template:function(e,n){e&1&&(c(0,"app-sidebar",0),g("expandedChange",function(o){return n.isExpanded=o}),c(1,"div",1)(2,"h3"),u(3,"Books"),r(),v(4,H1,2,1,"button",2),r(),c(5,"div",3)(6,"div",4),v(7,R1,2,5,"div",5),r()()()),e&2&&(p("isExpanded",n.isExpanded),d(4),p("ngIf",!n.hideNewButton),d(3),p("ngForOf",n.books))},dependencies:[w,W,O,Vt],styles:[".book-list-header[_ngcontent-%COMP%]{padding:1rem;display:flex;justify-content:space-between;align-items:center}.book-filters[_ngcontent-%COMP%]{padding:.5rem}.book-filters[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:.5rem}.books[_ngcontent-%COMP%]   .book-item[_ngcontent-%COMP%]{padding:.75rem 1rem;border-bottom:1px solid #eee;cursor:pointer}.books[_ngcontent-%COMP%]   .book-item[_ngcontent-%COMP%]:hover:not(.disabled){background:#ddd}.books[_ngcontent-%COMP%]   .book-item.disabled[_ngcontent-%COMP%]:not(.selected){cursor:not-allowed;color:#666}.books[_ngcontent-%COMP%]   .book-item.selected[_ngcontent-%COMP%]{background-color:#ccc;font-weight:700;cursor:default}"]})};var j1=["*"];var go=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]];var fo=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]];var vo=[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]];var kt={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},li=new Z("LucideIcons",{factory:()=>new mt({})}),mt=class{constructor(t){this.icons=t}getIcon(t){return this.hasIcon(t)?this.icons[t]:null}hasIcon(t){return typeof this.icons=="object"&&t in this.icons}},N1=(()=>{class i{constructor(){this.color=kt.stroke,this.size=kt.width,this.strokeWidth=kt["stroke-width"],this.absoluteStrokeWidth=!1}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275prov=$({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function U1(i,t=3){return parseFloat(i.toFixed(t)).toString(10)}var Mo=(()=>{class i{constructor(e,n,a,o,s){this.elem=e,this.renderer=n,this.changeDetector=a,this.iconProviders=o,this.iconConfig=s,this.absoluteStrokeWidth=!1,this.defaultSize=kt.height}get size(){return this._size??this.iconConfig.size}set size(e){e?this._size=this.parseNumber(e):delete this._size}get strokeWidth(){return this._strokeWidth??this.iconConfig.strokeWidth}set strokeWidth(e){e?this._strokeWidth=this.parseNumber(e):delete this._strokeWidth}ngOnChanges(e){if(e.name||e.img||e.color||e.size||e.absoluteStrokeWidth||e.strokeWidth||e.class){this.color=this.color??this.iconConfig.color,this.size=this.parseNumber(this.size??this.iconConfig.size),this.strokeWidth=this.parseNumber(this.strokeWidth??this.iconConfig.strokeWidth),this.absoluteStrokeWidth=this.absoluteStrokeWidth??this.iconConfig.absoluteStrokeWidth;let n=this.img??this.name;if(typeof n=="string"){let a=this.getIcon(this.toPascalCase(n));if(a)this.replaceElement(a);else throw new Error(`The "${n}" icon has not been provided by any available icon providers.`)}else if(Array.isArray(n))this.replaceElement(n);else throw new Error("No icon name or image has been provided.")}this.changeDetector.markForCheck()}replaceElement(e){let n=B(V({},kt),{width:this.size,height:this.size,stroke:this.color??this.iconConfig.color,"stroke-width":this.absoluteStrokeWidth?U1(this.strokeWidth/(this.size/this.defaultSize)):this.strokeWidth.toString(10)}),a=this.createElement(["svg",n,e]);a.classList.add("lucide"),typeof this.name=="string"&&a.classList.add(`lucide-${this.name.replace("_","-")}`),this.class&&a.classList.add(...this.class.split(/ /).map(s=>s.trim()).filter(s=>s.length>0));let o=this.elem.nativeElement.childNodes;for(let s of o)this.renderer.removeChild(this.elem.nativeElement,s);this.renderer.appendChild(this.elem.nativeElement,a)}toPascalCase(e){return e.replace(/(\w)([a-z0-9]*)(_|-|\s*)/g,(n,a,o)=>a.toUpperCase()+o.toLowerCase())}parseNumber(e){if(typeof e=="string"){let n=parseInt(e,10);if(isNaN(n))throw new Error(`${e} is not numeric.`);return n}return e}getIcon(e){for(let n of Array.isArray(this.iconProviders)?this.iconProviders:[this.iconProviders])if(n.hasIcon(e))return n.getIcon(e);return null}createElement([e,n,a=[]]){let o=this.renderer.createElement(e,"http://www.w3.org/2000/svg");return Object.keys(n).forEach(s=>{let h=typeof n[s]=="string"?n[s]:n[s].toString(10);this.renderer.setAttribute(o,s,h)}),a.length&&a.forEach(s=>{let h=this.createElement(s);this.renderer.appendChild(o,h)}),o}}return i.\u0275fac=function(e){return new(e||i)(m(N),m(Te),m(pe),m(li),m(N1))},i.\u0275cmp=_({type:i,selectors:[["lucide-angular"],["lucide-icon"],["i-lucide"],["span-lucide"]],inputs:{class:"class",name:"name",img:"img",color:"color",absoluteStrokeWidth:"absoluteStrokeWidth",size:"size",strokeWidth:"strokeWidth"},features:[j],ngContentSelectors:j1,decls:1,vars:0,template:function(e,n){e&1&&(de(),he(0))},encapsulation:2}),i})(),pi=class{constructor(t){this.icons=t}},G1=i=>new mt(i??{}),Co=(()=>{class i{static pick(e){return{ngModule:i,providers:[{provide:li,multi:!0,useValue:new mt(e)},{provide:li,multi:!0,useFactory:G1,deps:[[new bi,pi]]}]}}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=ne({type:i}),i.\u0275inj=te({imports:[[]]}),i})();var Z1=i=>({items:i,level:1}),$1=(i,t)=>({items:i,level:t});function X1(i,t){if(i&1&&(c(0,"div",11),u(1),r()),i&2){let e=l(2);d(),T(" ",e.rootItem.description," ")}}function K1(i,t){i&1&&ce(0)}function Q1(i,t){if(i&1&&(X(0),v(1,K1,1,0,"ng-container",12),K()),i&2){let e=l(2),n=R(3);d(),p("ngTemplateOutlet",n)("ngTemplateOutletContext",ke(2,Z1,e.rootItem.children))}}function J1(i,t){if(i&1){let e=I();c(0,"div",3)(1,"div",4)(2,"div",5)(3,"span",6),g("click",function(a){M(e);let o=l();return C(o.toggleExpand(o.rootItem,0,a))}),u(4,` \u25BA
`),r(),c(5,"div",7),g("click",function(){M(e);let a=l();return C(a.onItemClick(a.rootItem))}),D(6,"lucide-icon",8),u(7),r()(),v(8,X1,2,1,"div",9),r(),v(9,Q1,2,4,"ng-container",10),r()}if(i&2){let e=l();d(3),L("expanded",e.isExpanded(e.rootItem,0)),d(2),L("active",e.isActive(e.rootItem)),d(),p("img",e.BOOK_ICON),d(),T(" ",e.rootItem.title," "),d(),p("ngIf",e.hasDescription(e.rootItem)&&e.isExpanded(e.rootItem,0)),d(),p("ngIf",e.isExpanded(e.rootItem,0)&&e.rootItem.children)}}function Y1(i,t){if(i&1&&(c(0,"div",11),u(1),r()),i&2){let e=l().$implicit;d(),T(" ",e.description," ")}}function er(i,t){i&1&&(c(0,"div",23)(1,"span",24),u(2,"Loading topics..."),r()())}function tr(i,t){if(i&1&&(c(0,"div",34),u(1),r()),i&2){let e=l().$implicit;d(),T(" ",e.topic.description," ")}}function nr(i,t){if(i&1){let e=I();c(0,"div",27)(1,"div",28)(2,"span",6),g("click",function(a){let o=M(e).$implicit,s=l(3).$implicit,h=l(2);return C(h.toggleNavigationPoint(s,o.point,o.topic.name,a))}),u(3,` \u25BA
`),r(),c(4,"div",29),g("click",function(){let a=M(e).$implicit,o=l(3).$implicit,s=l(2);return C(s.onTopicClick(o,a.topic,a.point))}),c(5,"span",30),u(6),r(),c(7,"span",31),u(8),r(),c(9,"span",32),u(10),r()()(),v(11,tr,2,1,"div",33),r()}if(i&2){let e=t.$implicit,n=l(3).$implicit,a=l(2);L("active",a.isNavigationPointActive(n,e.point)),p("ngClass",a.getTopicColorClass(e.topic.name)),d(2),L("expanded",a.isNavigationPointExpanded(n,e.point,e.topic.name)),d(4),T("#",e.point,""),d(2),A(e.topic.name),d(2),A(e.part),d(),p("ngIf",a.isNavigationPointExpanded(n,e.point,e.topic.name))}}function ir(i,t){if(i&1&&(c(0,"div",25),v(1,nr,12,9,"div",26),r()),i&2){let e=l(2).$implicit,n=l(2);d(),p("ngForOf",n.getNavigationPoints(e))}}function ar(i,t){i&1&&(c(0,"div",35),u(1," No navigation points available for this session. "),r())}function or(i,t){if(i&1&&(c(0,"div",19),v(1,er,3,0,"div",20)(2,ir,2,1,"div",21)(3,ar,2,0,"div",22),r()),i&2){let e=l().$implicit,n=l(2);d(),p("ngIf",n.isTopicsLoading(e)),d(),p("ngIf",n.hasTopics(e)),d(),p("ngIf",!n.isTopicsLoading(e)&&!n.hasTopics(e))}}function sr(i,t){i&1&&ce(0)}function rr(i,t){if(i&1&&(X(0),v(1,sr,1,0,"ng-container",12),K()),i&2){let e=l().$implicit,n=l().level;l();let a=R(3);d(),p("ngTemplateOutlet",a)("ngTemplateOutletContext",bt(2,$1,e.children,n+1))}}function cr(i,t){if(i&1){let e=I();c(0,"div",15)(1,"div",16),g("click",function(){let a=M(e).$implicit,o=l(2);return C(o.onItemClick(a))}),c(2,"span",6),g("click",function(a){let o=M(e).$implicit,s=l().level,h=l();return C(h.toggleExpand(o,s,a))}),u(3,` \u25BA
`),r(),c(4,"div",17),g("click",function(){let a=M(e).$implicit,o=l(2);return C(o.onItemClick(a))}),D(5,"lucide-icon",8),u(6),r()(),v(7,Y1,2,1,"div",9)(8,or,4,3,"div",18)(9,rr,2,5,"ng-container",10),r()}if(i&2){let e=t.$implicit,n=l().level,a=l();z("data-level",n),d(),L("active",a.isActive(e))("active-ancestor",a.isAncestorOfActive(e)),d(),L("expanded",a.isExpanded(e,n)),d(2),L("active",a.isActive(e)),d(),p("img",e.type==="chapter"?a.CHAPTER_ICON:a.SESSION_ICON),d(),T(" ",e.title," "),d(),p("ngIf",a.hasDescription(e)&&a.isExpanded(e,n)),d(),p("ngIf",e.type==="session"&&a.isExpanded(e,n)),d(),p("ngIf",a.isExpanded(e,n)&&e.children&&e.children.length>0)}}function dr(i,t){if(i&1&&(c(0,"div",13),v(1,cr,10,14,"div",14),r()),i&2){let e=t.items,n=t.level;Di("padding-left: calc("+n+" * var(--level-padding))"),d(),p("ngForOf",e)}}var Mn=class i{BOOK_ICON=go;CHAPTER_ICON=fo;SESSION_ICON=vo;bookContent=[];activeContentSlug;activePosition;_sessionTopics={};set sessionTopics(t){if(this._sessionTopics=t,this.pendingNavigationPointMark){let{contentSlug:e,interactionNum:n}=this.pendingNavigationPointMark;setTimeout(()=>{this.findAndMarkActiveNavigationPoint(e,n)})}}get sessionTopics(){return this._sessionTopics}loadingTopics=new Set;navigate=new f;topicRequest=new f;rootItem=null;expandedItemsByLevel=new Map;activeNavigationPoint=null;pendingNavigationPointMark=null;ngOnChanges(t){if(this.bookContent.length>0&&(this.rootItem=this.bookContent[0],this.expandedItemsByLevel.set(0,"book"),(t.activeContentSlug||t.activePosition)&&this.activeContentSlug&&(this.expandToActiveItem(),this.activePosition))){let e=parseInt(this.activePosition);isNaN(e)||this.findAndMarkActiveNavigationPoint(this.activeContentSlug,e)}}findAndMarkActiveNavigationPoint(t,e){let n=y=>{if(this.getContentSlug(y)===t)return y;if(y.children)for(let b of y.children){let P=n(b);if(P)return P}return null},a=n(this.rootItem);if(!a||a.type!=="session")return;let o=a.id;if(!this.sessionTopics[o]){this.pendingNavigationPointMark={contentSlug:t,interactionNum:e},this.topicRequest.emit(o);return}let s=this.getNavigationPoints(a);if(!s.length)return;let h=s[0];for(let y of s)y.point<=e&&y.point>h.point&&(h=y);this.activeNavigationPoint={itemId:o,point:h.point};let k=this.getNavigationPointId(a,h.point,h.topic.name);this.expandedNavigationPoint=k,this.pendingNavigationPointMark=null}getContentSlug(t){return t.id==="book"?"book":t.urlSlug||t.id}onItemClick(t){this.navigate.emit({contentId:t.id,contentSlug:this.getContentSlug(t)})}toggleExpand(t,e,n){n.stopPropagation();let a=t.id;this.isExpanded(t,e)?this.expandedItemsByLevel.delete(e):(this.expandedItemsByLevel.set(e,a),t.type==="session"&&!this.sessionTopics[a]&&this.topicRequest.emit(a))}isExpanded(t,e){let n=t.id;return this.expandedItemsByLevel.get(e)===n}isActive(t){return this.getContentSlug(t)===this.activeContentSlug?t.type==="session"?!this.activePosition:!0:!1}hasDescription(t){return!!t.description&&t.description.trim().length>0}hasTopics(t){let e=t.id;return!!this.sessionTopics[e]&&this.sessionTopics[e].length>0}getTopics(t){let e=t.id;return console.log(this.sessionTopics),this.sessionTopics[e]||[]}isTopicsLoading(t){let e=t.id;return this.loadingTopics.has(e)}onTopicClick(t,e,n){this.navigate.emit({contentId:t.id,contentSlug:this.getContentSlug(t),position:n?n.toString():void 0})}expandToActiveItem(){if(!this.activeContentSlug||this.activeContentSlug==="book")return;let t=this.findPathToItem(this.rootItem,this.activeContentSlug);t.length>0&&t.forEach((e,n)=>{let a=e.id;this.expandedItemsByLevel.set(n,a),e.type==="session"&&!this.sessionTopics[a]&&this.topicRequest.emit(a)})}findPathToItem(t,e,n=[]){let a=this.getContentSlug(t),o=[...n,t];if(a===e)return o;if(t.children)for(let s of t.children){let h=this.findPathToItem(s,e,o);if(h.length>0)return h}return[]}getNavigationPoints(t){let e=t.id,n=this.sessionTopics[e]||[],a=[];return n.forEach(o=>{!o.navigationPoints||!o.navigationPoints.length||o.navigationPoints.forEach((s,h)=>{a.push({point:s,topic:o,part:h+1})})}),a.sort((o,s)=>o.point-s.point),a.length>0&&a[0].point>1&&(a[0].point=1),a}expandedTopicName=null;toggleTopicDescription(t,e){e.stopPropagation(),this.expandedTopicName===t?this.expandedTopicName=null:this.expandedTopicName=t}isTopicExpanded(t){return this.expandedTopicName===t}expandedNavigationPoints=new Set;getNavigationPointId(t,e,n){return`${t.id}-${e}-${n}`}expandedNavigationPoint=null;toggleNavigationPoint(t,e,n,a){a.stopPropagation();let o=this.getNavigationPointId(t,e,n);this.expandedNavigationPoint===o?this.expandedNavigationPoint=null:this.expandedNavigationPoint=o}isNavigationPointExpanded(t,e,n){let a=this.getNavigationPointId(t,e,n);return this.expandedNavigationPoint===a}topicColorMap=new Map;getTopicColorIndex(t){return this.topicColorMap.has(t)||this.topicColorMap.set(t,this.topicColorMap.size%7),this.topicColorMap.get(t)}getTopicColorClass(t){return`topic-color-${this.getTopicColorIndex(t)}`}isNavigationPointActive(t,e){return this.activeNavigationPoint!==null&&this.activeNavigationPoint.itemId===t.id&&this.activeNavigationPoint.point===e}isAncestorOfActive(t){if(!this.activeContentSlug)return!1;if(t.type==="session"&&this.activeNavigationPoint&&t.id===this.activeNavigationPoint.itemId)return!0;let e=n=>this.getContentSlug(n)===this.activeContentSlug?!1:n.children&&n.children.length>0?n.children.some(a=>this.getContentSlug(a)===this.activeContentSlug||a.type==="session"&&this.activeNavigationPoint&&a.id===this.activeNavigationPoint.itemId?!0:e(a)):!1;return e(t)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=_({type:i,selectors:[["app-library-book-toc"]],inputs:{bookContent:"bookContent",activeContentSlug:"activeContentSlug",activePosition:"activePosition",sessionTopics:"sessionTopics",loadingTopics:"loadingTopics"},outputs:{navigate:"navigate",topicRequest:"topicRequest"},standalone:!0,features:[j,x],decls:4,vars:1,consts:[["itemsTemplate",""],[1,"library-book-toc"],["class","toc-content",4,"ngIf"],[1,"toc-content"],[1,"toc-item","book-item"],[1,"item-header"],[1,"expand-icon",3,"click"],[1,"book-title",3,"click"],[1,"item-icon",3,"img"],["class","item-description",4,"ngIf"],[4,"ngIf"],[1,"item-description"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"toc-level"],["class","toc-item",4,"ngFor","ngForOf"],[1,"toc-item"],[1,"item-header",3,"click"],[1,"item-title",3,"click"],["class","session-navigation-points",4,"ngIf"],[1,"session-navigation-points"],["class","topics-loading",4,"ngIf"],["class","navigation-points-list",4,"ngIf"],["class","no-topics",4,"ngIf"],[1,"topics-loading"],[1,"loading-indicator"],[1,"navigation-points-list"],["class","navigation-point-item",3,"ngClass","active",4,"ngFor","ngForOf"],[1,"navigation-point-item",3,"ngClass"],[1,"navigation-point-header"],[1,"navigation-point-content",3,"click"],[1,"point-number"],[1,"topic-name"],[1,"part-indicator"],["class","topic-description",4,"ngIf"],[1,"topic-description"],[1,"no-topics"]],template:function(e,n){e&1&&(c(0,"div",1),v(1,J1,10,8,"div",2),r(),v(2,dr,2,3,"ng-template",null,0,Y)),e&2&&(d(),p("ngIf",n.rootItem))},dependencies:[w,Ei,W,O,_e,Co,Mo],styles:['.library-book-toc[_ngcontent-%COMP%]{height:100%;overflow-y:auto;padding:0 2rem;--level-padding: 16px}@media (max-width: 767px){.library-book-toc[_ngcontent-%COMP%]{padding:0 .5rem}}@media (max-width: 767px){.library-book-toc[_ngcontent-%COMP%]{--level-padding: 4px}}.library-book-toc[_ngcontent-%COMP%]   .book-title[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:100;margin-bottom:1rem;padding:.5rem 0}.library-book-toc[_ngcontent-%COMP%]   .book-title.active[_ngcontent-%COMP%]{font-weight:500;color:var(--color-primary);cursor:text}.library-book-toc[_ngcontent-%COMP%]   .book-title[_ngcontent-%COMP%]:hover{color:var(--color-primary)}@media (max-width: 767px){.library-book-toc[_ngcontent-%COMP%]   .book-title[_ngcontent-%COMP%]{color:var(--color-primary)}}.library-book-toc[_ngcontent-%COMP%]   .expand-icon[_ngcontent-%COMP%]{margin-right:.5rem;font-size:.8rem;cursor:pointer;width:1rem;text-align:center;display:inline-block;transition:transform .3s ease}.library-book-toc[_ngcontent-%COMP%]   .expand-icon.expanded[_ngcontent-%COMP%]{transform:rotate(90deg)}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]{margin:0 auto;max-width:1200px}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .toc-item[_ngcontent-%COMP%]{margin-bottom:.5rem}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .toc-item[_ngcontent-%COMP%]   .item-header[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .toc-item[_ngcontent-%COMP%]   .item-header[_ngcontent-%COMP%]   .item-title[_ngcontent-%COMP%]{flex:1;padding:.25rem 0;font-weight:100}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .toc-item[_ngcontent-%COMP%]   .item-header[_ngcontent-%COMP%]   .item-title.active[_ngcontent-%COMP%]{font-weight:500;color:var(--color-primary);cursor:text}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .toc-item[_ngcontent-%COMP%]   .item-header[_ngcontent-%COMP%]   .item-title[_ngcontent-%COMP%]:hover{color:var(--color-primary)}@media (max-width: 767px){.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .toc-item[_ngcontent-%COMP%]   .item-header[_ngcontent-%COMP%]   .item-title[_ngcontent-%COMP%]{color:var(--color-primary)}}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .toc-item[_ngcontent-%COMP%]   .item-header.active-ancestor[_ngcontent-%COMP%]{position:relative}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .toc-item[_ngcontent-%COMP%]   .item-header.active-ancestor[_ngcontent-%COMP%]:before{content:"";position:absolute;left:-.5rem;top:0;bottom:0;width:3px;background-color:var(--color-text-primary)}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .toc-item[_ngcontent-%COMP%]   .item-description[_ngcontent-%COMP%]{margin-left:1.5rem;font-size:.9rem;color:#666;padding:.25rem 0;margin-bottom:.5rem}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .session-navigation-points[_ngcontent-%COMP%]{margin-left:1.5rem;margin-bottom:1rem}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .session-navigation-points[_ngcontent-%COMP%]   .topics-loading[_ngcontent-%COMP%], .library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .session-navigation-points[_ngcontent-%COMP%]   .no-topics[_ngcontent-%COMP%]{font-size:.9rem;color:#666;padding:.5rem 0;font-style:italic}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .session-navigation-points[_ngcontent-%COMP%]   .navigation-points-list[_ngcontent-%COMP%]   .navigation-point-item[_ngcontent-%COMP%]{margin-bottom:.25rem;border-left:2px solid #eee;padding-left:.5rem}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .session-navigation-points[_ngcontent-%COMP%]   .navigation-points-list[_ngcontent-%COMP%]   .navigation-point-item.topic-color-0[_ngcontent-%COMP%]{border-left-color:#ff5733}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .session-navigation-points[_ngcontent-%COMP%]   .navigation-points-list[_ngcontent-%COMP%]   .navigation-point-item.topic-color-1[_ngcontent-%COMP%]{border-left-color:#ffc300}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .session-navigation-points[_ngcontent-%COMP%]   .navigation-points-list[_ngcontent-%COMP%]   .navigation-point-item.topic-color-2[_ngcontent-%COMP%]{border-left-color:#36dbca}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .session-navigation-points[_ngcontent-%COMP%]   .navigation-points-list[_ngcontent-%COMP%]   .navigation-point-item.topic-color-3[_ngcontent-%COMP%]{border-left-color:#4caf50}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .session-navigation-points[_ngcontent-%COMP%]   .navigation-points-list[_ngcontent-%COMP%]   .navigation-point-item.topic-color-4[_ngcontent-%COMP%]{border-left-color:#3498db}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .session-navigation-points[_ngcontent-%COMP%]   .navigation-points-list[_ngcontent-%COMP%]   .navigation-point-item.topic-color-5[_ngcontent-%COMP%]{border-left-color:#9b59b6}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .session-navigation-points[_ngcontent-%COMP%]   .navigation-points-list[_ngcontent-%COMP%]   .navigation-point-item.topic-color-6[_ngcontent-%COMP%]{border-left-color:#e91e63}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .session-navigation-points[_ngcontent-%COMP%]   .navigation-points-list[_ngcontent-%COMP%]   .navigation-point-item.active[_ngcontent-%COMP%]{border-left-width:6px}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .session-navigation-points[_ngcontent-%COMP%]   .navigation-points-list[_ngcontent-%COMP%]   .navigation-point-item.active[_ngcontent-%COMP%]   .topic-name[_ngcontent-%COMP%]{font-weight:700!important;color:var(--color-primary);cursor:text!important}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .session-navigation-points[_ngcontent-%COMP%]   .navigation-points-list[_ngcontent-%COMP%]   .navigation-point-item.active[_ngcontent-%COMP%]   .part-indicator[_ngcontent-%COMP%]{background-color:var(--color-primary)!important}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .session-navigation-points[_ngcontent-%COMP%]   .navigation-points-list[_ngcontent-%COMP%]   .navigation-point-item[_ngcontent-%COMP%]   .navigation-point-header[_ngcontent-%COMP%]{display:flex;align-items:center}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .session-navigation-points[_ngcontent-%COMP%]   .navigation-points-list[_ngcontent-%COMP%]   .navigation-point-item[_ngcontent-%COMP%]   .navigation-point-header[_ngcontent-%COMP%]   .navigation-point-content[_ngcontent-%COMP%]{flex:1;padding:.25rem 0;cursor:pointer;display:flex;align-items:center;font-size:.9rem}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .session-navigation-points[_ngcontent-%COMP%]   .navigation-points-list[_ngcontent-%COMP%]   .navigation-point-item[_ngcontent-%COMP%]   .navigation-point-header[_ngcontent-%COMP%]   .navigation-point-content[_ngcontent-%COMP%]:hover{color:var(--color-primary)}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .session-navigation-points[_ngcontent-%COMP%]   .navigation-points-list[_ngcontent-%COMP%]   .navigation-point-item[_ngcontent-%COMP%]   .navigation-point-header[_ngcontent-%COMP%]   .navigation-point-content[_ngcontent-%COMP%]:hover   .part-indicator[_ngcontent-%COMP%]{background-color:var(--color-primary)!important}@media (max-width: 767px){.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .session-navigation-points[_ngcontent-%COMP%]   .navigation-points-list[_ngcontent-%COMP%]   .navigation-point-item[_ngcontent-%COMP%]   .navigation-point-header[_ngcontent-%COMP%]   .navigation-point-content[_ngcontent-%COMP%]{color:var(--color-primary)}}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .session-navigation-points[_ngcontent-%COMP%]   .navigation-points-list[_ngcontent-%COMP%]   .navigation-point-item[_ngcontent-%COMP%]   .navigation-point-header[_ngcontent-%COMP%]   .navigation-point-content[_ngcontent-%COMP%]   .point-number[_ngcontent-%COMP%]{color:#666;margin-right:.5rem;min-width:2rem}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .session-navigation-points[_ngcontent-%COMP%]   .navigation-points-list[_ngcontent-%COMP%]   .navigation-point-item[_ngcontent-%COMP%]   .navigation-point-header[_ngcontent-%COMP%]   .navigation-point-content[_ngcontent-%COMP%]   .topic-name[_ngcontent-%COMP%]{font-weight:100;margin-right:.5rem;flex:1}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .session-navigation-points[_ngcontent-%COMP%]   .navigation-points-list[_ngcontent-%COMP%]   .navigation-point-item[_ngcontent-%COMP%]   .navigation-point-header[_ngcontent-%COMP%]   .navigation-point-content[_ngcontent-%COMP%]   .part-indicator[_ngcontent-%COMP%]{font-size:.8rem;color:#000;background-color:var(--color-text-primary);padding:.1rem .3rem;border-radius:3px}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .session-navigation-points[_ngcontent-%COMP%]   .navigation-points-list[_ngcontent-%COMP%]   .navigation-point-item[_ngcontent-%COMP%]   .navigation-point-header[_ngcontent-%COMP%]   .navigation-point-content[_ngcontent-%COMP%]   .part-indicator[_ngcontent-%COMP%]:before{content:"Part "}@media (max-width: 767px){.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .session-navigation-points[_ngcontent-%COMP%]   .navigation-points-list[_ngcontent-%COMP%]   .navigation-point-item[_ngcontent-%COMP%]   .navigation-point-header[_ngcontent-%COMP%]   .navigation-point-content[_ngcontent-%COMP%]   .part-indicator[_ngcontent-%COMP%]:before{content:""}}.library-book-toc[_ngcontent-%COMP%]   .toc-content[_ngcontent-%COMP%]   .session-navigation-points[_ngcontent-%COMP%]   .navigation-points-list[_ngcontent-%COMP%]   .navigation-point-item[_ngcontent-%COMP%]   .topic-description[_ngcontent-%COMP%]{margin-left:1.5rem;font-size:.85rem;color:#666;padding:.5rem;border-radius:3px;margin-bottom:.25rem;line-height:1.4}.library-book-toc[_ngcontent-%COMP%]   .toc-level[_ngcontent-%COMP%]{margin-left:.5rem}']})};var Cn=class i{constructor(t){this.el=t}normalizeHeadings=2;observer;MAX_LEVEL=4;ngOnInit(){this.normalizeHeadingLevels(),this.setupMutationObserver()}ngOnChanges(){this.normalizeHeadingLevels()}ngOnDestroy(){this.observer&&this.observer.disconnect()}setupMutationObserver(){this.observer=new MutationObserver(()=>{this.normalizeHeadingLevels()}),this.observer.observe(this.el.nativeElement,{childList:!0,subtree:!0})}normalizeHeadingLevels(){let e=this.el.nativeElement.querySelectorAll("h1, h2, h3, h4, h5, h6");if(e.length===0)return;let n=new Set;e.forEach(s=>{let h=parseInt(s.tagName.charAt(1));n.add(h)});let a=Array.from(n).sort((s,h)=>s-h),o=this.createLevelMapping(a);e.forEach(s=>{let h=parseInt(s.tagName.charAt(1)),k=o.get(h);k&&h!==k&&this.replaceHeading(s,k)})}createLevelMapping(t){let e=new Map,n=this.normalizeHeadings,a=this.MAX_LEVEL,o=a-n+1;if(t.length<=o)t.forEach((s,h)=>{e.set(s,n+h)});else{e.set(t[0],n);let s=t.slice(1),h=o-1;if(h===1)s.forEach(k=>{e.set(k,a)});else{let k=Math.ceil(s.length/h),y=n+1,b=0;s.forEach((P,F)=>{e.set(P,y),b++,!(y===a)&&(b>=k||F<s.length/2&&b>=1)&&(y++,b=0)})}}return e}replaceHeading(t,e){let n=document.createElement(`h${e}`);Array.from(t.attributes).forEach(a=>{n.setAttribute(a.name,a.value)}),n.innerHTML=t.innerHTML,n.className=t.className,t.parentNode?.replaceChild(n,t)}static \u0275fac=function(e){return new(e||i)(m(N))};static \u0275dir=H({type:i,selectors:[["","normalizeHeadings",""]],inputs:{normalizeHeadings:[2,"normalizeHeadings","normalizeHeadings",Lt]},standalone:!0,features:[ze,j]})};var Le=class i{constructor(t){this.el=t}ngAfterViewInit(){this.el.nativeElement.querySelectorAll("a[href]").forEach(e=>{let n=e.getAttribute("href");n&&this.isExternalLink(n)&&(e.setAttribute("target","_blank"),e.setAttribute("rel","noopener noreferrer"))})}isExternalLink(t){if(t.startsWith("http://")||t.startsWith("https://")){let e=window.location.hostname,n=new URL(t).hostname;return e!==n}return!1}static \u0275fac=function(e){return new(e||i)(m(N))};static \u0275dir=H({type:i,selectors:[["","appExternalLinks",""]],standalone:!0})};function hr(i,t){if(i&1&&(c(0,"h3",1),u(1),r()),i&2){let e=l();d(),ye(" ",e.type==="conclusion"?"Conclusion: ":""," ",e.item==null?null:e.item.title," ")}}var _n=class i{type="introduction";level=0;showTitle=!1;isActive=!1;item;get content(){return this.type==="introduction"?this.item.introduction||"":this.item.conclusion||""}get levelPadding(){return`0 calc(${this.level} * var(--level-padding))`}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=_({type:i,selectors:[["app-library-book-section"]],inputs:{type:"type",level:"level",showTitle:"showTitle",isActive:"isActive",item:"item"},standalone:!0,features:[x],decls:4,vars:12,consts:[[1,"library-book-section"],[1,"section-title"],[1,"content"],["appExternalLinks","",3,"data"]],template:function(e,n){e&1&&(c(0,"div",0),v(1,hr,2,2,"h3",1),c(2,"div",2),D(3,"markdown",3),r()()),e&2&&(et("padding",n.levelPadding),L("introduction",n.type==="introduction")("conclusion",n.type==="conclusion")("active",n.isActive),z("data-section-type",n.type)("data-content-id",n.item.id),d(),Ve(n.showTitle?1:-1),d(2),p("data",n.content))},dependencies:[w,Re,He,Le],styles:["[_nghost-%COMP%]{--level-padding: 24px}@media (max-width: 767px){[_nghost-%COMP%]{--level-padding: 12px}}.library-book-section[_ngcontent-%COMP%]{margin-bottom:var(--space-md);transition:padding-left .2s ease}.library-book-section[_ngcontent-%COMP%]   .loading-state[_ngcontent-%COMP%], .library-book-section[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%]{font-style:italic;color:var(--color-text-secondary)}.library-book-section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{margin-bottom:var(--space-sm);font-size:1.2rem;text-align:center;border-bottom:1px dashed rgba(255,255,102,.8)}.library-book-section[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{line-height:1.6;text-align:justify}@media (max-width: 768px){.library-book-section[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{text-align:inherit}}.library-book-section[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     h1, .library-book-section[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     h2, .library-book-section[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     h3, .library-book-section[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     h4, .library-book-section[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     h5, .library-book-section[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     h6{margin-top:1em;margin-bottom:.5em}.library-book-section[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     p{margin-bottom:1em}.library-book-section[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     ul, .library-book-section[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     ol{margin-bottom:1em;padding-left:2em}.library-book-section[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     blockquote{border-left:3px solid var(--color-border);padding-left:var(--space-sm);margin-left:var(--space-sm);color:var(--color-text-secondary)}.library-book-section[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     code{background-color:var(--color-background-secondary);padding:.2em .4em;border-radius:3px;font-family:monospace}.library-book-section[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     pre{background-color:var(--color-background-secondary);padding:var(--space-sm);border-radius:3px;overflow-x:auto;margin-bottom:1em}.library-book-section[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]     pre code{background-color:transparent;padding:0}"]})};var xn=class i{interaction;isCurrent=!1;static \u0275fac=function(e){return new(e||i)};static \u0275cmp=_({type:i,selectors:[["app-library-book-interaction"]],inputs:{interaction:"interaction",isCurrent:"isCurrent"},standalone:!0,features:[x],decls:12,vars:6,consts:[[1,"interaction"],[1,"interaction-number"],[1,"human-message"],[1,"sender"],[1,"assistant-message"],["appExternalLinks","",3,"data"]],template:function(e,n){e&1&&(c(0,"div",0)(1,"div",1),u(2),r(),c(3,"div",2)(4,"div",3),u(5,"Human"),r(),c(6,"pre"),u(7),r()(),c(8,"div",4)(9,"div",3),u(10,"Assistant"),r(),D(11,"markdown",5),r()()),e&2&&(L("current",n.isCurrent),z("data-interaction-num",n.interaction.orderNum),d(2),A(n.interaction.orderNum),d(5),A(n.interaction.humanMessage),d(4),p("data",n.interaction.assistantMessage))},dependencies:[w,Re,He,Le],styles:[".interaction[_ngcontent-%COMP%]{margin:1rem 0;display:flex;flex-direction:column;gap:1.5rem;position:relative}.interaction.current[_ngcontent-%COMP%]   .human-message[_ngcontent-%COMP%]{border-color:#3c6c}.interaction.current[_ngcontent-%COMP%]   .assistant-message[_ngcontent-%COMP%]{border-color:#f93c}.interaction[_ngcontent-%COMP%]   .interaction-number[_ngcontent-%COMP%]{position:absolute;top:0;right:0;background-color:#333c;color:#3c6;font-family:monospace;padding:2px 8px;border-radius:12px;font-size:.8rem;font-weight:500;z-index:1}.interaction[_ngcontent-%COMP%]   .human-message[_ngcontent-%COMP%], .interaction[_ngcontent-%COMP%]   .assistant-message[_ngcontent-%COMP%]{max-width:80%;padding:1rem;border-radius:8px;position:relative}.interaction[_ngcontent-%COMP%]   .human-message[_ngcontent-%COMP%]   .sender[_ngcontent-%COMP%], .interaction[_ngcontent-%COMP%]   .assistant-message[_ngcontent-%COMP%]   .sender[_ngcontent-%COMP%]{position:absolute;top:-20px;font-size:.9rem;color:#ccc}.interaction[_ngcontent-%COMP%]   .human-message[_ngcontent-%COMP%]{align-self:flex-start;background-color:#333c;border:1px solid #0c0;border-color:#3c63;font-family:monospace;font-size:.9rem;color:#3c6}.interaction[_ngcontent-%COMP%]   .human-message[_ngcontent-%COMP%]   .sender[_ngcontent-%COMP%]{left:12px;top:-12px;padding:0 6px;background:linear-gradient(to top,#333c,#00000080);letter-spacing:3px;color:#0c0}.interaction[_ngcontent-%COMP%]   .human-message[_ngcontent-%COMP%]   pre[_ngcontent-%COMP%]{white-space:pre-wrap;word-wrap:break-word;margin:0}.interaction[_ngcontent-%COMP%]   .assistant-message[_ngcontent-%COMP%]{align-self:flex-end;background-color:#333c;border:1px solid #f93;border-color:#f933;color:#f93}.interaction[_ngcontent-%COMP%]   .assistant-message[_ngcontent-%COMP%]   .sender[_ngcontent-%COMP%]{right:12px;top:-12px;padding:0 6px;background:linear-gradient(to top,#333c,#00000080);letter-spacing:3px;color:#f90}.interaction[_ngcontent-%COMP%]   .assistant-message[_ngcontent-%COMP%]     markdown pre{background-color:var(--color-bg-primary)}"]})};var lr=["container"];function pr(i,t){i&1&&(c(0,"div",7)(1,"p"),u(2,"Loading interactions..."),r()())}function ur(i,t){if(i&1&&(c(0,"div",8)(1,"p"),u(2),r()()),i&2){let e=l();d(2),A(e.error)}}function yr(i,t){i&1&&(c(0,"div",9)(1,"p"),u(2,"No interactions found for this session."),r()())}function kr(i,t){if(i&1&&(c(0,"div",12),D(1,"app-library-book-interaction",13),r()),i&2){let e=t.$implicit,n=l(2);z("data-interaction-num",e.orderNum),d(),p("interaction",e)("isCurrent",n.activeInteractionNum===e.orderNum)}}function mr(i,t){if(i&1&&(c(0,"div",10),v(1,kr,2,3,"div",11),r()),i&2){let e=l();d(),p("ngForOf",e.interactions.interactions)}}function gr(i,t){i&1&&(c(0,"div",14)(1,"p"),u(2,"Loading more interactions..."),r()())}var bn=class i{constructor(t){this.libraryService=t}PAGE_SIZE=10;bookId="";contentId="";activeInteraction;scrollContainer;preloadLast=!1;isActive=!1;activeDetectionOffset=0;activeInteractionChange=new f;totalInteractions=new f;initialLoadComplete=new f;container;interactions=null;activeInteractionNum=null;lastOrderNum=0;loading=!1;error=null;targetInteraction;ngOnDestroy(){this.scrollContainer&&this.scrollContainer.removeEventListener("scroll",this.handleScroll)}ngAfterViewInit(){this.scrollContainer&&this.scrollContainer.addEventListener("scroll",this.handleScroll),this.targetInteraction=this.activeInteraction,this.preloadLast?this.loadLastInteractions():this.loadInteractions()}loadLastInteractions(){this.loading||(this.loading=!0,this.libraryService.getContentLastInteractions(this.bookId,this.contentId,this.PAGE_SIZE).subscribe({next:t=>{this.interactions=t,this.lastOrderNum=t.total,this.totalInteractions.emit(t.total),this.initialLoadComplete.emit(),this.loading=!1,setTimeout(()=>this.handleScroll())},error:t=>{console.error("Error loading last interactions:",t),this.error="Failed to load last interactions",this.loading=!1}}))}handleScroll=()=>{if(!(!this.interactions||!this.scrollContainer||!this.isActive))try{let t=(this.scrollContainer.querySelector(".content-container")?.offsetTop||0)+this.activeDetectionOffset,e=this.container.nativeElement.querySelectorAll(".interaction-wrapper");if(!e.length)return;let n=Array.from(e).pop();if(n&&n.getBoundingClientRect().top<=t){let o=parseInt(n.getAttribute("data-interaction-num"));this.activeInteractionNum=o,this.activeInteractionChange.emit(o);return}let a=Array.from(e).map(o=>({num:parseInt(o.getAttribute("data-interaction-num")),rectTop:o.getBoundingClientRect().top})).filter(o=>o.rectTop<=t).sort((o,s)=>s.rectTop-o.rectTop)[0];a?.num!=this.activeInteractionNum&&(this.activeInteractionNum=a?.num||null,this.activeInteractionChange.emit(this.activeInteractionNum||0),this.activeInteractionNum&&this.interactions.interactions.length>0&&this.activeInteractionNum==this.interactions.interactions[0].orderNum&&this.loadPreviousInteractions()),n&&n.getBoundingClientRect().top<=window.innerHeight&&this.lastOrderNum<(this.interactions?.total||0)&&this.loadMore()}catch(t){console.error("Error in scroll handler:",t)}};loadPreviousInteractions(){if(this.loading||!this.interactions)return;let t=this.interactions.interactions[0]?.orderNum;if(t<=1)return;let e=Math.min(this.PAGE_SIZE,t-1),n=Math.max(0,t-e-1);this.loading=!0,this.libraryService.getContentInteractions(this.bookId,this.contentId,n,e).subscribe({next:a=>{this.interactions.interactions=[...a.interactions,...this.interactions.interactions],this.loading=!1},error:a=>{console.error("Error loading previous interactions:",a),this.error="Failed to load previous interactions",this.loading=!1}})}loadInteractions(){if(this.loading)return;let t=this.lastOrderNum;!this.interactions&&this.activeInteraction&&this.isActive&&(t=Math.max(0,this.activeInteraction-2)),this.loading=!0,this.libraryService.getContentInteractions(this.bookId,this.contentId,t,this.PAGE_SIZE).subscribe({next:e=>{if(this.interactions)this.interactions.interactions=[...this.interactions.interactions,...e.interactions];else{if(e.interactions.length==0&&t>0){this.activeInteraction=void 0,this.loading=!1,this.loadInteractions();return}this.interactions=e,this.totalInteractions.emit(e.total),this.initialLoadComplete.emit()}e.interactions.length>0&&(this.lastOrderNum=e.interactions[e.interactions.length-1]?.orderNum),this.loading=!1,this.targetInteraction?setTimeout(()=>this.scrollToTargetInteraction()):setTimeout(()=>this.handleScroll())},error:e=>{console.error("Error loading interactions:",e),this.error="Failed to load interactions",this.loading=!1}})}scrollToTargetInteraction(){if(!this.targetInteraction||!this.scrollContainer||!this.container||!this.isActive)return;let t=this.container.nativeElement.querySelector(`[data-interaction-num="${this.targetInteraction}"]`);if(t){let e=(this.scrollContainer.querySelector(".content-container")?.offsetTop||0)+this.activeDetectionOffset,n=t.offsetTop;this.scrollContainer.scrollTop=n-e+1,this.activeInteractionNum=this.targetInteraction,this.activeInteractionChange.emit(this.targetInteraction),this.targetInteraction=void 0}else this.handleScroll()}loadMore(){this.loadInteractions()}static \u0275fac=function(e){return new(e||i)(m(Pt))};static \u0275cmp=_({type:i,selectors:[["app-library-book-session"]],viewQuery:function(e,n){if(e&1&&Me(lr,5),e&2){let a;ie(a=ae())&&(n.container=a.first)}},inputs:{bookId:"bookId",contentId:"contentId",activeInteraction:"activeInteraction",scrollContainer:"scrollContainer",preloadLast:"preloadLast",isActive:"isActive",activeDetectionOffset:"activeDetectionOffset"},outputs:{activeInteractionChange:"activeInteractionChange",totalInteractions:"totalInteractions",initialLoadComplete:"initialLoadComplete"},standalone:!0,features:[x],decls:7,vars:5,consts:[["container",""],[1,"session-container"],["class","loading-state",4,"ngIf"],["class","error-state",4,"ngIf"],["class","empty-state",4,"ngIf"],["class","interactions-list",4,"ngIf"],["class","loading-more",4,"ngIf"],[1,"loading-state"],[1,"error-state"],[1,"empty-state"],[1,"interactions-list"],["class","interaction-wrapper",4,"ngFor","ngForOf"],[1,"interaction-wrapper"],[3,"interaction","isCurrent"],[1,"loading-more"]],template:function(e,n){e&1&&(c(0,"div",1,0),v(2,pr,3,0,"div",2)(3,ur,3,1,"div",3)(4,yr,3,0,"div",4)(5,mr,2,1,"div",5)(6,gr,3,0,"div",6),r()),e&2&&(d(2),p("ngIf",n.loading&&!n.interactions),d(),p("ngIf",n.error),d(),p("ngIf",n.interactions&&n.interactions.interactions.length===0),d(),p("ngIf",n.interactions&&n.interactions.interactions.length>0),d(),p("ngIf",n.loading&&n.interactions))},dependencies:[w,W,O,xn],styles:[".session-container[_ngcontent-%COMP%]{padding:1rem 0}.session-container[_ngcontent-%COMP%]   .loading-state[_ngcontent-%COMP%], .session-container[_ngcontent-%COMP%]   .error-state[_ngcontent-%COMP%], .session-container[_ngcontent-%COMP%]   .empty-state[_ngcontent-%COMP%], .session-container[_ngcontent-%COMP%]   .loading-more[_ngcontent-%COMP%]{padding:1rem;text-align:center;color:#666}.session-container[_ngcontent-%COMP%]   .error-state[_ngcontent-%COMP%]{color:#dc3545}.session-container[_ngcontent-%COMP%]   .interactions-list[_ngcontent-%COMP%]   .interaction-wrapper[_ngcontent-%COMP%]{margin-bottom:1.5rem}.session-container[_ngcontent-%COMP%]   .interactions-list[_ngcontent-%COMP%]   .interaction-wrapper[_ngcontent-%COMP%]:last-child{margin-bottom:0}"]})};var fr=["container"],xo=(i,t)=>t.id,vr=i=>({$implicit:i,level:0}),Mr=(i,t)=>({$implicit:i,level:t});function Cr(i,t){i&1&&ce(0)}function _r(i,t){if(i&1&&v(0,Cr,1,0,"ng-container",6),i&2){let e=t.$implicit;l();let n=R(14);p("ngTemplateOutlet",n)("ngTemplateOutletContext",ke(2,vr,e))}}function xr(i,t){if(i&1&&(c(0,"h1",9),u(1),r()),i&2){let e=l().$implicit,n=l();L("active",n.isTitleActive(e)),z("data-content-id",e.id),d(),A(e.title)}}function br(i,t){if(i&1&&(c(0,"h2",9),u(1),r()),i&2){let e=l().$implicit,n=l();L("active",n.isTitleActive(e)),z("data-content-id",e.id),d(),A(e.title)}}function wr(i,t){if(i&1){let e=I();c(0,"app-library-book-session",12),g("activeInteractionChange",function(a){M(e);let o=l(3);return C(o.onActiveInteractionChange(a))})("totalInteractions",function(a){M(e);let o=l(2).$implicit,s=l();return C(s.onTotalInteractions(a,o.id))})("initialLoadComplete",function(){M(e);let a=l(3);return C(a.onSessionLoaded())}),r()}if(i&2){let e=l(2).$implicit,n=l(),a=R(1);p("isActive",n.isSessionActive(e))("bookId",n.bookId)("contentId",e.id)("activeInteraction",n.activeInteraction)("scrollContainer",a)("preloadLast",n.preloadLast(e.id))("activeDetectionOffset",n.activeDetectionOffset)}}function Ir(i,t){if(i&1&&(c(0,"div",11)(1,"p"),u(2,"Session content will load when scrolled into view"),r()()),i&2){let e=l(2).$implicit;z("data-content-id",e.id)}}function Lr(i,t){if(i&1&&(c(0,"div",8),v(1,wr,1,7,"app-library-book-session",10)(2,Ir,3,1,"div",11),r()),i&2){let e=l().$implicit,n=l();p("normalizeHeadings",3),z("data-content-id",e.id),d(),Ve(n.isSessionVisible(e.id)?1:2)}}function Sr(i,t){i&1&&ce(0)}function Pr(i,t){if(i&1&&v(0,Sr,1,0,"ng-container",6),i&2){let e=t.$implicit,n=l(3).level;l();let a=R(14);p("ngTemplateOutlet",a)("ngTemplateOutletContext",bt(2,Mr,e,n+1))}}function Dr(i,t){if(i&1&&Tn(0,Pr,1,5,"ng-container",null,xo),i&2){let e=l(2).$implicit;Vn(e.children)}}function Ar(i,t){if(i&1&&(c(0,"div",13),D(1,"app-library-book-section",14),r(),v(2,Dr,2,0),c(3,"div",15),D(4,"app-library-book-section",16),r()),i&2){let e=l(),n=e.$implicit,a=e.level,o=l();L("active",o.isSectionActive(n,"introduction")),p("normalizeHeadings",3),z("data-content-id",n.id)("data-section-type","introduction"),d(),p("item",n)("isActive",o.couldBeActive(n)&&o.currentSectionType==="introduction")("level",a),d(),Ve(n.children&&n.children.length>0?2:-1),d(),L("active",o.isSectionActive(n,"conclusion")),p("normalizeHeadings",3),z("data-content-id",n.id)("data-section-type","conclusion"),d(),p("item",n)("isActive",o.couldBeActive(n)&&o.currentSectionType==="conclusion")("level",a)("showTitle",!0)}}function Or(i,t){if(i&1&&v(0,xr,2,4,"h1",7)(1,br,2,4,"h2",7)(2,Lr,3,3,"div",8)(3,Ar,5,18),i&2){let e=t.$implicit;Ve(e.id==="book"?0:1),d(2),Ve(e.type=="session"?2:3)}}var wn=class i{constructor(t){this.cdr=t}bookContent=[];activeContentSlug;activePosition;bookId="";get activeInteraction(){return+(this.activePosition||"")}activeInteractionChange=new f;contentDetails={};contentDetailsRequest=new f;navigate=new f;container;activeDetectionOffset=120;sessionInteractionCounts=new Map;visibleSessionsMap={};introductions={};conclusions={};currentPosition;scrollTopSet=!1;flattenedContent=[];sessionsToLoadLast=new Set;currentSectionType;ngOnChanges(t){t.bookContent&&this.bookContent.length>0&&(this.flattenedContent=this.flattenContent(this.bookContent)),t.activeContentSlug&&(this.currentPosition=this.activeContentSlug)}ngAfterViewInit(){setTimeout(()=>{this.setScrollPosition(),this.checkApproachingSessionPlaceholders(),this.container.nativeElement.addEventListener("scroll",this.handleScroll)},100),this.updateBackgroundPosition(),window.addEventListener("resize",()=>this.updateBackgroundPosition())}updateBackgroundPosition(){let t=this.container.nativeElement.querySelector(".content-container");if(!t)return;let e=t.getBoundingClientRect(),n=e.width;t.style.setProperty("--container-left",`${e.left}px`),t.style.setProperty("--container-width-25",`${n*.25}px`)}ngOnDestroy(){this.container?.nativeElement&&this.container.nativeElement.removeEventListener("scroll",this.handleScroll)}onActiveInteractionChange(t){this.activeInteractionChange.emit(t)}onTotalInteractions(t,e){this.sessionInteractionCounts.set(e,t)}canLoadSession=!0;onSessionLoaded(){this.canLoadSession=!0,this.scrollTopSet||setTimeout(()=>{this.setScrollPosition(),this.scrollTopSet=!0})}flattenContent(t){let e=[],n=a=>{for(let o of a)e.push(o),o.children&&o.children.length>0&&n(o.children)};return t.length>0&&n(t),e}loadAllContentDetails(){for(let t of this.flattenedContent)(t.type==="book"||t.type==="chapter")&&this.loadContentDetails(t)}setScrollPosition(){if(!this.container||!this.activeContentSlug||this.scrollTopSet)return;let t=this.container.nativeElement,e="";if(this.activePosition==="introduction"||this.activePosition==="conclusion"?this.activeContentSlug==="book"?e=`.section[data-content-id="book"][data-section-type="${this.activePosition}"]`:e=`.section[data-content-id="${this.getIdFromSlug(this.activeContentSlug)}"][data-section-type="${this.activePosition}"]`:e=`.content-title[data-content-id="${this.getIdFromSlug(this.activeContentSlug)}"]`,e){let n=t.querySelector(e);if(n){console.log("found");let a=n.getBoundingClientRect().top+1;t.scrollTop=a-this.activeDetectionOffset,this.scrollTopSet=!0}else console.warn(`Target element not found: ${e}`)}}handleScroll=()=>{try{this.checkApproachingSessionPlaceholders(),this.updateActiveContent(),this.checkBookEnd()}catch(t){console.error("Error in scroll handler:",t)}};updateActiveContent(){let t=this.container.nativeElement.querySelectorAll(".content-title"),e=this.container.nativeElement.querySelectorAll(".section"),n=this.container.nativeElement.querySelectorAll(".session-content"),a=Array.from(e).map(y=>{let b=y.getAttribute("data-content-id")||"book";return{contentId:b,contentSlug:this.getSlugFromId(b),sectionType:y.getAttribute("data-section-type"),rectTop:y.getBoundingClientRect().top}}).filter(y=>y.rectTop<this.activeDetectionOffset).sort((y,b)=>b.rectTop-y.rectTop)[0],o=Array.from(t).map(y=>{let b=y.getAttribute("data-content-id"),P=y.getBoundingClientRect().top;return{contentId:b,contentSlug:this.getSlugFromId(b),rectTop:P}}).filter(y=>y.rectTop<this.activeDetectionOffset).sort((y,b)=>b.rectTop-y.rectTop)[0],s=Array.from(n).map(y=>{let b=y.getAttribute("data-content-id");return{rectTop:y.getBoundingClientRect().top}}).filter(y=>y.rectTop<this.activeDetectionOffset).sort((y,b)=>b.rectTop-y.rectTop)[0],h=!1,k=!1;(!s||o&&o.rectTop>s.rectTop||a&&a.rectTop>s.rectTop)&&(a&&o?(h=a.rectTop>o.rectTop,k=!h):a?h=!0:o&&(k=!0)),h?(a.contentSlug!==this.currentPosition||a.sectionType!==this.activePosition)&&(this.currentPosition=a.contentSlug,this.activePosition=a.sectionType,this.navigate.emit({contentId:a.contentId,contentSlug:a.contentSlug,position:a.sectionType})):k&&(this.currentPosition=o.contentSlug,this.activePosition=void 0,this.navigate.emit({contentId:o.contentId,contentSlug:o.contentSlug,position:void 0}))}checkBookEnd(){let t=this.container.nativeElement.querySelector(".end-spacer");t&&t.getBoundingClientRect().top<=0}sessionPreloadTresholdRatio=1.2;checkApproachingSessionPlaceholders(){if(!this.canLoadSession)return;let t=!1,e=Array.from(this.container.nativeElement.querySelectorAll(".session-placeholder")).map(a=>({element:a,contentId:a.getAttribute("data-content-id")})).filter(a=>!this.visibleSessionsMap[a.contentId]).map(a=>({contentId:a.contentId,rect:a.element.getBoundingClientRect()})),n=e.filter(a=>a.rect.top>=0&&a.rect.top<window.innerHeight*this.sessionPreloadTresholdRatio).sort((a,o)=>a.rect.top-o.rect.top)[0];n||(t=!0,n=e.filter(a=>a.rect.bottom<0&&a.rect.bottom>=-window.innerHeight*this.sessionPreloadTresholdRatio).sort((a,o)=>o.rect.bottom-a.rect.bottom)[0]),n&&(this.visibleSessionsMap[n.contentId]=!0,this.visibleSessionsMap=V({},this.visibleSessionsMap),t&&this.sessionsToLoadLast.add(`${n.contentId}`)),this.canLoadSession=!n}preloadLast(t){return this.sessionsToLoadLast.has(`${t}`)}isSessionVisible(t){return!!this.visibleSessionsMap[t]}loadContentDetails(t){t.type!=="book"&&t.type!=="chapter"||(this.introductions[t.id]=`This is an introduction to ${t.title}`,this.conclusions[t.id]=`This is a conclusion to ${t.title}`)}couldBeActive(t){return t.urlSlug==this.currentPosition||t.id==="book"&&this.currentPosition==="book"}isActiveItem(t){return t.urlSlug===this.activeContentSlug?!0:t.id==="book"&&(!this.activeContentSlug||this.activeContentSlug==="book")}isTitleActive(t){return this.isActiveItem(t)&&!this.activePosition}isSectionActive(t,e){return this.isActiveItem(t)&&this.activePosition===e}isSessionActive(t){return this.isActiveItem(t)}getSlugFromId(t){if(t==="book")return"book";let e=this.flattenedContent.find(n=>n.id==t);return e?e.urlSlug||e.id:t}getIdFromSlug(t){if(t==="book")return"book";let e=this.flattenedContent.find(n=>n.urlSlug===t);return e?e.id:t}static \u0275fac=function(e){return new(e||i)(m(pe))};static \u0275cmp=_({type:i,selectors:[["app-library-book-content"]],viewQuery:function(e,n){if(e&1&&Me(fr,5),e&2){let a;ie(a=ae())&&(n.container=a.first)}},inputs:{bookContent:"bookContent",activeContentSlug:"activeContentSlug",activePosition:"activePosition",bookId:"bookId",contentDetails:"contentDetails"},outputs:{activeInteractionChange:"activeInteractionChange",contentDetailsRequest:"contentDetailsRequest",navigate:"navigate"},standalone:!0,features:[j,x],decls:15,vars:2,consts:[["container",""],["contentItem",""],[1,"library-book-content"],[1,"content-container"],[1,"end-spacer"],[1,"completion-message"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"content-title",3,"active"],[1,"session-content",3,"normalizeHeadings"],[1,"content-title"],[3,"isActive","bookId","contentId","activeInteraction","scrollContainer","preloadLast","activeDetectionOffset"],[1,"session-placeholder"],[3,"activeInteractionChange","totalInteractions","initialLoadComplete","isActive","bookId","contentId","activeInteraction","scrollContainer","preloadLast","activeDetectionOffset"],[1,"section","introduction",3,"normalizeHeadings"],["type","introduction",3,"item","isActive","level"],[1,"section","conclusion",3,"normalizeHeadings"],["type","conclusion",3,"item","isActive","level","showTitle"]],template:function(e,n){e&1&&(c(0,"div",2,0)(2,"div",3),Tn(3,_r,1,4,"ng-container",null,xo),c(5,"div",4)(6,"div",5)(7,"span"),u(8,"\u{1F389}"),r(),c(9,"h3"),u(10,"You've reached the end!"),r(),c(11,"p"),u(12,"Congratulations on completing this book"),r()()()()(),v(13,Or,4,2,"ng-template",null,1,Y)),e&2&&(d(3),Vn(n.bookContent),d(2),L("active",n.currentPosition==="book_end"))},dependencies:[w,_e,_n,bn,Cn],styles:['.library-book-content[_ngcontent-%COMP%]{height:100%;overflow:auto;padding:0 2rem}@media (max-width: 767px){.library-book-content[_ngcontent-%COMP%]{padding:0 .5rem}}.library-book-content[_ngcontent-%COMP%]   .content-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto}.library-book-content[_ngcontent-%COMP%]   .content-container[_ngcontent-%COMP%]:before{content:"";position:fixed;top:120px;left:var(--container-left, 0);width:var(--container-width-25, 25vw);height:0;padding-bottom:calc(var(--container-width-25, 25vw) * .75);background-image:url(/images/bg.jpg);background-size:cover;background-position:center;background-repeat:no-repeat;opacity:1;z-index:-1;pointer-events:none}.library-book-content[_ngcontent-%COMP%]   .content-container[_ngcontent-%COMP%]   .end-spacer[_ngcontent-%COMP%]{height:100vh;display:flex;align-items:center;justify-content:center}.library-book-content[_ngcontent-%COMP%]   .content-container[_ngcontent-%COMP%]   .end-spacer[_ngcontent-%COMP%]   .completion-message[_ngcontent-%COMP%]{text-align:center;color:#333}.library-book-content[_ngcontent-%COMP%]   .content-container[_ngcontent-%COMP%]   .end-spacer[_ngcontent-%COMP%]   .completion-message[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:2em;display:block;margin-bottom:1rem}.library-book-content[_ngcontent-%COMP%]   .content-container[_ngcontent-%COMP%]   .end-spacer[_ngcontent-%COMP%]   .completion-message[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem}.library-book-content[_ngcontent-%COMP%]   .content-container[_ngcontent-%COMP%]   .end-spacer.active[_ngcontent-%COMP%]{background-color:#2c3e50;color:#fff;border-radius:4px}.library-book-content[_ngcontent-%COMP%]   .content-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:500;padding:24px 0 6px;margin-bottom:1rem;color:#ff69;text-align:center;letter-spacing:.2rem;font-family:serif}.library-book-content[_ngcontent-%COMP%]   .content-title[_ngcontent-%COMP%]:first-child{padding-top:36px}.library-book-content[_ngcontent-%COMP%]   .content-title.active[_ngcontent-%COMP%]{color:#ffff66e6}.library-book-content[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]{margin-top:1rem;padding:1rem;background-color:#333c;border:1px solid #0c0;border-color:#ff63;color:#ff6c;border-radius:8px}.library-book-content[_ngcontent-%COMP%]   .section.active[_ngcontent-%COMP%]{border-color:#ff69}.library-book-content[_ngcontent-%COMP%]   .session-content[_ngcontent-%COMP%]{margin-top:1rem;margin-bottom:2rem;max-width:95vw;overflow-x:hidden;word-wrap:break-word}.library-book-content[_ngcontent-%COMP%]   .session-placeholder[_ngcontent-%COMP%]{height:120px}']})};var In=class i{constructor(t){this.navigationService=t}widgetStateSubject=new Ye({visible:!1,showToc:!1,bookTitle:"Book"});widgetState$=this.widgetStateSubject.asObservable();copyMessageSubject=new Ye("");copyMessage$=this.copyMessageSubject.asObservable();showWidget(t,e,n){this.widgetStateSubject.next({visible:!0,bookId:t,bookSlug:e,bookTitle:n||this.widgetStateSubject.value.bookTitle,showToc:this.widgetStateSubject.value.showToc,activeContentSlug:this.widgetStateSubject.value.activeContentSlug,activePosition:this.widgetStateSubject.value.activePosition})}hideWidget(){this.widgetStateSubject.next(B(V({},this.widgetStateSubject.value),{visible:!1}))}setTocVisibility(t){this.widgetStateSubject.next(B(V({},this.widgetStateSubject.value),{showToc:t}))}updatePosition(t,e){this.widgetStateSubject.next(B(V({},this.widgetStateSubject.value),{activeContentSlug:t,activePosition:e}))}copyBookUrl(){let{bookSlug:t}=this.widgetStateSubject.value;if(!t)return;let e=`${window.location.origin}/library/book/${t}`;this.copyTextToClipboard(e),this.showCopyMessage("Book URL")}copyPositionUrl(){console.log("copyPositionUrl called");let{bookSlug:t,activeContentSlug:e,activePosition:n}=this.widgetStateSubject.value;if(!t||!e)return;let a=`${window.location.origin}/library/book/${t}/${e}`;n&&(a+=`/${n}`),this.copyTextToClipboard(a),this.showCopyMessage("Position URL")}copyTextToClipboard(t){try{navigator.clipboard.writeText(t)}catch{let n=document.createElement("textarea");n.value=t,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n)}}showCopyMessage(t){}static \u0275fac=function(e){return new(e||i)(G(ji))};static \u0275prov=$({token:i,factory:i.\u0275fac,providedIn:"root"})};function Vr(i,t){if(i&1){let e=I();c(0,"div",5)(1,"app-library-book-toc",6),g("topicRequest",function(a){M(e);let o=l(2);return C(o.onTopicRequest(a))})("navigate",function(a){M(e);let o=l(2);return C(o.onNavigate(a))}),r()()}if(i&2){let e=l(2);d(),p("bookContent",e.bookContent)("activeContentSlug",e.activeContentSlug)("activePosition",e.activePosition)("sessionTopics",e.sessionTopics)("loadingTopics",e.loadingTopics)}}function Er(i,t){if(i&1){let e=I();c(0,"div",7)(1,"app-library-book-content",8),g("navigate",function(a){M(e);let o=l(2);return C(o.onNavigate(a))})("contentDetailsRequest",function(a){M(e);let o=l(2);return C(o.onContentDetailsRequest(a))})("activeInteractionChange",function(a){M(e);let o=l(2);return C(o.onActiveInteractionChange(a))}),r()()}if(i&2){let e=l(2);d(),p("bookId",e.bookId)("bookContent",e.bookContent)("activeContentSlug",e.activeContentSlug)("activePosition",e.activePosition)("contentDetails",e.contentDetails)}}function qr(i,t){if(i&1&&(c(0,"div",2),v(1,Vr,2,5,"div",3)(2,Er,2,5,"div",4),r()),i&2){let e=l();d(),p("ngIf",e.showToc),d(),p("ngIf",!e.showToc)}}function Fr(i,t){i&1&&(c(0,"div",9),u(1," Waiting for book content... "),r())}var bo=class i{constructor(t,e,n){this.storageService=t;this.libraryService=e;this.widgetService=n}bookId="";bookSlug;bookContent=[];savedPosition=null;rootItem=null;activeContentId;activeContentSlug;activePosition;showToc=!1;sessionTopics={};loadingTopics=new Set;contentDetails={};loadingContentDetails=new Set;ngOnInit(){this.bookId&&this.bookSlug&&this.widgetService.showWidget(this.bookId,this.bookSlug),this.widgetService.widgetState$.subscribe(t=>{this.showToc=t.showToc})}ngOnChanges(t){if(t.bookContent&&this.bookContent.length>0){this.rootItem=this.bookContent[0];let e=this.rootItem.title||"Untitled Book";this.bookId&&this.widgetService.showWidget(this.bookId,this.bookSlug,e),this.savedPosition?(this.activeContentSlug=this.savedPosition.contentSlug,this.activePosition=this.savedPosition.position,this.widgetService.updatePosition(this.activeContentSlug,this.activePosition)):(this.activeContentSlug="book",this.activePosition=void 0,this.widgetService.updatePosition("book",void 0))}}ngOnDestroy(){this.widgetService.hideWidget()}countTotalSections(){if(!this.rootItem||!this.rootItem.children)return 0;let t=0,e=n=>{t+=n.length,n.forEach(a=>{a.children&&a.children.length>0&&e(a.children)})};return e(this.rootItem.children),t}onNavigate(t){this.activeContentId=t.contentId,this.activeContentSlug=t.contentSlug,this.activePosition=t.position,this.savePosition(),this.widgetService.updatePosition(this.activeContentSlug,this.activePosition),this.showToc=!1,this.widgetService.setTocVisibility(!1)}toggleView(){this.showToc=!this.showToc,this.widgetService.setTocVisibility(this.showToc)}onTopicRequest(t){this.loadingTopics.has(t)||this.sessionTopics[t]||(this.loadingTopics.add(t),this.libraryService.getContentTopics(this.bookId,t).subscribe({next:e=>{this.sessionTopics=B(V({},this.sessionTopics),{[t]:e}),this.loadingTopics.delete(t)},error:e=>{console.error(`Error fetching topics for ${t}:`,e),this.loadingTopics.delete(t),this.sessionTopics=B(V({},this.sessionTopics),{[t]:[]})}}))}isLoadingTopics(t){return this.loadingTopics.has(t)}savePosition(){let t=this.bookSlug||this.bookId;this.storageService.saveLibraryBookPosition(t,{contentSlug:this.activeContentSlug,position:this.activePosition})}getActiveContentTitle(){if(!this.activeContentSlug||this.activeContentSlug==="book")return this.rootItem?.title||"Book";let t=n=>{if(n.urlSlug===this.activeContentSlug)return n;if(n.children)for(let a of n.children){let o=t(a);if(o)return o}return null};return t(this.rootItem)?.title||"Content"}onContentLoaded(){console.log("Content loaded")}onContentDetailsRequest(t){if(this.loadingContentDetails.has(t)||this.contentDetails[t])return;let e="",n=a=>{for(let o of a){if(o.id==t)return e=o.title||"",!0;if(o.children&&o.children.length>0&&n(o.children))return!0}return!1};this.rootItem&&n([this.rootItem]),this.loadingContentDetails.add(t),this.contentDetails[t]={isLoading:!0,title:e},this.libraryService.getContentDetails(this.bookId,t).subscribe({next:a=>{this.contentDetails[t]=B(V({},a),{isLoading:!1,title:e}),this.loadingContentDetails.delete(t)},error:a=>{console.error(`Error fetching content details for ${t}:`,a),this.loadingContentDetails.delete(t),this.contentDetails[t]={isLoading:!1,title:e}}})}getContentDetails(t){return this.contentDetails[t]||{}}isLoadingContentDetails(t){return this.loadingContentDetails.has(t)||this.contentDetails[t]?.isLoading===!0}onActiveInteractionChange(t){t!=this.activePosition&&(this.activePosition=`${t}`,this.widgetService.updatePosition(this.activeContentSlug,this.activePosition),this.savePosition())}static \u0275fac=function(e){return new(e||i)(m(Dt),m(Pt),m(In))};static \u0275cmp=_({type:i,selectors:[["app-library-book-container"]],inputs:{bookId:"bookId",bookSlug:"bookSlug",bookContent:"bookContent",savedPosition:"savedPosition"},standalone:!0,features:[j,x],decls:2,vars:2,consts:[["class","library-book-container",4,"ngIf"],["class","loading",4,"ngIf"],[1,"library-book-container"],["class","toc-view",4,"ngIf"],["class","content-view",4,"ngIf"],[1,"toc-view"],[3,"topicRequest","navigate","bookContent","activeContentSlug","activePosition","sessionTopics","loadingTopics"],[1,"content-view"],[3,"navigate","contentDetailsRequest","activeInteractionChange","bookId","bookContent","activeContentSlug","activePosition","contentDetails"],[1,"loading"]],template:function(e,n){e&1&&v(0,qr,3,2,"div",0)(1,Fr,2,0,"div",1),e&2&&(p("ngIf",n.rootItem),d(),p("ngIf",!n.rootItem))},dependencies:[w,O,Mn,wn],styles:[".library-book-container[_ngcontent-%COMP%]{height:100vh;display:flex;flex-direction:column}.library-book-container[_ngcontent-%COMP%]   .view-toggle[_ngcontent-%COMP%]{padding:var(--space-sm);text-align:right}.library-book-container[_ngcontent-%COMP%]   .view-toggle[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:var(--space-xs) var(--space-sm)}.library-book-container[_ngcontent-%COMP%]   .toc-view[_ngcontent-%COMP%], .library-book-container[_ngcontent-%COMP%]   .content-view[_ngcontent-%COMP%]{flex:1;overflow:auto}.library-book-container[_ngcontent-%COMP%]   .content-view[_ngcontent-%COMP%]   .active-content[_ngcontent-%COMP%]{margin-bottom:var(--space-lg)}.library-book-container[_ngcontent-%COMP%]   .content-view[_ngcontent-%COMP%]   .active-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:var(--space-sm)}.library-book-container[_ngcontent-%COMP%]   .content-view[_ngcontent-%COMP%]   .active-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:var(--space-xs)}.library-book-container[_ngcontent-%COMP%]   .loading[_ngcontent-%COMP%]{font-style:italic;color:var(--color-text-secondary);padding:var(--space-md)}"]})};function zr(i,t){i&1&&(c(0,"div",4)(1,"p"),u(2,"Loading content..."),r()())}function Br(i,t){if(i&1&&(c(0,"div",5),D(1,"markdown",6),r()),i&2){let e=l();d(),p("data",e.markdownContent)}}var wo=class i{constructor(t){this.markdownLoaderService=t}source;markdownContent="";loading=!0;ngOnInit(){this.markdownLoaderService.load(this.source).subscribe({next:t=>{this.markdownContent=t,this.loading=!1},error:t=>{console.error(`Failed to load markdown: ${this.source}`,t),this.loading=!1}})}static \u0275fac=function(e){return new(e||i)(m(Gi))};static \u0275cmp=_({type:i,selectors:[["app-markdown-section"]],inputs:{source:"source"},standalone:!0,features:[x],decls:4,vars:2,consts:[[1,"markdown-section"],[1,"content-container"],["class","loading-state",4,"ngIf"],["class","section-content",4,"ngIf"],[1,"loading-state"],[1,"section-content"],["appExternalLinks","",3,"data"]],template:function(e,n){e&1&&(c(0,"div",0)(1,"div",1),v(2,zr,3,0,"div",2)(3,Br,2,1,"div",3),r()()),e&2&&(d(2),p("ngIf",n.loading),d(),p("ngIf",!n.loading))},dependencies:[w,O,Re,He,Le],styles:['.library-book-content[_ngcontent-%COMP%]{height:100%;overflow:auto;padding:0 2rem}@media (max-width: 767px){.library-book-content[_ngcontent-%COMP%]{padding:0 .5rem}}.library-book-content[_ngcontent-%COMP%]   .content-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto}.library-book-content[_ngcontent-%COMP%]   .content-container[_ngcontent-%COMP%]:before{content:"";position:fixed;top:120px;left:var(--container-left, 0);width:var(--container-width-25, 25vw);height:0;padding-bottom:calc(var(--container-width-25, 25vw) * .75);background-image:url(/images/bg.jpg);background-size:cover;background-position:center;background-repeat:no-repeat;opacity:1;z-index:-1;pointer-events:none}.library-book-content[_ngcontent-%COMP%]   .content-container[_ngcontent-%COMP%]   .end-spacer[_ngcontent-%COMP%]{height:100vh;display:flex;align-items:center;justify-content:center}.library-book-content[_ngcontent-%COMP%]   .content-container[_ngcontent-%COMP%]   .end-spacer[_ngcontent-%COMP%]   .completion-message[_ngcontent-%COMP%]{text-align:center;color:#333}.library-book-content[_ngcontent-%COMP%]   .content-container[_ngcontent-%COMP%]   .end-spacer[_ngcontent-%COMP%]   .completion-message[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:2em;display:block;margin-bottom:1rem}.library-book-content[_ngcontent-%COMP%]   .content-container[_ngcontent-%COMP%]   .end-spacer[_ngcontent-%COMP%]   .completion-message[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 .5rem}.library-book-content[_ngcontent-%COMP%]   .content-container[_ngcontent-%COMP%]   .end-spacer.active[_ngcontent-%COMP%]{background-color:#2c3e50;color:#fff;border-radius:4px}.library-book-content[_ngcontent-%COMP%]   .content-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:500;padding:24px 0 6px;margin-bottom:1rem;color:#ff69;text-align:center;letter-spacing:.2rem;font-family:serif}.library-book-content[_ngcontent-%COMP%]   .content-title[_ngcontent-%COMP%]:first-child{padding-top:36px}.library-book-content[_ngcontent-%COMP%]   .content-title.active[_ngcontent-%COMP%]{color:#ffff66e6}.library-book-content[_ngcontent-%COMP%]   .section[_ngcontent-%COMP%]{margin-top:1rem;padding:1rem;background-color:#333c;border:1px solid #0c0;border-color:#ff63;color:#ff6c;border-radius:8px}.library-book-content[_ngcontent-%COMP%]   .section.active[_ngcontent-%COMP%]{border-color:#ff69}.library-book-content[_ngcontent-%COMP%]   .session-content[_ngcontent-%COMP%]{margin-top:1rem;margin-bottom:2rem;max-width:95vw;overflow-x:hidden;word-wrap:break-word}.library-book-content[_ngcontent-%COMP%]   .session-placeholder[_ngcontent-%COMP%]{height:120px}.loading-state[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:var(--color-text-primary)}']})};var Io=class i{hasPendingChanges=new f;_contentHasChanges=!1;set contentHasChanges(t){this._contentHasChanges=t,this.hasPendingChanges.emit(t)}get contentHasChanges(){return this._contentHasChanges}ngOnInit(){}activeTab=0;book;onContentChanged(t){this.contentHasChanges=t}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=_({type:i,selectors:[["app-book-editor"]],inputs:{book:"book"},outputs:{hasPendingChanges:"hasPendingChanges"},standalone:!0,features:[x],decls:10,vars:4,consts:[[1,"details-header"],[3,"disableTabChange"],["tabTitle","Details"],[3,"book"],["tabTitle","Access"],["tabTitle","Content"],[3,"changed"]],template:function(e,n){e&1&&(c(0,"div",0)(1,"h2"),u(2),r()(),c(3,"app-tab-view",1)(4,"app-tab-item",2),D(5,"app-book-basic-details",3),r(),c(6,"app-tab-item",4),D(7,"app-book-access-details",3),r(),c(8,"app-tab-item",5)(9,"app-book-content",6),g("changed",function(o){return n.onContentChanged(o)}),r()()()),e&2&&(d(2),A(n.book.title||"New Book"),d(),p("disableTabChange",n.contentHasChanges),d(2),p("book",n.book),d(2),p("book",n.book))},dependencies:[Tt,Ne,hn,vn,fn],styles:[".details-header[_ngcontent-%COMP%]{padding:0 1rem;border-bottom:1px solid #ddd}"]})};export{Ne as a,Tt as b,$i as c,Xi as d,ko as e,Qi as f,Io as g,mo as h,In as i,bo as j,wo as k};
