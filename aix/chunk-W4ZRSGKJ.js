import{j as x}from"./chunk-LG2IDCMR.js";import{f as w,g as L}from"./chunk-CLO5EFIQ.js";import{c as I}from"./chunk-FSJAHVRJ.js";import{Ca as m,Da as k,Db as O,Ea as u,Fb as M,Ma as a,Na as y,P as f,Ua as C,V as p,W as v,ea as c,fa as l,la as _,nb as P,oa as g,tb as S,wa as r,xa as i,ya as h}from"./chunk-VGOO44QW.js";function B(n,e){n&1&&(r(0,"div",5)(1,"p"),a(2,"Loading book..."),i()())}function V(n,e){if(n&1){let t=m();r(0,"div",6)(1,"h2"),a(2,"Error"),i(),r(3,"p"),a(4),i(),r(5,"button",7),k("click",function(){p(t);let s=u();return v(s.router.navigate(["/"]))}),a(6,"Return to Home"),i()()}if(n&2){let t=u();c(4),y(t.error)}}function E(n,e){if(n&1){let t=m();r(0,"div",8)(1,"h2"),a(2,"Book Not Found"),i(),r(3,"p"),a(4,"The book you're looking for could not be found."),i(),r(5,"button",7),k("click",function(){p(t);let s=u();return v(s.router.navigate(["/"]))}),a(6,"Return to Home"),i()()}}function R(n,e){if(n&1&&(r(0,"div",9),h(1,"app-library-book-container",10),i()),n&2){let t=u();c(),g("bookId",t.bookId)("bookContent",t.bookContent)("savedPosition",t.savedPosition)("bookSlug",t.bookSlug)}}var b=class n{constructor(e,t,o,s,d){this.route=e;this.router=t;this.libraryService=o;this.layoutService=s;this.storageService=d}bookSlug="";bookId="";bookTitle="";bookNotFound=!1;isLoading=!0;error=null;bookContent=[];savedPosition=null;contentSlug;position;subscriptions=[];ngOnInit(){if(this.layoutService.setLayoutMode("reader"),this.bookSlug=this.route.snapshot.params.slug,this.contentSlug=this.route.snapshot.params.contentSlug,this.position=this.route.snapshot.params.position,!this.bookSlug){this.error="No book specified",this.isLoading=!1;return}if(this.contentSlug){this.storageService.saveLibraryBookPosition(this.bookSlug,{contentSlug:this.contentSlug,position:this.position}),this.router.navigate(["/library/book",this.bookSlug],{replaceUrl:!0});return}this.savedPosition=this.storageService.getLibraryBookPosition(this.bookSlug),this.resolveBookId()}resolveBookId(){let e=this.libraryService.getBookIdFromSlug(this.bookSlug).subscribe({next:t=>{t?(this.bookId=t,this.loadBookContent(t)):(this.bookNotFound=!0,this.isLoading=!1)},error:t=>{console.error("Error resolving book ID:",t),this.error="Failed to load book information",this.isLoading=!1}});this.subscriptions.push(e)}loadBookContent(e){let t=this.libraryService.getBookContent(e).subscribe({next:o=>{this.bookContent=o,this.bookTitle=o.title,this.isLoading=!1},error:o=>{console.error("Error loading book content structure:",o),this.error="Failed to load book structure",this.isLoading=!1}});this.subscriptions.push(t)}countTotalSections(e){let t=0,o=s=>{t+=s.length,s.forEach(d=>{d.children&&d.children.length>0&&o(d.children)})};return o(e),t}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}static \u0275fac=function(t){return new(t||n)(l(O),l(M),l(L),l(w),l(I))};static \u0275cmp=f({type:n,selectors:[["app-library-book-viewer"]],standalone:!0,features:[C],decls:5,vars:4,consts:[[1,"library-book-viewer"],["class","loading-state",4,"ngIf"],["class","error-state",4,"ngIf"],["class","not-found-state",4,"ngIf"],["class","book-content",4,"ngIf"],[1,"loading-state"],[1,"error-state"],[3,"click"],[1,"not-found-state"],[1,"book-content"],[3,"bookId","bookContent","savedPosition","bookSlug"]],template:function(t,o){t&1&&(r(0,"div",0),_(1,B,3,0,"div",1)(2,V,7,1,"div",2)(3,E,7,0,"div",3)(4,R,2,4,"div",4),i()),t&2&&(c(),g("ngIf",o.isLoading),c(),g("ngIf",!o.isLoading&&o.error),c(),g("ngIf",!o.isLoading&&o.bookNotFound),c(),g("ngIf",!o.isLoading&&!o.error&&!o.bookNotFound))},dependencies:[S,P,x],styles:[".library-book-viewer[_ngcontent-%COMP%]{height:100%}.library-book-viewer[_ngcontent-%COMP%]   .loading-state[_ngcontent-%COMP%], .library-book-viewer[_ngcontent-%COMP%]   .error-state[_ngcontent-%COMP%], .library-book-viewer[_ngcontent-%COMP%]   .not-found-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%}.library-book-viewer[_ngcontent-%COMP%]   .loading-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .library-book-viewer[_ngcontent-%COMP%]   .error-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .library-book-viewer[_ngcontent-%COMP%]   .not-found-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:var(--space-md)}.library-book-viewer[_ngcontent-%COMP%]   .loading-state[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .library-book-viewer[_ngcontent-%COMP%]   .error-state[_ngcontent-%COMP%]   button[_ngcontent-%COMP%], .library-book-viewer[_ngcontent-%COMP%]   .not-found-state[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:var(--space-md);padding:var(--space-sm) var(--space-md);background-color:var(--color-primary);color:#fff;border:none;border-radius:var(--border-radius-sm);cursor:pointer}.library-book-viewer[_ngcontent-%COMP%]   .loading-state[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover, .library-book-viewer[_ngcontent-%COMP%]   .error-state[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover, .library-book-viewer[_ngcontent-%COMP%]   .not-found-state[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:var(--color-primary-dark)}.library-book-viewer[_ngcontent-%COMP%]   .book-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-bottom:var(--space-md)}.library-book-viewer[_ngcontent-%COMP%]   .book-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:var(--space-sm)}"]})};var G=[{path:"book/:slug",component:b},{path:"book/:slug/:contentSlug",component:b},{path:"book/:slug/:contentSlug/:position",component:b}];export{G as LIBRARY_ROUTES,b as LibraryBookViewerPage};
