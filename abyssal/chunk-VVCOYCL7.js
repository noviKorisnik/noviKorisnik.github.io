import{a as de,c as pe,d as me}from"./chunk-MEAPZKQF.js";import{$ as l,B as j,C as h,G as v,K as ie,L as ae,M as k,N as w,P as I,Q as S,R as y,S as p,T as m,U as G,V as u,W as g,X as V,Y as E,Z as P,_ as re,a as te,aa as se,b as ne,ba as x,ca as A,da as d,ea as _,ga as oe,ka as H,r as M,s as O,sa as le,ta as C,w as $,z as i,za as ce}from"./chunk-RXOD2E4I.js";var q=class{ws=null;gameId;userId;constructor(e,t){this.gameId=e,this.userId=t}connect(e,t,n){this.ws=new WebSocket(de.wsBaseUrl),this.ws.onopen=()=>{this.send({type:"join",gameId:this.gameId,userId:this.userId}),t&&t()},this.ws.onmessage=o=>{try{let c=JSON.parse(o.data);e(c)}catch{}},this.ws.onclose=()=>{n&&n()}}send(e){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify(e))}close(){this.ws&&this.ws.close()}};var U=class r{timerState;color="#3399ff";label="Time Left";isUserTurn=!1;currentTime=0;totalTimeCached=0;countdownInterval=null;countdownStartTime=0;initialTime=0;ngOnChanges(e){if(e.timerState&&this.timerState){let t=Math.floor(this.timerState.remaining);this.totalTimeCached=this.timerState.total,this.startCountdown(t)}}ngOnDestroy(){this.clearCountdownInterval()}startCountdown(e){let t=Math.floor(Math.max(0,e));this.currentTime=t,this.initialTime=t,this.countdownStartTime=Date.now(),this.clearCountdownInterval(),this.currentTime>0&&(this.countdownInterval=setInterval(()=>{let n=(Date.now()-this.countdownStartTime)/1e3;this.currentTime=Math.max(0,this.initialTime-n),this.currentTime<=0&&(this.currentTime=0,this.clearCountdownInterval())},20))}clearCountdownInterval(){this.countdownInterval&&(clearInterval(this.countdownInterval),this.countdownInterval=null)}get progressPercentage(){if(this.totalTimeCached<=0)return 0;let e=this.totalTimeCached-this.currentTime;return 100-Math.max(0,Math.min(100,e/this.totalTimeCached*100))}get timeDisplay(){return`${Math.floor(this.currentTime)}`}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=h({type:r,selectors:[["app-timer-bar"]],inputs:{timerState:"timerState",color:"color",label:"label",isUserTurn:"isUserTurn"},features:[$],decls:8,vars:8,consts:[[1,"timer-bar"],[1,"timer-header"],[1,"timer-label"],[1,"timer-display"],[1,"timer-track"],[1,"timer-progress"]],template:function(t,n){t&1&&(u(0,"div",0)(1,"div",1)(2,"div",2),d(3),g(),u(4,"div",3),d(5),g()(),u(6,"div",4),V(7,"div",5),g()()),t&2&&(i(3),_(n.label),i(),x("user-turn",n.isUserTurn),i(),_(n.timeDisplay),i(2),se("width",n.progressPercentage,"%")("background-color",n.color))},dependencies:[C],styles:[".timer-bar[_ngcontent-%COMP%]{margin:.5rem 0}@media (max-width: 480px){.timer-bar[_ngcontent-%COMP%]{margin:.4rem 0}}.timer-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:.25rem}.timer-label[_ngcontent-%COMP%]{font-size:.9rem;font-weight:500;color:#ffffffe6;text-shadow:0 1px 2px rgba(0,0,0,.5)}@media (max-width: 480px){.timer-label[_ngcontent-%COMP%]{font-size:.8rem}}.timer-display[_ngcontent-%COMP%]{font-size:.9rem;font-weight:600;color:#fffffff2;text-shadow:0 1px 2px rgba(0,0,0,.5);min-width:2rem;text-align:right}@media (max-width: 480px){.timer-display[_ngcontent-%COMP%]{font-size:.8rem;min-width:1.5rem}}.timer-display.user-turn[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_pulse-brightness 2s ease-in-out infinite}@keyframes _ngcontent-%COMP%_pulse-brightness{0%,to{filter:brightness(1)}50%{filter:brightness(1.8)}}.timer-track[_ngcontent-%COMP%]{width:100%;height:8px;background-color:#ffffff4d;border-radius:4px;border:1px solid rgba(0,0,0,.2);overflow:hidden;position:relative}.timer-progress[_ngcontent-%COMP%]{height:100%;border-radius:3px;transition:width .1s linear;background-color:#39f;margin-left:auto}"]})};var ue=(r,e)=>e.userId;function ge(r,e){if(r&1&&(p(0,"li"),G(1,"div"),p(2,"div",6)(3,"span",7),d(4),m()()()),r&2){let t=e.$implicit,n=e.$index,o=l();x("disconnected",!t.connected)("is-current-user",o.isCurrentPlayer(t.userId)),i(),A(H("player-disc player-",n%4)),i(3),_(t.playerName||t.userId)}}function fe(r,e){if(r&1&&G(0,"app-timer-bar",2),r&2){let t=l();y("timerState",t.timerState)}}var W=class r{state;currentUserId;quickStart=new v;leave=new v;timerState={total:0,remaining:0};ngOnChanges(e){e.state&&this.state?.ready&&(this.timerState={total:this.totalWaitTimeSeconds,remaining:this.countdownSeconds})}get countdownSeconds(){return this.state?.ready?.countdownTimer?Math.floor(this.state.ready.countdownTimer/1e3):0}get totalWaitTimeSeconds(){return this.state?.ready?.waitTime?Math.floor(this.state.ready.waitTime/1e3):0}isCurrentPlayer(e){return e===this.currentUserId}trackUserId(e,t){return t.userId}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=h({type:r,selectors:[["app-game-ready"]],inputs:{state:"state",currentUserId:"currentUserId"},outputs:{quickStart:"quickStart",leave:"leave"},features:[$],decls:12,vars:2,consts:[[1,"lobby"],[3,"disconnected","is-current-user"],["color","#3399ff","label","Starting",3,"timerState"],[1,"button-container"],[3,"click","disabled"],[3,"click"],[1,"player-info"],[1,"player-name"]],template:function(t,n){t&1&&(p(0,"div",0)(1,"h2"),d(2,"ABYSSAL"),m(),p(3,"ul"),I(4,ge,5,8,"li",1,ue),m(),k(6,fe,1,1,"app-timer-bar",2),p(7,"div",3)(8,"button",4),P("click",function(){return n.quickStart.emit()}),d(9,"Quick Start"),m(),p(10,"button",5),P("click",function(){return n.leave.emit()}),d(11,"Leave Room"),m()()()),t&2&&(i(4),S(n.state==null?null:n.state.players),i(2),w(n.state!=null&&n.state.ready&&n.countdownSeconds>0?6:-1),i(2),y("disabled",!(!(n.state==null||n.state.ready==null)&&n.state.ready.quickStartEnabled)))},dependencies:[C,U],styles:[".lobby[_ngcontent-%COMP%]{padding:1rem;background:linear-gradient(0deg,#7575f0,#3030e8,#1212a1,#0d0d73,#080845);border-radius:8px;max-width:320px;margin:2rem auto}@media (max-width: 480px){.lobby[_ngcontent-%COMP%]{padding:.75rem;margin:1rem auto}}.lobby[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:0;text-align:center;font-style:oblique;letter-spacing:1.5rem;text-indent:1.5rem;color:#fffffff2;text-shadow:0 1px 3px rgba(0,0,0,.5);font-weight:400}.lobby[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#ffffffe6;text-shadow:0 1px 2px rgba(0,0,0,.5);margin-top:1rem;margin-bottom:.75rem;font-size:1rem}.lobby[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:.75rem;margin:0}@media (max-width: 400px){.lobby[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr);gap:.5rem}}.lobby[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.4rem .6rem;background:#00000040;border-radius:6px;border:2px solid transparent;margin-bottom:0;transition:opacity .3s ease}@media (max-width: 400px){.lobby[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:.35rem .5rem;gap:.35rem}}.lobby[_ngcontent-%COMP%]   li.is-current-user[_ngcontent-%COMP%]{border:2px solid rgba(255,255,255,.6);background:#00000059}.lobby[_ngcontent-%COMP%]   li.disconnected[_ngcontent-%COMP%]{opacity:.3}.lobby[_ngcontent-%COMP%]   li.disconnected[_ngcontent-%COMP%]   .player-disc[_ngcontent-%COMP%]{box-shadow:none}.player-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1}.player-name[_ngcontent-%COMP%]{font-size:.95rem;font-weight:500;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.7)}@media (max-width: 480px){.player-name[_ngcontent-%COMP%]{font-size:.85rem}}.button-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:1rem;gap:.5rem}.lobby[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.6rem 1.2rem;background:#ffffff26;border:2px solid rgba(255,255,255,.4);color:#fff;font-weight:500;border-radius:6px;cursor:pointer;text-shadow:0 1px 2px rgba(0,0,0,.5);transition:all .2s ease;margin:0}.lobby[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover:not(:disabled){background:#ffffff40;border-color:#fff9}.lobby[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.player-disc[_ngcontent-%COMP%]{width:16px;height:16px;border-radius:50%;box-shadow:0 0 0 3px #ffffff4d;transition:all .3s ease}@media (max-width: 400px){.player-disc[_ngcontent-%COMP%]{width:14px;height:14px}}.player-0[_ngcontent-%COMP%]{background:#d926b5}.player-1[_ngcontent-%COMP%]{background:#d96e26}.player-2[_ngcontent-%COMP%]{background:#6ed926}.player-3[_ngcontent-%COMP%]{background:#26d9b5}"]})};var he=(r,e)=>e.userId;function Ce(r,e){if(r&1&&(u(0,"div",2)(1,"div",3),V(2,"div"),g(),u(3,"div",4)(4,"span",5),d(5),g()()()),r&2){let t=e.$implicit,n=l();x("is-current-user",n.isCurrentPlayer(t.userId)),ie("data-status",t.status)("data-player",t.colorIndex),i(2),A(H("status-disc player-",t.colorIndex)),i(3),_(t.playerName)}}var Y=class r{state;currentUserId;get playerStatuses(){return this.state?.players?this.state.players.map((e,t)=>{let n=this.state?.active?.currentPlayerId===e.userId,o=!e.connected,c=this.isPlayerDone(e.userId),a;return o?a="disconnected":c?a="done":n?a="on-turn":a="in-game",{userId:e.userId,playerName:e.playerName||e.userId,status:a,colorIndex:t}}):[]}isPlayerDone(e){let t=this.state?.boardLayout?.playerLayers?.find(n=>n.playerId===e);return t?!t.active:!1}isCurrentPlayer(e){return e===this.currentUserId}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=h({type:r,selectors:[["app-player-status"]],inputs:{state:"state",currentUserId:"currentUserId"},decls:3,vars:0,consts:[[1,"player-status-panel"],[1,"player-status-item",3,"is-current-user"],[1,"player-status-item"],[1,"status-indicator"],[1,"player-info"],[1,"player-name"]],template:function(t,n){t&1&&(u(0,"div",0),I(1,Ce,6,8,"div",1,he),g()),t&2&&(i(),S(n.playerStatuses))},dependencies:[C],styles:[".player-status-panel[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:.75rem;margin:1rem 0;padding:.75rem;background:#ffffff1a;border-radius:8px}@media (max-width: 400px){.player-status-panel[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr);gap:.5rem;padding:.5rem;margin:.5rem 0}}.player-status-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;padding:.4rem .6rem;background:#00000040;border-radius:6px;border:2px solid transparent;transition:all .3s ease}@media (max-width: 400px){.player-status-item[_ngcontent-%COMP%]{padding:.35rem .5rem;gap:.35rem}}.player-status-item[data-status=in-game][_ngcontent-%COMP%]   .status-disc[_ngcontent-%COMP%]{box-shadow:0 0 0 3px #ffffff4d}.player-status-item[data-status=on-turn][_ngcontent-%COMP%]{background:#00000073}.player-status-item[data-status=on-turn][_ngcontent-%COMP%]   .status-disc[_ngcontent-%COMP%]{box-shadow:0 0 0 3px #ffffffe6,0 0 16px 3px currentColor}.player-status-item[data-status=done][_ngcontent-%COMP%]{opacity:.6}.player-status-item[data-status=done][_ngcontent-%COMP%]   .status-disc[_ngcontent-%COMP%]{background:transparent!important;border:3px solid currentColor;box-shadow:none}.player-status-item[data-status=done][_ngcontent-%COMP%]   .player-name[_ngcontent-%COMP%]{text-decoration:line-through;opacity:.7}.player-status-item[data-status=disconnected][_ngcontent-%COMP%]{opacity:.3}.player-status-item[data-status=disconnected][_ngcontent-%COMP%]   .status-disc[_ngcontent-%COMP%]{box-shadow:none}.player-status-item[data-status=disconnected][_ngcontent-%COMP%]   .player-name[_ngcontent-%COMP%]{font-style:italic}.player-status-item.is-current-user[_ngcontent-%COMP%]{border:2px solid rgba(255,255,255,.6);background:#00000059}.player-status-item.is-current-user[data-status=on-turn][_ngcontent-%COMP%]{background:#00000080}.status-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.status-disc[_ngcontent-%COMP%]{width:16px;height:16px;border-radius:50%;transition:all .3s ease}@media (max-width: 400px){.status-disc[_ngcontent-%COMP%]{width:14px;height:14px}}.player-0[_ngcontent-%COMP%]{background:#d926b5;color:#d926b5}.player-1[_ngcontent-%COMP%]{background:#d96e26;color:#d96e26}.player-2[_ngcontent-%COMP%]{background:#6ed926;color:#6ed926}.player-3[_ngcontent-%COMP%]{background:#26d9b5;color:#26d9b5}.player-info[_ngcontent-%COMP%]{display:flex;flex-direction:column}.player-name[_ngcontent-%COMP%]{font-size:.95rem;font-weight:500;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.7);transition:all .3s ease}@media (max-width: 480px){.player-name[_ngcontent-%COMP%]{font-size:.85rem}}"]})};function be(r,e){if(r&1){let t=E();p(0,"div",2)(1,"div",3),P("click",function(){let o=M(t).$index,c=l().$implicit,a=l();return O(a.onCellClick(o,a.board.indexOf(c)))}),G(2,"div")(3,"div"),m()()}if(r&2){let t=e.$index,n=l().$implicit,o=l();i(),y("ngClass",o.getCellClasses(t,o.board.indexOf(n)))}}function ye(r,e){if(r&1&&(p(0,"div",1),I(1,be,4,1,"div",2,ae().trackByIndex,!0),m()),r&2){let t=e.$implicit;i(),S(t)}}var J=class r{board;getCellClasses;isInteractive=!1;showYourTurnIndicator=!1;cellClick=new v;onCellClick(e,t){this.isInteractive&&this.cellClick.emit({x:e,y:t})}trackByIndex(e){return e}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=h({type:r,selectors:[["app-board"]],inputs:{board:"board",getCellClasses:"getCellClasses",isInteractive:"isInteractive",showYourTurnIndicator:"showYourTurnIndicator"},outputs:{cellClick:"cellClick"},decls:3,vars:2,consts:[[1,"board"],[1,"row"],[1,"cell-wrapper"],[3,"click","ngClass"]],template:function(t,n){t&1&&(p(0,"div",0),I(1,ye,3,0,"div",1,n.trackByIndex,!0),m()),t&2&&(x("your-turn",n.showYourTurnIndicator),i(),S(n.board))},dependencies:[C,le],styles:['.board[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2px;margin:1rem auto;width:fit-content;background:linear-gradient(180deg,#7575f0,#3030e8,#1212a1,#0d0d73,#080845);border-radius:8px;padding:8px;border:3px solid transparent;transition:all .3s ease}@media (max-width: 480px){.board[_ngcontent-%COMP%]{margin:.5rem auto;padding:6px;gap:1px}}.board.your-turn[_ngcontent-%COMP%]{border:3px solid rgba(255,255,255,.6);box-shadow:0 0 0 3px #fff3,0 0 20px #ffffff4d;animation:_ngcontent-%COMP%_board-pulse 2s ease-in-out infinite}@keyframes _ngcontent-%COMP%_board-pulse{0%,to{box-shadow:0 0 0 3px #fff3,0 0 20px #ffffff4d}50%{box-shadow:0 0 0 3px #fff6,0 0 25px #ffffff80}}.row[_ngcontent-%COMP%]{display:flex;gap:2px}.cell-wrapper[_ngcontent-%COMP%]{width:32px;height:32px}.cell[_ngcontent-%COMP%]{width:100%;height:100%;background:transparent;border:1px solid rgba(255,255,255,.25);position:relative;cursor:default;transition:background .2s,border .2s}.cell-exploding[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_cell-explode 1s ease-out forwards}@keyframes _ngcontent-%COMP%_cell-explode{0%{background:#fff3}15%{background:#fff;border-color:#fff;box-shadow:0 0 20px #fffc,0 0 40px #fff6}to{background:#fff3;border-color:#ffffff40;box-shadow:none}}.cell[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0;pointer-events:none}.cell[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:nth-child(2){z-index:1}.cell.active[_ngcontent-%COMP%]:not(.cell-picked){cursor:pointer}.cell-picked[_ngcontent-%COMP%], .cell-player-picked[_ngcontent-%COMP%]{background:#fff3}.cell-player-disc[_ngcontent-%COMP%], .cell-player-3-hit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1):after, .cell-player-3-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1):after, .cell-player-2-hit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1):before, .cell-player-2-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1):before, .cell-player-1-hit[_ngcontent-%COMP%]:after, .cell-player-1-sunk[_ngcontent-%COMP%]:after, .cell-player-0-hit[_ngcontent-%COMP%]:before, .cell-player-0-sunk[_ngcontent-%COMP%]:before{content:"";position:absolute;width:6px;height:6px;border-radius:50%;z-index:2}.cell-player-0-hit[_ngcontent-%COMP%]:before, .cell-player-0-sunk[_ngcontent-%COMP%]:before{top:3px;left:3px;border:1px solid hsl(312,70%,50%);background:transparent}.cell-player-0-sunk[_ngcontent-%COMP%]:before{background:#d926b5}.cell-player-1-hit[_ngcontent-%COMP%]:after, .cell-player-1-sunk[_ngcontent-%COMP%]:after{top:3px;right:3px;border:1px solid hsl(24,70%,50%);background:transparent}.cell-player-1-sunk[_ngcontent-%COMP%]:after{background:#d96e26}.cell-player-2-hit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1):before, .cell-player-2-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1):before{bottom:3px;left:3px;border:1px solid hsl(96,70%,50%);background:transparent}.cell-player-2-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1):before{background:#6ed926}.cell-player-3-hit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1):after, .cell-player-3-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1):after{bottom:3px;right:3px;border:1px solid hsl(168,70%,50%);background:transparent}.cell-player-3-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1):after{background:#26d9b5}.cell-setup-disc[_ngcontent-%COMP%], .cell-setup-player-3-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before, .cell-setup-player-3-hit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before, .cell-setup-player-3-open[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before, .cell-setup-player-2-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before, .cell-setup-player-2-hit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before, .cell-setup-player-2-open[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before, .cell-setup-player-1-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before, .cell-setup-player-1-hit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before, .cell-setup-player-1-open[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before, .cell-setup-player-0-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before, .cell-setup-player-0-hit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before, .cell-setup-player-0-open[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{content:"";position:absolute;width:20px;height:20px;border-radius:50%;top:50%;left:50%;transform:translate(-50%,-50%);z-index:1;border:none;box-shadow:none}.cell-setup-player-0-open[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{background:#d926b5;opacity:.5}.cell-setup-player-0-hit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{background:#d926b5;opacity:.7}.cell-setup-player-0-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{background:#981b7f;opacity:1}.cell-setup-player-1-open[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{background:#d96e26;opacity:.5}.cell-setup-player-1-hit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{background:#d96e26;opacity:.7}.cell-setup-player-1-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{background:#984d1b;opacity:1}.cell-setup-player-2-open[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{background:#6ed926;opacity:.5}.cell-setup-player-2-hit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{background:#6ed926;opacity:.7}.cell-setup-player-2-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{background:#4d981b;opacity:1}.cell-setup-player-3-open[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{background:#26d9b5;opacity:.5}.cell-setup-player-3-hit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{background:#26d9b5;opacity:.7}.cell-setup-player-3-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{background:#1b987f;opacity:1}']})};function _e(r,e){if(r&1){let t=E();G(0,"app-player-status",1)(1,"app-timer-bar",2),p(2,"app-board",3),P("cellClick",function(o){M(t);let c=l();return O(c.pickCell.emit(o))}),m()}if(r&2){let t=l();y("state",t.state)("currentUserId",t.setup.userId),i(),y("timerState",t.timerState)("color",t.currentPlayerColor)("label",t.getCurrentPlayerName())("isUserTurn",t.isPlayerTurn),i(),y("board",t.board)("getCellClasses",t.getCellClassesBound)("isInteractive",t.isPlayerTurn)("showYourTurnIndicator",t.isPlayerTurn)}}var Q=class r{state;setup;pickCell=new v;playerSetupCells=new Set;explodingCells=new Set;lastHistoryLength=0;timerState={total:0,remaining:0};getCellClassesBound=(e,t)=>this.getCellClasses(e,t);ngOnChanges(e){if(this.playerSetupCells.clear(),this.setup?.setup?.board)for(let t of this.setup.setup.board)for(let n of t)n.shipId&&this.playerSetupCells.add(`${n.row},${n.col}`);if(e.state&&this.state?.active&&(this.timerState={total:this.turnTimeLimitSeconds,remaining:this.remainingTurnTimeSeconds}),this.state?.history){let t=this.state.history.length;if(t>this.lastHistoryLength){let n=this.state.history[t-1];if(n?.cell){let o=`${n.cell.x},${n.cell.y}`;this.explodingCells.add(o),setTimeout(()=>{this.explodingCells.delete(o)},1e3)}}this.lastHistoryLength=t}}get board(){return this.state?.boardLayout?.baseBoard||[]}get playerLayers(){return this.state?.boardLayout?.playerLayers||[]}getCellClasses(e,t){let n=["cell"],o=`${e},${t}`;this.explodingCells.has(o)&&n.push("cell-exploding");let c=this.playerSetupCells.has(`${t},${e}`);if(c){let s=(this.state?.players||[]).findIndex(f=>f.userId===this.setup?.userId);if(s!==-1){let f=this.getSetupCellState(e,t);n.push(`cell-setup-player-${s}-${f}`)}}return this.board?.[t]?.[e]===1&&n.push("cell-picked"),c&&n.includes("cell-picked")&&n.push("cell-player-picked"),this.isPlayerTurn&&!n.includes("cell-picked")&&n.push("active"),this.playerLayers.forEach((a,s)=>{if(a.revealedBoard[t]?.[e]===1){let f=!1;for(let D of a.sunkShips)if(D.cells.some(T=>T.x===e&&T.y===t)){f=!0;break}f?n.push(`cell-player-${s}-sunk`):n.push(`cell-player-${s}-hit`)}}),n}getSetupCellState(e,t){if(!(this.board?.[t]?.[e]===1))return"open";if(this.setup?.setup?.board){let o=this.setup.setup.board[t]?.[e];if(o?.shipId){let c=[];for(let s=0;s<this.setup.setup.board.length;s++)for(let f=0;f<this.setup.setup.board[s].length;f++)this.setup.setup.board[s][f]?.shipId===o.shipId&&c.push({x:f,y:s});return c.every(s=>this.board?.[s.y]?.[s.x]===1)?"sunk":"hit"}}return"hit"}getCellHits(e,t){let n=[];for(let o of this.playerLayers)if(o.revealedBoard[t]?.[e]===1){let c=!1;for(let a of o.sunkShips)if(a.cells.some(s=>s.x===e&&s.y===t)){c=!0;break}n.push({playerId:o.playerId,sunk:c})}return n}getPlayerColorClass(e){return`player-${this.playerLayers.findIndex(n=>n.playerId===e)}`}get currentPlayerColor(){if(!this.state?.active?.currentPlayerId)return"#3399ff";let t=(this.state?.players||[]).findIndex(o=>o.userId===this.state?.active?.currentPlayerId),n=["hsl(312, 70%, 50%)","hsl(24, 70%, 50%)","hsl(96, 70%, 50%)","hsl(168, 70%, 50%)"];return n[t%n.length]||"#3399ff"}get isPlayerTurn(){return!!this.state?.active&&this.state.active.currentPlayerId===this.setup?.userId}getCurrentPlayerName(){if(!this.state?.active?.currentPlayerId)return"Unknown";let e=this.state.players?.find(o=>o.userId===this.state?.active?.currentPlayerId),t=e?.playerName||e?.userId||"Unknown";return(this.state?.active?.remainingTurnTime||0)===0?`WINNER: ${t}`:t}get turnTimeLimitSeconds(){let e=this.state?.active?.turnTimeLimit||15e3;return Math.floor(e/1e3)}get remainingTurnTimeSeconds(){let e=this.state?.active?.remainingTurnTime||0;return Math.floor(e/1e3)}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=h({type:r,selectors:[["app-game-active"]],inputs:{state:"state",setup:"setup"},outputs:{pickCell:"pickCell"},features:[$],decls:4,vars:1,consts:[[1,"active-game"],[3,"state","currentUserId"],[3,"timerState","color","label","isUserTurn"],[3,"cellClick","board","getCellClasses","isInteractive","showYourTurnIndicator"]],template:function(t,n){t&1&&(p(0,"div",0)(1,"h2"),d(2,"ABYSSAL"),m(),k(3,_e,3,10),m()),t&2&&(i(3),w(n.state!=null&&n.state.active?3:-1))},dependencies:[C,U,Y,J],styles:['.cell[_ngcontent-%COMP%]{position:relative}.cell[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;top:0;left:0;pointer-events:none}.cell[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]:nth-child(2){z-index:1}.cell-player-disc[_ngcontent-%COMP%], .cell-player-3-hit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:after, .cell-player-3-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:after, .cell-player-2-hit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:before, .cell-player-2-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:before, .cell-player-1-hit[_ngcontent-%COMP%]:after, .cell-player-1-sunk[_ngcontent-%COMP%]:after, .cell-player-0-hit[_ngcontent-%COMP%]:before, .cell-player-0-sunk[_ngcontent-%COMP%]:before{content:"";position:absolute;width:6px;height:6px;border-radius:50%;z-index:2}.cell-player-disc-sunk[_ngcontent-%COMP%], .cell-player-3-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:after, .cell-player-2-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:before, .cell-player-1-sunk[_ngcontent-%COMP%]:after, .cell-player-0-sunk[_ngcontent-%COMP%]:before{box-shadow:0 0 0 1px #fff}.cell-player-0-hit[_ngcontent-%COMP%]:before, .cell-player-0-sunk[_ngcontent-%COMP%]:before{top:3px;left:3px;border:1px solid hsl(312,70%,50%);background:transparent}.cell-player-0-sunk[_ngcontent-%COMP%]:before{background:#d926b5}.cell-player-1-hit[_ngcontent-%COMP%]:after, .cell-player-1-sunk[_ngcontent-%COMP%]:after{top:3px;right:3px;border:1px solid hsl(24,70%,50%);background:transparent}.cell-player-1-sunk[_ngcontent-%COMP%]:after{background:#d96e26}.cell-player-2-hit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:before, .cell-player-2-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:before{bottom:3px;left:3px;border:1px solid hsl(96,70%,50%);background:transparent}.cell-player-2-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:before{background:#6ed926}.cell-player-3-hit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:after, .cell-player-3-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:after{bottom:3px;right:3px;border:1px solid hsl(168,70%,50%);background:transparent}.cell-player-3-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:after{background:#26d9b5}.cell-setup-disc[_ngcontent-%COMP%], .cell-setup-player-3-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before, .cell-setup-player-3-hit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before, .cell-setup-player-3-open[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before, .cell-setup-player-2-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before, .cell-setup-player-2-hit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before, .cell-setup-player-2-open[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before, .cell-setup-player-1-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before, .cell-setup-player-1-hit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before, .cell-setup-player-1-open[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before, .cell-setup-player-0-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before, .cell-setup-player-0-hit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before, .cell-setup-player-0-open[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{content:"";position:absolute;width:20px;height:20px;border-radius:50%;top:50%;left:50%;transform:translate(-50%,-50%);z-index:1}.cell-setup-player-0-open[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{background:#d926b5;opacity:.5}.cell-setup-player-0-hit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{background:#d926b5;opacity:.7}.cell-setup-player-0-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{background:#981b7f;opacity:1}.cell-setup-player-1-open[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{background:#d96e26;opacity:.5}.cell-setup-player-1-hit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{background:#d96e26;opacity:.7}.cell-setup-player-1-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{background:#984d1b;opacity:1}.cell-setup-player-2-open[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{background:#6ed926;opacity:.5}.cell-setup-player-2-hit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{background:#6ed926;opacity:.7}.cell-setup-player-2-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{background:#4d981b;opacity:1}.cell-setup-player-3-open[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{background:#26d9b5;opacity:.5}.cell-setup-player-3-hit[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{background:#26d9b5;opacity:.7}.cell-setup-player-3-sunk[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2):before{background:#1b987f;opacity:1}.active-game[_ngcontent-%COMP%]{padding:1rem;background:linear-gradient(0deg,#7575f0,#3030e8,#1212a1,#0d0d73,#080845);border-radius:8px;max-width:320px;margin:2rem auto}@media (max-width: 480px){.active-game[_ngcontent-%COMP%]{padding:.75rem;margin:1rem auto}}.active-game[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:0;text-align:center;letter-spacing:1.5rem;font-style:oblique;text-indent:1.5rem;font-weight:400}.active-game[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:1rem}']})};var Pe=(r,e)=>e.userId;function xe(r,e){r&1&&d(0," You are the last ship standing! ")}function Me(r,e){if(r&1&&d(0),r&2){let t=l();oe(" You finished ",t.currentPlayerRank,"",t.getRankSuffix(t.currentPlayerRank)," ")}}function Oe(r,e){if(r&1&&(u(0,"li")(1,"span",11)(2,"span",12),d(3),g(),u(4,"span",13),d(5),g()(),u(6,"span",14),d(7),g()()),r&2){let t=e.$implicit,n=l();x("is-current-user",t.isCurrentUser),i(3),_(n.getRankEmoji(t.rank)),i(2),oe("",t.rank,"",n.getRankSuffix(t.rank)),i(2),_(t.playerName)}}var K=class r{state;currentUserId;newGame=new v;home=new v;get winnerId(){return this.state?.done?.winnerId||""}get isWinner(){return this.winnerId===this.currentUserId}get winnerName(){let e=this.state?.players.find(t=>t.userId===this.winnerId);return e?.playerName||e?.userId||"Unknown"}get currentPlayerRank(){return this.state?.done?.placements.find(t=>t.userId===this.currentUserId)?.rank||0}get sortedPlacements(){return this.state?.done?.placements?this.state.done.placements.slice().sort((e,t)=>e.rank-t.rank).map(e=>{let t=this.state?.players.find(n=>n.userId===e.userId);return{userId:e.userId,playerName:t?.playerName||t?.userId||"Unknown",rank:e.rank,isCurrentUser:e.userId===this.currentUserId}}):[]}getRankSuffix(e){return e===1?"st":e===2?"nd":e===3?"rd":"th"}getRankEmoji(e){return e===1?"\u{1F3C6}":e===2?"\u{1F948}":e===3?"\u{1F949}":"\u{1F480}"}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=h({type:r,selectors:[["app-game-done"]],inputs:{state:"state",currentUserId:"currentUserId"},outputs:{newGame:"newGame",home:"home"},decls:20,vars:7,consts:[[1,"done-game"],[1,"result-banner"],[1,"result-emoji"],[1,"result-title"],[1,"result-subtitle"],[1,"rankings"],[1,"rankings-list"],[3,"is-current-user"],[1,"button-container"],[1,"secondary-btn",3,"click"],[1,"primary-btn",3,"click"],[1,"rank-badge"],[1,"rank-emoji"],[1,"rank-number"],[1,"player-name"]],template:function(t,n){t&1&&(u(0,"div",0)(1,"h2"),d(2,"ABYSSAL"),g(),u(3,"div",1)(4,"div",2),d(5),g(),u(6,"div",3),d(7),g(),u(8,"div",4),k(9,xe,1,0)(10,Me,1,2),g()(),u(11,"div",5)(12,"ul",6),I(13,Oe,8,6,"li",7,Pe),g()(),u(15,"div",8)(16,"button",9),re("click",function(){return n.home.emit()}),d(17,"Home"),g(),u(18,"button",10),re("click",function(){return n.newGame.emit()}),d(19,"New Game"),g()()()),t&2&&(i(3),x("victory",n.isWinner)("defeat",!n.isWinner),i(2),_(n.isWinner?"\u{1F3C6}":"\u{1F480}"),i(2),_(n.isWinner?"Victory!":"Defeated"),i(2),w(n.isWinner?9:10),i(4),S(n.sortedPlacements))},dependencies:[C],styles:[".done-game[_ngcontent-%COMP%]{padding:.75rem;background:linear-gradient(0deg,#7575f0,#3030e8,#1212a1,#0d0d73,#080845);border-radius:8px;max-width:320px;margin:1rem auto}@media (max-width: 480px){.done-game[_ngcontent-%COMP%]{padding:.5rem;margin:.75rem auto}}h2[_ngcontent-%COMP%]{margin-top:0;text-align:center;letter-spacing:1.5rem;color:#fffffff2;text-shadow:0 1px 3px rgba(0,0,0,.5);margin-bottom:.75rem;font-style:oblique;text-indent:1.5rem;font-weight:400}.result-banner[_ngcontent-%COMP%]{text-align:center;padding:1rem .75rem;margin:.5rem 0;border-radius:8px;background:#0000004d;border:3px solid transparent}.result-banner.victory[_ngcontent-%COMP%]{border-color:#26d9b5;box-shadow:0 0 20px #26d9b580;animation:_ngcontent-%COMP%_victory-pulse 2s ease-in-out infinite}.result-banner.defeat[_ngcontent-%COMP%]{border-color:#d926b5;box-shadow:0 0 20px #d926b54d}@keyframes _ngcontent-%COMP%_victory-pulse{0%,to{box-shadow:0 0 20px #26d9b580}50%{box-shadow:0 0 30px #26d9b5b3}}.result-emoji[_ngcontent-%COMP%]{font-size:3rem;margin-bottom:.25rem}@media (max-width: 480px){.result-emoji[_ngcontent-%COMP%]{font-size:2.5rem}}.result-title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:#fffffff2;text-shadow:0 2px 4px rgba(0,0,0,.5);margin-bottom:.25rem}@media (max-width: 480px){.result-title[_ngcontent-%COMP%]{font-size:1.25rem}}.result-subtitle[_ngcontent-%COMP%]{font-size:1.1rem;color:#ffffffd9;text-shadow:0 1px 2px rgba(0,0,0,.5)}@media (max-width: 480px){.result-subtitle[_ngcontent-%COMP%]{font-size:1rem}}.rankings[_ngcontent-%COMP%]{margin:.75rem 0}.rankings-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:.4rem}.rankings-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.6rem;padding:.5rem .6rem;background:#00000040;border-radius:6px;border:2px solid transparent;transition:all .3s ease}.rankings-list[_ngcontent-%COMP%]   li.is-current-user[_ngcontent-%COMP%]{border:2px solid rgba(255,255,255,.6);background:#00000059}.rank-badge[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;min-width:80px}@media (max-width: 480px){.rank-badge[_ngcontent-%COMP%]{min-width:70px}}.rank-emoji[_ngcontent-%COMP%]{font-size:1.5rem}@media (max-width: 480px){.rank-emoji[_ngcontent-%COMP%]{font-size:1.25rem}}.rank-number[_ngcontent-%COMP%]{font-weight:600;color:#ffffffe6;text-shadow:0 1px 2px rgba(0,0,0,.7);font-size:1rem}@media (max-width: 480px){.rank-number[_ngcontent-%COMP%]{font-size:.9rem}}.player-name[_ngcontent-%COMP%]{flex:1;font-size:1rem;font-weight:500;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.7)}@media (max-width: 480px){.player-name[_ngcontent-%COMP%]{font-size:.9rem}}.button-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;margin-top:.75rem;gap:.5rem}button[_ngcontent-%COMP%]{padding:.6rem 1.2rem;font-weight:500;border-radius:6px;cursor:pointer;text-shadow:0 1px 2px rgba(0,0,0,.5);transition:all .2s ease;margin:0;flex:1}.secondary-btn[_ngcontent-%COMP%]{background:#ffffff26;border:2px solid rgba(255,255,255,.4);color:#fff}.secondary-btn[_ngcontent-%COMP%]:hover{background:#ffffff40;border-color:#fff9}.primary-btn[_ngcontent-%COMP%]{background:linear-gradient(135deg,#22c3a3,#1b987f);border:2px solid rgba(255,255,255,.6);color:#fff;box-shadow:0 4px 12px #0000004d,0 0 20px #26d9b566}.primary-btn[_ngcontent-%COMP%]:hover{background:linear-gradient(135deg,#26d9b5,#1fad91);box-shadow:0 6px 16px #0006,0 0 30px #26d9b599;transform:translateY(-2px)}"]})};function ve(r,e){if(r&1){let t=E();p(0,"app-game-active",3),P("pickCell",function(o){M(t);let c=l();return O(c.onPickCell(o))}),m()}if(r&2){let t=l();y("state",t.state)("setup",t.room.player)}}function ke(r,e){if(r&1){let t=E();p(0,"app-game-ready",4),P("quickStart",function(){M(t);let o=l();return O(o.onQuickStart())})("leave",function(){M(t);let o=l();return O(o.onLeaveRoom())}),m()}if(r&2){let t=l();y("state",t.state)("currentUserId",t.userId)}}function we(r,e){if(r&1){let t=E();p(0,"app-game-done",5),P("newGame",function(){M(t);let o=l();return O(o.onNewGame())})("home",function(){M(t);let o=l();return O(o.onGoHome())}),m()}if(r&2){let t=l();y("state",t.state)("currentUserId",t.userId)}}var X=class r{constructor(e,t,n){this.userService=e;this.gameStateService=t;this.router=n}onPickCell(e){this.socket&&this.state?.phase==="active"&&this.socket.send({type:"pickCell",gameId:this.gameId,userId:this.userId,cell:e})}trackUserId(e,t){return t.userId}gameId="";userId="";socket=null;room=null;state=null;gameState=null;connected=!1;countdown=0;countdownInterval=null;userIdSub=null;showingFinalBoard=!1;finalBoardTimeout=null;actualDoneState=null;ngOnInit(){if(this.gameId=this.gameStateService.getGameId()||"",!this.gameId){console.warn("[Game] No active game found, redirecting to home"),this.router.navigate(["/"]);return}this.userIdSub=this.userService.getUserId$().subscribe(e=>{this.userId=e,this.socket&&this.socket.close(),this.socket=new q(this.gameId,this.userId),this.socket.connect(t=>{this.handleSocketMessage(t)},()=>{this.connected=!0,console.log(`[Socket] Connected: gameId=${this.gameId}, userId=${this.userId}`)},()=>{this.connected=!1,console.log("[Socket] Disconnected")})})}ngOnDestroy(){this.socket&&(console.log("[Socket] Closing connection"),this.socket.close()),this.userIdSub&&this.userIdSub.unsubscribe(),this.clearCountdownInterval(),this.clearFinalBoardTimeout()}handleSocketMessage(e){switch(e.type){case"state":if(this.logTurnDetails(e),e.phase==="done"&&!this.showingFinalBoard&&this.state?.phase==="active"){console.log("=== GAME OVER ==="),console.log("Final Rankings:",e.done?.placements?.map(a=>{let s=e.players.find(T=>T.userId===a.userId),f=s?.playerName||s?.userId||a.userId,D=s?.eliminatedAtTurn?` (eliminated turn ${s.eliminatedAtTurn})`:" (winner)";return`${a.rank}. ${f}${D}`}).join(" | ")),console.log("================"),this.actualDoneState=e;let t=e.done?.placements?.find(a=>a.rank===1),n=e.players.find(a=>a.userId===t?.userId),o=n?.playerName||n?.userId||"Winner",c=ne(te({},e),{phase:"active",active:ne(te({},e.active),{turnTimer:{totalMs:5e3,remainingMs:0},currentPlayerId:t?.userId||""})});this.state=c,this.showingFinalBoard=!0,this.clearFinalBoardTimeout(),this.finalBoardTimeout=setTimeout(()=>{this.showingFinalBoard=!1,this.state=this.actualDoneState,this.actualDoneState=null},4e3);return}if(this.state=e,e.phase==="ready"&&e.ready?this.startCountdown(e.ready.countdownTimer):this.clearCountdownInterval(),e.phase==="done")return;e.players&&e.players.length===0&&this.router.navigate(["/"]);break;case"joined":console.log("[Socket] Joined confirmation:",e),this.room={gameId:e.gameId,player:e.player};break;case"error":console.error("[Socket] Error:",e.error);break;case"kicked":console.warn("[Socket] You were removed from the game:",e.reason),this.router.navigate(["/"]);break;default:console.log("[Socket] Unhandled message type:",e);break}}startCountdown(e){this.countdown=Math.max(0,Math.floor(e/1e3)),this.clearCountdownInterval(),this.countdown>0&&(this.countdownInterval=setInterval(()=>{this.countdown>0?this.countdown--:this.clearCountdownInterval()},1e3))}clearCountdownInterval(){this.countdownInterval&&(clearInterval(this.countdownInterval),this.countdownInterval=null)}clearFinalBoardTimeout(){this.finalBoardTimeout&&(clearTimeout(this.finalBoardTimeout),this.finalBoardTimeout=null)}logTurnDetails(e){if(!e.history||e.history.length===0)return;let t=this.state?.history?.length||0;if(e.history.length<=t)return;let n=e.history[e.history.length-1],o=e.history.length,c=e.players.find(b=>b.userId===n.playerId),a=c?.playerName||c?.userId||"Unknown",s=n.hits.map(b=>{let R=e.players.find(z=>z.userId===b);return R?.playerName||R?.userId||b}),f=n.sinks.map(b=>{let R=e.players.find(N=>N.userId===b),z=R?.playerName||R?.userId||b,Z=e.boardLayout?.playerLayers.find(N=>N.playerId===b);if(Z&&Z.sunkShips){let N=Z.sunkShips.find(ee=>ee.cells.some(F=>F.x===n.cell.x&&F.y===n.cell.y));if(N){let ee=N.cells.map(F=>`(${F.x},${F.y})`).join(", ");return`${z} [${ee}]`}}return z}),D=e.players.filter(b=>b.eliminatedAtTurn===o).map(b=>b.playerName||b.userId),T=[`Turn #${o}`,`Player: ${a}`,`Picked: (${n.cell.x},${n.cell.y})`];s.length>0&&T.push(`Hits: [${s.join(", ")}]`),f.length>0&&T.push(`Sunk: [${f.join(", ")}]`),D.length>0&&T.push(`Eliminated: [${D.join(", ")}]`)}onQuickStart(){this.socket&&this.state?.ready?.quickStartEnabled&&this.socket.send({type:"quickStart",gameId:this.gameId,userId:this.userId})}onLeaveRoom(){this.socket&&this.socket.send({type:"exit",gameId:this.gameId,userId:this.userId}),this.gameStateService.clearGameId()}onNewGame(){this.gameStateService.clearGameId(),this.router.navigate(["/game-setup"])}onGoHome(){this.gameStateService.clearGameId(),this.router.navigate(["/"])}static \u0275fac=function(t){return new(t||r)(j(pe),j(me),j(ce))};static \u0275cmp=h({type:r,selectors:[["app-game"]],decls:4,vars:3,consts:[[1,"game-container"],[3,"state","setup"],[3,"state","currentUserId"],[3,"pickCell","state","setup"],[3,"quickStart","leave","state","currentUserId"],[3,"newGame","home","state","currentUserId"]],template:function(t,n){t&1&&(p(0,"div",0),k(1,ve,1,2,"app-game-active",1),k(2,ke,1,2,"app-game-ready",2),k(3,we,1,2,"app-game-done",2),m()),t&2&&(i(),w((n.state==null?null:n.state.phase)==="active"||n.showingFinalBoard?1:-1),i(),w((n.state==null?null:n.state.phase)==="ready"?2:-1),i(),w((n.state==null?null:n.state.phase)==="done"&&!n.showingFinalBoard?3:-1))},dependencies:[C,W,Q,K],styles:[".game-container[_ngcontent-%COMP%]{margin:0;padding:0;border-radius:8px}"]})};var _t=[{path:"",component:X}];export{_t as gameRoutes};
